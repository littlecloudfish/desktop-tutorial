{"ast":null,"code":"import _regeneratorRuntime from \"/home/little/Documents/music_web/startproj/zhengdao-ui/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/home/little/Documents/music_web/startproj/zhengdao-ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.number.parse-float.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/es.string.starts-with.js\";\nimport \"core-js/modules/web.timers.js\";\nimport \"core-js/modules/es.number.is-nan.js\";\nimport \"core-js/modules/es.number.to-fixed.js\";\nimport { ref, computed, inject, nextTick, watch } from 'vue';\nimport { debounce } from 'lodash-unified';\nimport '../../../../constants/index.mjs';\nimport '../../../../tokens/index.mjs';\nimport { EVENT_CODE } from '../../../../constants/aria.mjs';\nimport { sliderContextKey } from '../../../../tokens/slider.mjs';\nimport { UPDATE_MODEL_EVENT } from '../../../../constants/event.mjs';\nvar left = EVENT_CODE.left,\n    down = EVENT_CODE.down,\n    right = EVENT_CODE.right,\n    up = EVENT_CODE.up,\n    home = EVENT_CODE.home,\n    end = EVENT_CODE.end,\n    pageUp = EVENT_CODE.pageUp,\n    pageDown = EVENT_CODE.pageDown;\n\nvar useTooltip = function useTooltip(props, formatTooltip, showTooltip) {\n  var tooltip = ref();\n  var tooltipVisible = ref(false);\n  var enableFormat = computed(function () {\n    return formatTooltip.value instanceof Function;\n  });\n  var formatValue = computed(function () {\n    return enableFormat.value && formatTooltip.value(props.modelValue) || props.modelValue;\n  });\n  var displayTooltip = debounce(function () {\n    showTooltip.value && (tooltipVisible.value = true);\n  }, 50);\n  var hideTooltip = debounce(function () {\n    showTooltip.value && (tooltipVisible.value = false);\n  }, 50);\n  return {\n    tooltip: tooltip,\n    tooltipVisible: tooltipVisible,\n    formatValue: formatValue,\n    displayTooltip: displayTooltip,\n    hideTooltip: hideTooltip\n  };\n};\n\nvar useSliderButton = function useSliderButton(props, initData, emit) {\n  var _inject = inject(sliderContextKey),\n      disabled = _inject.disabled,\n      min = _inject.min,\n      max = _inject.max,\n      step = _inject.step,\n      showTooltip = _inject.showTooltip,\n      precision = _inject.precision,\n      sliderSize = _inject.sliderSize,\n      formatTooltip = _inject.formatTooltip,\n      emitChange = _inject.emitChange,\n      resetSize = _inject.resetSize,\n      updateDragging = _inject.updateDragging;\n\n  var _useTooltip = useTooltip(props, formatTooltip, showTooltip),\n      tooltip = _useTooltip.tooltip,\n      tooltipVisible = _useTooltip.tooltipVisible,\n      formatValue = _useTooltip.formatValue,\n      displayTooltip = _useTooltip.displayTooltip,\n      hideTooltip = _useTooltip.hideTooltip;\n\n  var button = ref();\n  var currentPosition = computed(function () {\n    return \"\".concat((props.modelValue - min.value) / (max.value - min.value) * 100, \"%\");\n  });\n  var wrapperStyle = computed(function () {\n    return props.vertical ? {\n      bottom: currentPosition.value\n    } : {\n      left: currentPosition.value\n    };\n  });\n\n  var handleMouseEnter = function handleMouseEnter() {\n    initData.hovering = true;\n    displayTooltip();\n  };\n\n  var handleMouseLeave = function handleMouseLeave() {\n    initData.hovering = false;\n\n    if (!initData.dragging) {\n      hideTooltip();\n    }\n  };\n\n  var onButtonDown = function onButtonDown(event) {\n    if (disabled.value) return;\n    event.preventDefault();\n    onDragStart(event);\n    window.addEventListener(\"mousemove\", onDragging);\n    window.addEventListener(\"touchmove\", onDragging);\n    window.addEventListener(\"mouseup\", onDragEnd);\n    window.addEventListener(\"touchend\", onDragEnd);\n    window.addEventListener(\"contextmenu\", onDragEnd);\n    button.value.focus();\n  };\n\n  var incrementPosition = function incrementPosition(amount) {\n    if (disabled.value) return;\n    initData.newPosition = Number.parseFloat(currentPosition.value) + amount / (max.value - min.value) * 100;\n    setPosition(initData.newPosition);\n    emitChange();\n  };\n\n  var onLeftKeyDown = function onLeftKeyDown() {\n    incrementPosition(-step.value);\n  };\n\n  var onRightKeyDown = function onRightKeyDown() {\n    incrementPosition(step.value);\n  };\n\n  var onPageDownKeyDown = function onPageDownKeyDown() {\n    incrementPosition(-step.value * 4);\n  };\n\n  var onPageUpKeyDown = function onPageUpKeyDown() {\n    incrementPosition(step.value * 4);\n  };\n\n  var onHomeKeyDown = function onHomeKeyDown() {\n    if (disabled.value) return;\n    setPosition(0);\n    emitChange();\n  };\n\n  var onEndKeyDown = function onEndKeyDown() {\n    if (disabled.value) return;\n    setPosition(100);\n    emitChange();\n  };\n\n  var onKeyDown = function onKeyDown(event) {\n    var isPreventDefault = true;\n\n    if ([left, down].includes(event.key)) {\n      onLeftKeyDown();\n    } else if ([right, up].includes(event.key)) {\n      onRightKeyDown();\n    } else if (event.key === home) {\n      onHomeKeyDown();\n    } else if (event.key === end) {\n      onEndKeyDown();\n    } else if (event.key === pageDown) {\n      onPageDownKeyDown();\n    } else if (event.key === pageUp) {\n      onPageUpKeyDown();\n    } else {\n      isPreventDefault = false;\n    }\n\n    isPreventDefault && event.preventDefault();\n  };\n\n  var getClientXY = function getClientXY(event) {\n    var clientX;\n    var clientY;\n\n    if (event.type.startsWith(\"touch\")) {\n      clientY = event.touches[0].clientY;\n      clientX = event.touches[0].clientX;\n    } else {\n      clientY = event.clientY;\n      clientX = event.clientX;\n    }\n\n    return {\n      clientX: clientX,\n      clientY: clientY\n    };\n  };\n\n  var onDragStart = function onDragStart(event) {\n    initData.dragging = true;\n    initData.isClick = true;\n\n    var _getClientXY = getClientXY(event),\n        clientX = _getClientXY.clientX,\n        clientY = _getClientXY.clientY;\n\n    if (props.vertical) {\n      initData.startY = clientY;\n    } else {\n      initData.startX = clientX;\n    }\n\n    initData.startPosition = Number.parseFloat(currentPosition.value);\n    initData.newPosition = initData.startPosition;\n  };\n\n  var onDragging = function onDragging(event) {\n    if (initData.dragging) {\n      initData.isClick = false;\n      displayTooltip();\n      resetSize();\n      var diff;\n\n      var _getClientXY2 = getClientXY(event),\n          clientX = _getClientXY2.clientX,\n          clientY = _getClientXY2.clientY;\n\n      if (props.vertical) {\n        initData.currentY = clientY;\n        diff = (initData.startY - initData.currentY) / sliderSize.value * 100;\n      } else {\n        initData.currentX = clientX;\n        diff = (initData.currentX - initData.startX) / sliderSize.value * 100;\n      }\n\n      initData.newPosition = initData.startPosition + diff;\n      setPosition(initData.newPosition);\n    }\n  };\n\n  var onDragEnd = function onDragEnd() {\n    if (initData.dragging) {\n      setTimeout(function () {\n        initData.dragging = false;\n\n        if (!initData.hovering) {\n          hideTooltip();\n        }\n\n        if (!initData.isClick) {\n          setPosition(initData.newPosition);\n          emitChange();\n        }\n      }, 0);\n      window.removeEventListener(\"mousemove\", onDragging);\n      window.removeEventListener(\"touchmove\", onDragging);\n      window.removeEventListener(\"mouseup\", onDragEnd);\n      window.removeEventListener(\"touchend\", onDragEnd);\n      window.removeEventListener(\"contextmenu\", onDragEnd);\n    }\n  };\n\n  var setPosition = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(newPosition) {\n      var lengthPerStep, steps, value;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(newPosition === null || Number.isNaN(+newPosition))) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 2:\n              if (newPosition < 0) {\n                newPosition = 0;\n              } else if (newPosition > 100) {\n                newPosition = 100;\n              }\n\n              lengthPerStep = 100 / ((max.value - min.value) / step.value);\n              steps = Math.round(newPosition / lengthPerStep);\n              value = steps * lengthPerStep * (max.value - min.value) * 0.01 + min.value;\n              value = Number.parseFloat(value.toFixed(precision.value));\n\n              if (value !== props.modelValue) {\n                emit(UPDATE_MODEL_EVENT, value);\n              }\n\n              if (!initData.dragging && props.modelValue !== initData.oldValue) {\n                initData.oldValue = props.modelValue;\n              }\n\n              _context.next = 11;\n              return nextTick();\n\n            case 11:\n              initData.dragging && displayTooltip();\n              tooltip.value.updatePopper();\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function setPosition(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  watch(function () {\n    return initData.dragging;\n  }, function (val) {\n    updateDragging(val);\n  });\n  return {\n    disabled: disabled,\n    button: button,\n    tooltip: tooltip,\n    tooltipVisible: tooltipVisible,\n    showTooltip: showTooltip,\n    wrapperStyle: wrapperStyle,\n    formatValue: formatValue,\n    handleMouseEnter: handleMouseEnter,\n    handleMouseLeave: handleMouseLeave,\n    onButtonDown: onButtonDown,\n    onKeyDown: onKeyDown,\n    setPosition: setPosition\n  };\n};\n\nexport { useSliderButton };","map":{"version":3,"mappings":"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","names":["left","EVENT_CODE","down","right","up","home","end","pageUp","pageDown","useTooltip","props","formatTooltip","showTooltip","tooltip","ref","tooltipVisible","enableFormat","computed","value","Function","formatValue","modelValue","displayTooltip","debounce","hideTooltip","useSliderButton","initData","emit","inject","sliderContextKey","disabled","min","max","step","precision","sliderSize","emitChange","resetSize","updateDragging","button","currentPosition","wrapperStyle","vertical","bottom","handleMouseEnter","hovering","handleMouseLeave","dragging","onButtonDown","event","preventDefault","onDragStart","window","addEventListener","onDragging","onDragEnd","focus","incrementPosition","amount","newPosition","Number","parseFloat","setPosition","onLeftKeyDown","onRightKeyDown","onPageDownKeyDown","onPageUpKeyDown","onHomeKeyDown","onEndKeyDown","onKeyDown","isPreventDefault","includes","key","getClientXY","clientX","clientY","type","startsWith","touches","isClick","startY","startX","startPosition","diff","currentY","currentX","setTimeout","removeEventListener","isNaN","lengthPerStep","steps","Math","round","toFixed","UPDATE_MODEL_EVENT","oldValue","nextTick","updatePopper","watch","val"],"sources":["../../../../../../../packages/components/slider/src/composables/use-slider-button.ts"],"sourcesContent":["import { computed, inject, nextTick, ref, watch } from 'vue'\nimport { debounce } from 'lodash-unified'\nimport { EVENT_CODE, UPDATE_MODEL_EVENT } from '@element-plus/constants'\nimport { sliderContextKey } from '@element-plus/tokens'\nimport type { CSSProperties, ComputedRef, Ref, SetupContext } from 'vue'\nimport type { TooltipInstance } from '@element-plus/components/tooltip'\nimport type { SliderProps } from '../slider'\nimport type {\n  SliderButtonEmits,\n  SliderButtonInitData,\n  SliderButtonProps,\n} from '../button'\n\nconst { left, down, right, up, home, end, pageUp, pageDown } = EVENT_CODE\n\nconst useTooltip = (\n  props: SliderButtonProps,\n  formatTooltip: Ref<SliderProps['formatTooltip']>,\n  showTooltip: Ref<SliderProps['showTooltip']>\n) => {\n  const tooltip = ref<TooltipInstance>()\n\n  const tooltipVisible = ref(false)\n\n  const enableFormat = computed(() => {\n    return formatTooltip.value instanceof Function\n  })\n\n  const formatValue = computed(() => {\n    return (\n      (enableFormat.value && formatTooltip.value!(props.modelValue)) ||\n      props.modelValue\n    )\n  })\n\n  const displayTooltip = debounce(() => {\n    showTooltip.value && (tooltipVisible.value = true)\n  }, 50)\n\n  const hideTooltip = debounce(() => {\n    showTooltip.value && (tooltipVisible.value = false)\n  }, 50)\n\n  return {\n    tooltip,\n    tooltipVisible,\n    formatValue,\n    displayTooltip,\n    hideTooltip,\n  }\n}\n\nexport const useSliderButton = (\n  props: SliderButtonProps,\n  initData: SliderButtonInitData,\n  emit: SetupContext<SliderButtonEmits>['emit']\n) => {\n  const {\n    disabled,\n    min,\n    max,\n    step,\n    showTooltip,\n    precision,\n    sliderSize,\n    formatTooltip,\n    emitChange,\n    resetSize,\n    updateDragging,\n  } = inject(sliderContextKey)!\n\n  const { tooltip, tooltipVisible, formatValue, displayTooltip, hideTooltip } =\n    useTooltip(props, formatTooltip!, showTooltip)\n\n  const button = ref<HTMLDivElement>()\n\n  const currentPosition = computed(() => {\n    return `${\n      ((props.modelValue - min.value) / (max.value - min.value)) * 100\n    }%`\n  })\n\n  const wrapperStyle: ComputedRef<CSSProperties> = computed(() => {\n    return props.vertical\n      ? { bottom: currentPosition.value }\n      : { left: currentPosition.value }\n  })\n\n  const handleMouseEnter = () => {\n    initData.hovering = true\n    displayTooltip()\n  }\n\n  const handleMouseLeave = () => {\n    initData.hovering = false\n    if (!initData.dragging) {\n      hideTooltip()\n    }\n  }\n\n  const onButtonDown = (event: MouseEvent | TouchEvent) => {\n    if (disabled.value) return\n    event.preventDefault()\n    onDragStart(event)\n    window.addEventListener('mousemove', onDragging)\n    window.addEventListener('touchmove', onDragging)\n    window.addEventListener('mouseup', onDragEnd)\n    window.addEventListener('touchend', onDragEnd)\n    window.addEventListener('contextmenu', onDragEnd)\n    button.value!.focus()\n  }\n\n  const incrementPosition = (amount: number) => {\n    if (disabled.value) return\n    initData.newPosition =\n      Number.parseFloat(currentPosition.value) +\n      (amount / (max.value - min.value)) * 100\n    setPosition(initData.newPosition)\n    emitChange()\n  }\n\n  const onLeftKeyDown = () => {\n    incrementPosition(-step.value)\n  }\n\n  const onRightKeyDown = () => {\n    incrementPosition(step.value)\n  }\n\n  const onPageDownKeyDown = () => {\n    incrementPosition(-step.value * 4)\n  }\n\n  const onPageUpKeyDown = () => {\n    incrementPosition(step.value * 4)\n  }\n\n  const onHomeKeyDown = () => {\n    if (disabled.value) return\n    setPosition(0)\n    emitChange()\n  }\n\n  const onEndKeyDown = () => {\n    if (disabled.value) return\n    setPosition(100)\n    emitChange()\n  }\n\n  const onKeyDown = (event: KeyboardEvent) => {\n    let isPreventDefault = true\n    if ([left, down].includes(event.key)) {\n      onLeftKeyDown()\n    } else if ([right, up].includes(event.key)) {\n      onRightKeyDown()\n    } else if (event.key === home) {\n      onHomeKeyDown()\n    } else if (event.key === end) {\n      onEndKeyDown()\n    } else if (event.key === pageDown) {\n      onPageDownKeyDown()\n    } else if (event.key === pageUp) {\n      onPageUpKeyDown()\n    } else {\n      isPreventDefault = false\n    }\n    isPreventDefault && event.preventDefault()\n  }\n\n  const getClientXY = (event: MouseEvent | TouchEvent) => {\n    let clientX: number\n    let clientY: number\n    if (event.type.startsWith('touch')) {\n      clientY = (event as TouchEvent).touches[0].clientY\n      clientX = (event as TouchEvent).touches[0].clientX\n    } else {\n      clientY = (event as MouseEvent).clientY\n      clientX = (event as MouseEvent).clientX\n    }\n    return {\n      clientX,\n      clientY,\n    }\n  }\n\n  const onDragStart = (event: MouseEvent | TouchEvent) => {\n    initData.dragging = true\n    initData.isClick = true\n    const { clientX, clientY } = getClientXY(event)\n    if (props.vertical) {\n      initData.startY = clientY\n    } else {\n      initData.startX = clientX\n    }\n    initData.startPosition = Number.parseFloat(currentPosition.value)\n    initData.newPosition = initData.startPosition\n  }\n\n  const onDragging = (event: MouseEvent | TouchEvent) => {\n    if (initData.dragging) {\n      initData.isClick = false\n      displayTooltip()\n      resetSize()\n      let diff: number\n      const { clientX, clientY } = getClientXY(event)\n      if (props.vertical) {\n        initData.currentY = clientY\n        diff = ((initData.startY - initData.currentY) / sliderSize.value) * 100\n      } else {\n        initData.currentX = clientX\n        diff = ((initData.currentX - initData.startX) / sliderSize.value) * 100\n      }\n      initData.newPosition = initData.startPosition + diff\n      setPosition(initData.newPosition)\n    }\n  }\n\n  const onDragEnd = () => {\n    if (initData.dragging) {\n      /*\n       * 防止在 mouseup 后立即触发 click，导致滑块有几率产生一小段位移\n       * 不使用 preventDefault 是因为 mouseup 和 click 没有注册在同一个 DOM 上\n       */\n      setTimeout(() => {\n        initData.dragging = false\n        if (!initData.hovering) {\n          hideTooltip()\n        }\n        if (!initData.isClick) {\n          setPosition(initData.newPosition)\n          emitChange()\n        }\n      }, 0)\n      window.removeEventListener('mousemove', onDragging)\n      window.removeEventListener('touchmove', onDragging)\n      window.removeEventListener('mouseup', onDragEnd)\n      window.removeEventListener('touchend', onDragEnd)\n      window.removeEventListener('contextmenu', onDragEnd)\n    }\n  }\n\n  const setPosition = async (newPosition: number) => {\n    if (newPosition === null || Number.isNaN(+newPosition)) return\n    if (newPosition < 0) {\n      newPosition = 0\n    } else if (newPosition > 100) {\n      newPosition = 100\n    }\n    const lengthPerStep = 100 / ((max.value - min.value) / step.value)\n    const steps = Math.round(newPosition / lengthPerStep)\n    let value =\n      steps * lengthPerStep * (max.value - min.value) * 0.01 + min.value\n    value = Number.parseFloat(value.toFixed(precision.value))\n\n    if (value !== props.modelValue) {\n      emit(UPDATE_MODEL_EVENT, value)\n    }\n\n    if (!initData.dragging && props.modelValue !== initData.oldValue) {\n      initData.oldValue = props.modelValue\n    }\n\n    await nextTick()\n    initData.dragging && displayTooltip()\n    tooltip.value.updatePopper()\n  }\n\n  watch(\n    () => initData.dragging,\n    (val) => {\n      updateDragging(val)\n    }\n  )\n\n  return {\n    disabled,\n    button,\n    tooltip,\n    tooltipVisible,\n    showTooltip,\n    wrapperStyle,\n    formatValue,\n    handleMouseEnter,\n    handleMouseLeave,\n    onButtonDown,\n    onKeyDown,\n    setPosition,\n  }\n}\n"]},"metadata":{},"sourceType":"module"}