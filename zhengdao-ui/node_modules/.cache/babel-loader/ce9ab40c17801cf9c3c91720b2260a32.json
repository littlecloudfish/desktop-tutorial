{"ast":null,"code":"import * as vue from 'vue';\n/**\n * Mixin component with base and common properties and functions.\n */\n\n/**\n * Base properties common for the audio-visual components\n */\n\nconst props = {\n  /**\n   * prop: 'audio-src'\n   * Audio element src attribute. When provided creates audio element\n   */\n  audioSrc: {\n    type: String,\n    default: null\n  },\n\n  /**\n   * prop: 'audio-sink-device-id'\n   * Audio sink device id. When provided sets audio output device.\n   */\n  audioSinkDeviceId: {\n    type: String,\n    default: null\n  },\n\n  /**\n   * prop: 'ref-link'\n   * Refrence to Audio element. When provided, then local audio element\n   * is not created and use refrence to the element. Component will\n   * search only for its parent refs.\n   */\n  refLink: {\n    type: String,\n    default: null\n  },\n\n  /**\n   * prop: 'audio-controls'\n   * Audio element controls attribute. When provided should\n   * display audio element with controls\n   */\n  audioControls: {\n    type: Boolean,\n    default: true\n  },\n\n  /**\n   * prop: 'cors-anonym'\n   * CORS requests for this element will not have the credentials flag set.\n   * Set crossOrigin property of audio element to 'anonymous'.\n   * Default: null\n   */\n  corsAnonym: {\n    type: Boolean,\n    default: false\n  },\n\n  /**\n   * prop: 'audio-class'\n   * Audio element css class name.\n   */\n  audioClass: {\n    type: String,\n    default: null\n  },\n\n  /**\n   * prop: 'canv-width'\n   * Canvas element width. Default 300\n   */\n  canvWidth: {\n    type: Number,\n    default: 300\n  },\n\n  /**\n   * prop: 'canv-height'\n   * Canvas element height. Default 80\n   */\n  canvHeight: {\n    type: Number,\n    default: 80\n  },\n\n  /**\n   * prop: 'canv-class'\n   * Canvas element css class name.\n   */\n  canvClass: {\n    type: String,\n    default: null\n  },\n\n  /**\n   * prop: 'canv-top'\n   * Canvas element position on top relatively to audio element.\n   * Default: false\n   */\n  canvTop: {\n    type: Boolean,\n    default: false\n  },\n\n  /**\n   * prop: 'canv-fill-color'\n   * Canvas fill background color. Can be string RGB color or canvas gradients array.\n   * Default is transperent.\n   */\n  canvFillColor: {\n    type: [String, Array],\n    default: null\n  }\n};\nconst methods = {\n  /**\n   * Create audio and canvas elements and insert in the HTML template.\n   * Using document.createElement to avoid Vue virtual DOM re-rendering\n   * which can lead to infinit loops.\n   */\n  createHTMLElements: function () {\n    const canv = document.createElement('canvas');\n    const canvDiv = document.createElement('div');\n    let audioDiv = null;\n    let audio = null;\n\n    if (this.refLink) {\n      audio = this.$parent.$refs[this.refLink];\n    } else {\n      audio = document.createElement('audio');\n      audioDiv = document.createElement('div');\n      audio.setAttribute('src', this.audioSrc);\n      if (this.audioControls) audio.setAttribute('controls', true);\n      if (this.audioClass) audio.setAttribute('class', this.audioClass);\n      if (this.corsAnonym) audio.crossOrigin = 'anonymous';\n      audioDiv.appendChild(audio);\n      this.$el.appendChild(audioDiv);\n    }\n\n    if (this.canvClass) canv.setAttribute('class', this.canvClass);\n    if (this.canvWidth) canv.setAttribute('width', this.canvWidth);\n    if (this.canvHeight) canv.setAttribute('height', this.canvHeight);\n    canvDiv.appendChild(canv);\n\n    if (this.canvTop) {\n      this.$el.insertBefore(canvDiv, audioDiv);\n    } else {\n      this.$el.appendChild(canvDiv);\n    }\n\n    this.ctxWrapper = canv;\n    this.ctx = canv.getContext('2d');\n    this.audio = audio;\n    this.audio.load();\n  },\n\n  /**\n   * Set audio context analyser.\n   */\n  async setAnalyser() {\n    this.audioCtx = this.audioCtx || new AudioContext();\n    this.analyser = this.analyser || this.audioCtx.createAnalyser();\n    const src = this.audioCtx.createMediaElementSource(this.audio);\n    const destination = this.audioCtx.createMediaStreamDestination();\n    src.connect(this.analyser);\n    this.analyser.fftSize = this.fftSize;\n    this.analyser.connect(destination);\n    const audio = new Audio();\n    audio.srcObject = destination.stream;\n\n    if (this.audioSinkDeviceId) {\n      await audio.setSinkId(this.audioSinkDeviceId);\n    }\n\n    audio.play();\n  },\n\n  /**\n   * Canvas gradient. Vertical, from top down\n   */\n  fillGradient: function (colorsArray) {\n    const w = this.canvWidth;\n    const h = this.canvHeight;\n    const gradient = this.ctx.createLinearGradient(w / 2, 0, w / 2, h);\n    let offset = 0;\n    colorsArray.forEach(color => {\n      gradient.addColorStop(offset, color);\n      offset += 1 / colorsArray.length;\n    });\n    return gradient;\n  },\n\n  /**\n   * Return the inner audio element.\n   */\n  getAudioElement: function () {\n    return this.audio;\n  }\n}; // A fix for webpack warnings across vue2 & vue3\n\nconst h = vue['h'[0]];\nexport default {\n  props,\n  expose: ['getAudioElement'],\n\n  render(hv2) {\n    if (h) {\n      // Vue3 render\n      return h('div');\n    } // Vue2 render\n\n\n    return hv2('div');\n  },\n\n  mounted() {\n    this.createHTMLElements();\n\n    this.audio.onclick = () => {\n      if (!this.audioCtx) this.setAnalyser();\n    };\n\n    this.audio.onplay = () => {\n      this.$emit('playing');\n      if (!this.audioCtx) this.setAnalyser();\n      this.mainLoop();\n\n      if (this.audioCtx) {\n        // not defined for waveform\n        this.audioCtx.resume();\n      }\n    };\n\n    this.audio.onpause = () => {\n      this.$emit('paused');\n\n      if (this.audioCtx) {\n        this.audioCtx.suspend();\n        cancelAnimationFrame(this.animId);\n      }\n    };\n\n    this.audio.onended = () => {\n      this.$emit('ended');\n    };\n  },\n\n  beforeDestroy() {\n    if (this.audioCtx) {\n      this.audioCtx.suspend();\n    }\n\n    cancelAnimationFrame(this.animId);\n  },\n\n  methods\n};","map":{"version":3,"names":["vue","props","audioSrc","type","String","default","audioSinkDeviceId","refLink","audioControls","Boolean","corsAnonym","audioClass","canvWidth","Number","canvHeight","canvClass","canvTop","canvFillColor","Array","methods","createHTMLElements","canv","document","createElement","canvDiv","audioDiv","audio","$parent","$refs","setAttribute","crossOrigin","appendChild","$el","insertBefore","ctxWrapper","ctx","getContext","load","setAnalyser","audioCtx","AudioContext","analyser","createAnalyser","src","createMediaElementSource","destination","createMediaStreamDestination","connect","fftSize","Audio","srcObject","stream","setSinkId","play","fillGradient","colorsArray","w","h","gradient","createLinearGradient","offset","forEach","color","addColorStop","length","getAudioElement","expose","render","hv2","mounted","onclick","onplay","$emit","mainLoop","resume","onpause","suspend","cancelAnimationFrame","animId","onended","beforeDestroy"],"sources":["/home/little/Documents/music_web/startproj/zhengdao-ui/node_modules/vue-audio-visual/src/components/AvBase.js"],"sourcesContent":["import * as vue from 'vue'\n/**\n * Mixin component with base and common properties and functions.\n */\n\n/**\n * Base properties common for the audio-visual components\n */\nconst props = {\n  /**\n   * prop: 'audio-src'\n   * Audio element src attribute. When provided creates audio element\n   */\n  audioSrc: {\n    type: String,\n    default: null\n  },\n  /**\n   * prop: 'audio-sink-device-id'\n   * Audio sink device id. When provided sets audio output device.\n   */\n  audioSinkDeviceId: {\n    type: String,\n    default: null\n  },\n  /**\n   * prop: 'ref-link'\n   * Refrence to Audio element. When provided, then local audio element\n   * is not created and use refrence to the element. Component will\n   * search only for its parent refs.\n   */\n  refLink: {\n    type: String,\n    default: null\n  },\n  /**\n   * prop: 'audio-controls'\n   * Audio element controls attribute. When provided should\n   * display audio element with controls\n   */\n  audioControls: {\n    type: Boolean,\n    default: true\n  },\n  /**\n   * prop: 'cors-anonym'\n   * CORS requests for this element will not have the credentials flag set.\n   * Set crossOrigin property of audio element to 'anonymous'.\n   * Default: null\n   */\n  corsAnonym: {\n    type: Boolean,\n    default: false\n  },\n  /**\n   * prop: 'audio-class'\n   * Audio element css class name.\n   */\n  audioClass: {\n    type: String,\n    default: null\n  },\n  /**\n   * prop: 'canv-width'\n   * Canvas element width. Default 300\n   */\n  canvWidth: {\n    type: Number,\n    default: 300\n  },\n  /**\n   * prop: 'canv-height'\n   * Canvas element height. Default 80\n   */\n  canvHeight: {\n    type: Number,\n    default: 80\n  },\n  /**\n   * prop: 'canv-class'\n   * Canvas element css class name.\n   */\n  canvClass: {\n    type: String,\n    default: null\n  },\n  /**\n   * prop: 'canv-top'\n   * Canvas element position on top relatively to audio element.\n   * Default: false\n   */\n  canvTop: {\n    type: Boolean,\n    default: false\n  },\n  /**\n   * prop: 'canv-fill-color'\n   * Canvas fill background color. Can be string RGB color or canvas gradients array.\n   * Default is transperent.\n   */\n  canvFillColor: {\n    type: [String, Array],\n    default: null\n  }\n}\n\nconst methods = {\n  /**\n   * Create audio and canvas elements and insert in the HTML template.\n   * Using document.createElement to avoid Vue virtual DOM re-rendering\n   * which can lead to infinit loops.\n   */\n  createHTMLElements: function () {\n    const canv = document.createElement('canvas')\n    const canvDiv = document.createElement('div')\n    let audioDiv = null\n    let audio = null\n\n    if (this.refLink) {\n      audio = this.$parent.$refs[this.refLink]\n    } else {\n      audio = document.createElement('audio')\n      audioDiv = document.createElement('div')\n      audio.setAttribute('src', this.audioSrc)\n      if (this.audioControls) audio.setAttribute('controls', true)\n      if (this.audioClass) audio.setAttribute('class', this.audioClass)\n      if (this.corsAnonym) audio.crossOrigin = 'anonymous'\n      audioDiv.appendChild(audio)\n      this.$el.appendChild(audioDiv)\n    }\n\n    if (this.canvClass) canv.setAttribute('class', this.canvClass)\n    if (this.canvWidth) canv.setAttribute('width', this.canvWidth)\n    if (this.canvHeight) canv.setAttribute('height', this.canvHeight)\n    canvDiv.appendChild(canv)\n\n    if (this.canvTop) {\n      this.$el.insertBefore(canvDiv, audioDiv)\n    } else {\n      this.$el.appendChild(canvDiv)\n    }\n    this.ctxWrapper = canv\n    this.ctx = canv.getContext('2d')\n\n    this.audio = audio\n    this.audio.load()\n  },\n\n  /**\n   * Set audio context analyser.\n   */\n  async setAnalyser () {\n    this.audioCtx = this.audioCtx || new AudioContext()\n    this.analyser = this.analyser || this.audioCtx.createAnalyser()\n    const src = this.audioCtx.createMediaElementSource(this.audio)\n    const destination = this.audioCtx.createMediaStreamDestination()\n\n    src.connect(this.analyser)\n    this.analyser.fftSize = this.fftSize\n    this.analyser.connect(destination)\n\n    const audio = new Audio()\n    audio.srcObject = destination.stream\n    if (this.audioSinkDeviceId) {\n      await audio.setSinkId(this.audioSinkDeviceId)\n    }\n    audio.play()\n  },\n\n  /**\n   * Canvas gradient. Vertical, from top down\n   */\n  fillGradient: function (colorsArray) {\n    const w = this.canvWidth\n    const h = this.canvHeight\n    const gradient = this.ctx.createLinearGradient(w / 2, 0, w / 2, h)\n    let offset = 0\n    colorsArray.forEach(color => {\n      gradient.addColorStop(offset, color)\n      offset += (1 / colorsArray.length)\n    })\n    return gradient\n  },\n\n  /**\n   * Return the inner audio element.\n   */\n  getAudioElement: function () {\n    return this.audio\n  }\n}\n\n// A fix for webpack warnings across vue2 & vue3\nconst h = vue['h'[0]]\n\nexport default {\n  props,\n  expose: [\n    'getAudioElement'\n  ],\n  render (hv2) {\n    if (h) {\n      // Vue3 render\n      return h('div')\n    }\n    // Vue2 render\n    return hv2('div')\n  },\n  mounted () {\n    this.createHTMLElements()\n\n    this.audio.onclick = () => {\n      if (!this.audioCtx) this.setAnalyser()\n    }\n\n    this.audio.onplay = () => {\n      this.$emit('playing')\n      if (!this.audioCtx) this.setAnalyser()\n      this.mainLoop()\n      if (this.audioCtx) { // not defined for waveform\n        this.audioCtx.resume()\n      }\n    }\n\n    this.audio.onpause = () => {\n      this.$emit('paused')\n      if (this.audioCtx) {\n        this.audioCtx.suspend()\n        cancelAnimationFrame(this.animId)\n      }\n    }\n\n    this.audio.onended = () => {\n      this.$emit('ended')\n    }\n  },\n\n  beforeDestroy () {\n    if (this.audioCtx) {\n      this.audioCtx.suspend()\n    }\n    cancelAnimationFrame(this.animId)\n  },\n  methods\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}