{"ast":null,"code":"import { ref, toRef, shallowRef, computed, unref, watch } from 'vue';\nimport '../../../utils/index.mjs';\nimport './composables/index.mjs';\nimport { useColumns } from './composables/use-columns.mjs';\nimport { useScrollbar } from './composables/use-scrollbar.mjs';\nimport { useRow } from './composables/use-row.mjs';\nimport { useData } from './composables/use-data.mjs';\nimport { useStyles } from './composables/use-styles.mjs';\nimport { isArray } from '@vue/shared';\n\nfunction useTable(props) {\n  var mainTableRef = ref();\n  var leftTableRef = ref();\n  var rightTableRef = ref();\n\n  var _useColumns = useColumns(props, toRef(props, \"columns\"), toRef(props, \"fixed\")),\n      columns = _useColumns.columns,\n      columnsStyles = _useColumns.columnsStyles,\n      columnsTotalWidth = _useColumns.columnsTotalWidth,\n      fixedColumnsOnLeft = _useColumns.fixedColumnsOnLeft,\n      fixedColumnsOnRight = _useColumns.fixedColumnsOnRight,\n      hasFixedColumns = _useColumns.hasFixedColumns,\n      mainColumns = _useColumns.mainColumns,\n      onColumnSorted = _useColumns.onColumnSorted;\n\n  var _useScrollbar = useScrollbar(props, {\n    mainTableRef: mainTableRef,\n    leftTableRef: leftTableRef,\n    rightTableRef: rightTableRef,\n    onMaybeEndReached: onMaybeEndReached\n  }),\n      scrollTo = _useScrollbar.scrollTo,\n      scrollToLeft = _useScrollbar.scrollToLeft,\n      scrollToTop = _useScrollbar.scrollToTop,\n      scrollToRow = _useScrollbar.scrollToRow,\n      onScroll = _useScrollbar.onScroll,\n      onVerticalScroll = _useScrollbar.onVerticalScroll,\n      scrollPos = _useScrollbar.scrollPos;\n\n  var _useRow = useRow(props, {\n    mainTableRef: mainTableRef,\n    leftTableRef: leftTableRef,\n    rightTableRef: rightTableRef,\n    onMaybeEndReached: onMaybeEndReached\n  }),\n      expandedRowKeys = _useRow.expandedRowKeys,\n      hoveringRowKey = _useRow.hoveringRowKey,\n      lastRenderedRowIndex = _useRow.lastRenderedRowIndex,\n      isDynamic = _useRow.isDynamic,\n      isResetting = _useRow.isResetting,\n      rowHeights = _useRow.rowHeights,\n      resetAfterIndex = _useRow.resetAfterIndex,\n      onRowExpanded = _useRow.onRowExpanded,\n      onRowHeightChange = _useRow.onRowHeightChange,\n      onRowHovered = _useRow.onRowHovered,\n      onRowsRendered = _useRow.onRowsRendered;\n\n  var _useData = useData(props, {\n    expandedRowKeys: expandedRowKeys,\n    lastRenderedRowIndex: lastRenderedRowIndex,\n    resetAfterIndex: resetAfterIndex\n  }),\n      data = _useData.data,\n      depthMap = _useData.depthMap;\n\n  var _useStyles = useStyles(props, {\n    columnsTotalWidth: columnsTotalWidth,\n    data: data,\n    fixedColumnsOnLeft: fixedColumnsOnLeft,\n    fixedColumnsOnRight: fixedColumnsOnRight\n  }),\n      bodyWidth = _useStyles.bodyWidth,\n      fixedTableHeight = _useStyles.fixedTableHeight,\n      mainTableHeight = _useStyles.mainTableHeight,\n      leftTableWidth = _useStyles.leftTableWidth,\n      rightTableWidth = _useStyles.rightTableWidth,\n      headerWidth = _useStyles.headerWidth,\n      rowsHeight = _useStyles.rowsHeight,\n      windowHeight = _useStyles.windowHeight,\n      footerHeight = _useStyles.footerHeight,\n      emptyStyle = _useStyles.emptyStyle,\n      rootStyle = _useStyles.rootStyle;\n\n  var isScrolling = shallowRef(false);\n  var containerRef = ref();\n  var showEmpty = computed(function () {\n    var noData = unref(data).length === 0;\n    return isArray(props.fixedData) ? props.fixedData.length === 0 && noData : noData;\n  });\n\n  function getRowHeight(rowIndex) {\n    var estimatedRowHeight = props.estimatedRowHeight,\n        rowHeight = props.rowHeight,\n        rowKey = props.rowKey;\n    if (!estimatedRowHeight) return rowHeight;\n    return unref(rowHeights)[unref(data)[rowIndex][rowKey]] || estimatedRowHeight;\n  }\n\n  function onMaybeEndReached() {\n    var onEndReached = props.onEndReached;\n    if (!onEndReached) return;\n\n    var _unref = unref(scrollPos),\n        scrollTop = _unref.scrollTop;\n\n    var _totalHeight = unref(rowsHeight);\n\n    var clientHeight = unref(windowHeight);\n    var heightUntilEnd = _totalHeight - (scrollTop + clientHeight) + props.hScrollbarSize;\n\n    if (unref(lastRenderedRowIndex) >= 0 && _totalHeight !== unref(rowsHeight)) {\n      onEndReached(heightUntilEnd);\n    }\n  }\n\n  watch(function () {\n    return props.expandedRowKeys;\n  }, function (val) {\n    return expandedRowKeys.value = val;\n  }, {\n    deep: true\n  });\n  return {\n    columns: columns,\n    containerRef: containerRef,\n    mainTableRef: mainTableRef,\n    leftTableRef: leftTableRef,\n    rightTableRef: rightTableRef,\n    isDynamic: isDynamic,\n    isResetting: isResetting,\n    isScrolling: isScrolling,\n    hoveringRowKey: hoveringRowKey,\n    hasFixedColumns: hasFixedColumns,\n    columnsStyles: columnsStyles,\n    columnsTotalWidth: columnsTotalWidth,\n    data: data,\n    expandedRowKeys: expandedRowKeys,\n    depthMap: depthMap,\n    fixedColumnsOnLeft: fixedColumnsOnLeft,\n    fixedColumnsOnRight: fixedColumnsOnRight,\n    mainColumns: mainColumns,\n    bodyWidth: bodyWidth,\n    emptyStyle: emptyStyle,\n    rootStyle: rootStyle,\n    headerWidth: headerWidth,\n    footerHeight: footerHeight,\n    mainTableHeight: mainTableHeight,\n    fixedTableHeight: fixedTableHeight,\n    leftTableWidth: leftTableWidth,\n    rightTableWidth: rightTableWidth,\n    showEmpty: showEmpty,\n    getRowHeight: getRowHeight,\n    onColumnSorted: onColumnSorted,\n    onRowHovered: onRowHovered,\n    onRowExpanded: onRowExpanded,\n    onRowsRendered: onRowsRendered,\n    onRowHeightChange: onRowHeightChange,\n    scrollTo: scrollTo,\n    scrollToLeft: scrollToLeft,\n    scrollToTop: scrollToTop,\n    scrollToRow: scrollToRow,\n    onScroll: onScroll,\n    onVerticalScroll: onVerticalScroll\n  };\n}\n\nexport { useTable };","map":{"version":3,"mappings":"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","names":["useTable","props","mainTableRef","ref","leftTableRef","rightTableRef","useColumns","toRef","columns","columnsStyles","columnsTotalWidth","fixedColumnsOnLeft","fixedColumnsOnRight","hasFixedColumns","mainColumns","onColumnSorted","useScrollbar","onMaybeEndReached","scrollTo","scrollToLeft","scrollToTop","scrollToRow","onScroll","onVerticalScroll","scrollPos","useRow","expandedRowKeys","hoveringRowKey","lastRenderedRowIndex","isDynamic","isResetting","rowHeights","resetAfterIndex","onRowExpanded","onRowHeightChange","onRowHovered","onRowsRendered","useData","data","depthMap","useStyles","bodyWidth","fixedTableHeight","mainTableHeight","leftTableWidth","rightTableWidth","headerWidth","rowsHeight","windowHeight","footerHeight","emptyStyle","rootStyle","isScrolling","shallowRef","containerRef","showEmpty","computed","noData","unref","length","isArray","fixedData","getRowHeight","rowIndex","estimatedRowHeight","rowHeight","rowKey","onEndReached","scrollTop","_totalHeight","clientHeight","heightUntilEnd","hScrollbarSize","watch","val","value","deep"],"sources":["../../../../../../packages/components/table-v2/src/use-table.ts"],"sourcesContent":["import { computed, ref, shallowRef, toRef, unref, watch } from 'vue'\nimport { isArray } from '@element-plus/utils'\nimport {\n  useColumns,\n  useData,\n  useRow,\n  useScrollbar,\n  useStyles,\n} from './composables'\n\nimport type { TableV2Props } from './table'\nimport type { TableGridInstance } from './table-grid'\n\nfunction useTable(props: TableV2Props) {\n  const mainTableRef = ref<TableGridInstance>()\n  const leftTableRef = ref<TableGridInstance>()\n  const rightTableRef = ref<TableGridInstance>()\n  const {\n    columns,\n    columnsStyles,\n    columnsTotalWidth,\n    fixedColumnsOnLeft,\n    fixedColumnsOnRight,\n    hasFixedColumns,\n    mainColumns,\n\n    onColumnSorted,\n  } = useColumns(props, toRef(props, 'columns'), toRef(props, 'fixed'))\n\n  const {\n    scrollTo,\n    scrollToLeft,\n    scrollToTop,\n    scrollToRow,\n    onScroll,\n    onVerticalScroll,\n    scrollPos,\n  } = useScrollbar(props, {\n    mainTableRef,\n    leftTableRef,\n    rightTableRef,\n\n    onMaybeEndReached,\n  })\n\n  const {\n    expandedRowKeys,\n    hoveringRowKey,\n    lastRenderedRowIndex,\n    isDynamic,\n    isResetting,\n    rowHeights,\n\n    resetAfterIndex,\n    onRowExpanded,\n    onRowHeightChange,\n    onRowHovered,\n    onRowsRendered,\n  } = useRow(props, {\n    mainTableRef,\n    leftTableRef,\n    rightTableRef,\n\n    onMaybeEndReached,\n  })\n\n  const { data, depthMap } = useData(props, {\n    expandedRowKeys,\n    lastRenderedRowIndex,\n    resetAfterIndex,\n  })\n\n  const {\n    bodyWidth,\n    fixedTableHeight,\n    mainTableHeight,\n    leftTableWidth,\n    rightTableWidth,\n    headerWidth,\n    rowsHeight,\n    windowHeight,\n    footerHeight,\n    emptyStyle,\n    rootStyle,\n  } = useStyles(props, {\n    columnsTotalWidth,\n    data,\n    fixedColumnsOnLeft,\n    fixedColumnsOnRight,\n  })\n  // state\n  const isScrolling = shallowRef(false)\n\n  // DOM/Component refs\n  const containerRef = ref()\n\n  const showEmpty = computed(() => {\n    const noData = unref(data).length === 0\n\n    return isArray(props.fixedData)\n      ? props.fixedData.length === 0 && noData\n      : noData\n  })\n\n  function getRowHeight(rowIndex: number) {\n    const { estimatedRowHeight, rowHeight, rowKey } = props\n\n    if (!estimatedRowHeight) return rowHeight\n\n    return (\n      unref(rowHeights)[unref(data)[rowIndex][rowKey]] || estimatedRowHeight\n    )\n  }\n\n  function onMaybeEndReached() {\n    const { onEndReached } = props\n    if (!onEndReached) return\n\n    const { scrollTop } = unref(scrollPos)\n\n    const _totalHeight = unref(rowsHeight)\n    const clientHeight = unref(windowHeight)\n\n    const heightUntilEnd =\n      _totalHeight - (scrollTop + clientHeight) + props.hScrollbarSize\n\n    if (\n      unref(lastRenderedRowIndex) >= 0 &&\n      _totalHeight !== unref(rowsHeight)\n    ) {\n      onEndReached(heightUntilEnd)\n    }\n  }\n\n  // events\n\n  watch(\n    () => props.expandedRowKeys,\n    (val) => (expandedRowKeys.value = val),\n    {\n      deep: true,\n    }\n  )\n\n  return {\n    // models\n    columns,\n    containerRef,\n    mainTableRef,\n    leftTableRef,\n    rightTableRef,\n    // states\n    isDynamic,\n    isResetting,\n    isScrolling,\n    hoveringRowKey,\n    hasFixedColumns,\n    // records\n    columnsStyles,\n    columnsTotalWidth,\n    data,\n    expandedRowKeys,\n    depthMap,\n    fixedColumnsOnLeft,\n    fixedColumnsOnRight,\n    mainColumns,\n    // metadata\n    bodyWidth,\n    emptyStyle,\n    rootStyle,\n    headerWidth,\n    footerHeight,\n    mainTableHeight,\n    fixedTableHeight,\n    leftTableWidth,\n    rightTableWidth,\n    // flags\n    showEmpty,\n\n    // methods\n    getRowHeight,\n\n    // event handlers\n    onColumnSorted,\n    onRowHovered,\n    onRowExpanded,\n    onRowsRendered,\n    onRowHeightChange,\n    // use scrollbars\n    scrollTo,\n    scrollToLeft,\n    scrollToTop,\n    scrollToRow,\n    onScroll,\n    onVerticalScroll,\n  }\n}\n\nexport { useTable }\n\nexport type UseTableReturn = ReturnType<typeof useTable>\n"]},"metadata":{},"sourceType":"module"}