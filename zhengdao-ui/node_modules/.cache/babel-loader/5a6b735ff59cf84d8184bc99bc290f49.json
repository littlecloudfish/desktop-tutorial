{"ast":null,"code":"import \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/es.error.to-string.js\";\nimport \"core-js/modules/es.date.to-string.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.every.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport { computed, watch } from 'vue';\nimport '../../../../utils/index.mjs';\nimport { CHECKED_CHANGE_EVENT } from '../transfer-panel.mjs';\nimport { usePropsAlias } from './use-props-alias.mjs';\nimport { isFunction } from '@vue/shared';\n\nvar useCheck = function useCheck(props, panelState, emit) {\n  var propsAlias = usePropsAlias(props);\n  var filteredData = computed(function () {\n    return props.data.filter(function (item) {\n      if (isFunction(props.filterMethod)) {\n        return props.filterMethod(panelState.query, item);\n      } else {\n        var label = String(item[propsAlias.value.label] || item[propsAlias.value.key]);\n        return label.toLowerCase().includes(panelState.query.toLowerCase());\n      }\n    });\n  });\n  var checkableData = computed(function () {\n    return filteredData.value.filter(function (item) {\n      return !item[propsAlias.value.disabled];\n    });\n  });\n  var checkedSummary = computed(function () {\n    var checkedLength = panelState.checked.length;\n    var dataLength = props.data.length;\n    var _props$format = props.format,\n        noChecked = _props$format.noChecked,\n        hasChecked = _props$format.hasChecked;\n\n    if (noChecked && hasChecked) {\n      return checkedLength > 0 ? hasChecked.replace(/\\${checked}/g, checkedLength.toString()).replace(/\\${total}/g, dataLength.toString()) : noChecked.replace(/\\${total}/g, dataLength.toString());\n    } else {\n      return \"\".concat(checkedLength, \"/\").concat(dataLength);\n    }\n  });\n  var isIndeterminate = computed(function () {\n    var checkedLength = panelState.checked.length;\n    return checkedLength > 0 && checkedLength < checkableData.value.length;\n  });\n\n  var updateAllChecked = function updateAllChecked() {\n    var checkableDataKeys = checkableData.value.map(function (item) {\n      return item[propsAlias.value.key];\n    });\n    panelState.allChecked = checkableDataKeys.length > 0 && checkableDataKeys.every(function (item) {\n      return panelState.checked.includes(item);\n    });\n  };\n\n  var handleAllCheckedChange = function handleAllCheckedChange(value) {\n    panelState.checked = value ? checkableData.value.map(function (item) {\n      return item[propsAlias.value.key];\n    }) : [];\n  };\n\n  watch(function () {\n    return panelState.checked;\n  }, function (val, oldVal) {\n    updateAllChecked();\n\n    if (panelState.checkChangeByUser) {\n      var movedKeys = val.concat(oldVal).filter(function (v) {\n        return !val.includes(v) || !oldVal.includes(v);\n      });\n      emit(CHECKED_CHANGE_EVENT, val, movedKeys);\n    } else {\n      emit(CHECKED_CHANGE_EVENT, val);\n      panelState.checkChangeByUser = true;\n    }\n  });\n  watch(checkableData, function () {\n    updateAllChecked();\n  });\n  watch(function () {\n    return props.data;\n  }, function () {\n    var checked = [];\n    var filteredDataKeys = filteredData.value.map(function (item) {\n      return item[propsAlias.value.key];\n    });\n    panelState.checked.forEach(function (item) {\n      if (filteredDataKeys.includes(item)) {\n        checked.push(item);\n      }\n    });\n    panelState.checkChangeByUser = false;\n    panelState.checked = checked;\n  });\n  watch(function () {\n    return props.defaultChecked;\n  }, function (val, oldVal) {\n    if (oldVal && val.length === oldVal.length && val.every(function (item) {\n      return oldVal.includes(item);\n    })) return;\n    var checked = [];\n    var checkableDataKeys = checkableData.value.map(function (item) {\n      return item[propsAlias.value.key];\n    });\n    val.forEach(function (item) {\n      if (checkableDataKeys.includes(item)) {\n        checked.push(item);\n      }\n    });\n    panelState.checkChangeByUser = false;\n    panelState.checked = checked;\n  }, {\n    immediate: true\n  });\n  return {\n    filteredData: filteredData,\n    checkableData: checkableData,\n    checkedSummary: checkedSummary,\n    isIndeterminate: isIndeterminate,\n    updateAllChecked: updateAllChecked,\n    handleAllCheckedChange: handleAllCheckedChange\n  };\n};\n\nexport { useCheck };","map":{"version":3,"mappings":"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","names":["useCheck","props","panelState","emit","propsAlias","usePropsAlias","filteredData","computed","data","filter","item","isFunction","filterMethod","query","label","String","value","key","toLowerCase","includes","checkableData","disabled","checkedSummary","checkedLength","checked","length","dataLength","format","noChecked","hasChecked","replace","toString","isIndeterminate","updateAllChecked","checkableDataKeys","map","allChecked","every","handleAllCheckedChange","watch","val","oldVal","checkChangeByUser","movedKeys","concat","v","CHECKED_CHANGE_EVENT","filteredDataKeys","forEach","push","defaultChecked","immediate"],"sources":["../../../../../../../packages/components/transfer/src/composables/use-check.ts"],"sourcesContent":["import { computed, watch } from 'vue'\nimport { isFunction } from '@element-plus/utils'\nimport { CHECKED_CHANGE_EVENT } from '../transfer-panel'\nimport { usePropsAlias } from './use-props-alias'\n\nimport type { SetupContext } from 'vue'\nimport type { CheckboxValueType } from '@element-plus/components/checkbox'\nimport type { TransferKey } from '../transfer'\nimport type {\n  TransferPanelEmits,\n  TransferPanelProps,\n  TransferPanelState,\n} from '../transfer-panel'\n\nexport const useCheck = (\n  props: TransferPanelProps,\n  panelState: TransferPanelState,\n  emit: SetupContext<TransferPanelEmits>['emit']\n) => {\n  const propsAlias = usePropsAlias(props)\n\n  const filteredData = computed(() => {\n    return props.data.filter((item) => {\n      if (isFunction(props.filterMethod)) {\n        return props.filterMethod(panelState.query, item)\n      } else {\n        const label = String(\n          item[propsAlias.value.label] || item[propsAlias.value.key]\n        )\n        return label.toLowerCase().includes(panelState.query.toLowerCase())\n      }\n    })\n  })\n\n  const checkableData = computed(() =>\n    filteredData.value.filter((item) => !item[propsAlias.value.disabled])\n  )\n\n  const checkedSummary = computed(() => {\n    const checkedLength = panelState.checked.length\n    const dataLength = props.data.length\n    const { noChecked, hasChecked } = props.format\n\n    if (noChecked && hasChecked) {\n      return checkedLength > 0\n        ? hasChecked\n            .replace(/\\${checked}/g, checkedLength.toString())\n            .replace(/\\${total}/g, dataLength.toString())\n        : noChecked.replace(/\\${total}/g, dataLength.toString())\n    } else {\n      return `${checkedLength}/${dataLength}`\n    }\n  })\n\n  const isIndeterminate = computed(() => {\n    const checkedLength = panelState.checked.length\n    return checkedLength > 0 && checkedLength < checkableData.value.length\n  })\n\n  const updateAllChecked = () => {\n    const checkableDataKeys = checkableData.value.map(\n      (item) => item[propsAlias.value.key]\n    )\n    panelState.allChecked =\n      checkableDataKeys.length > 0 &&\n      checkableDataKeys.every((item) => panelState.checked.includes(item))\n  }\n\n  const handleAllCheckedChange = (value: CheckboxValueType) => {\n    panelState.checked = value\n      ? checkableData.value.map((item) => item[propsAlias.value.key])\n      : []\n  }\n\n  watch(\n    () => panelState.checked,\n    (val, oldVal) => {\n      updateAllChecked()\n\n      if (panelState.checkChangeByUser) {\n        const movedKeys = val\n          .concat(oldVal)\n          .filter((v) => !val.includes(v) || !oldVal.includes(v))\n        emit(CHECKED_CHANGE_EVENT, val, movedKeys)\n      } else {\n        emit(CHECKED_CHANGE_EVENT, val)\n        panelState.checkChangeByUser = true\n      }\n    }\n  )\n\n  watch(checkableData, () => {\n    updateAllChecked()\n  })\n\n  watch(\n    () => props.data,\n    () => {\n      const checked: TransferKey[] = []\n      const filteredDataKeys = filteredData.value.map(\n        (item) => item[propsAlias.value.key]\n      )\n      panelState.checked.forEach((item) => {\n        if (filteredDataKeys.includes(item)) {\n          checked.push(item)\n        }\n      })\n      panelState.checkChangeByUser = false\n      panelState.checked = checked\n    }\n  )\n\n  watch(\n    () => props.defaultChecked,\n    (val, oldVal) => {\n      if (\n        oldVal &&\n        val.length === oldVal.length &&\n        val.every((item) => oldVal.includes(item))\n      )\n        return\n\n      const checked: TransferKey[] = []\n      const checkableDataKeys = checkableData.value.map(\n        (item) => item[propsAlias.value.key]\n      )\n\n      val.forEach((item) => {\n        if (checkableDataKeys.includes(item)) {\n          checked.push(item)\n        }\n      })\n      panelState.checkChangeByUser = false\n      panelState.checked = checked\n    },\n    {\n      immediate: true,\n    }\n  )\n\n  return {\n    filteredData,\n    checkableData,\n    checkedSummary,\n    isIndeterminate,\n    updateAllChecked,\n    handleAllCheckedChange,\n  }\n}\n"]},"metadata":{},"sourceType":"module"}