{"ast":null,"code":"import \"core-js/modules/es.typed-array.at.js\";\nimport \"core-js/modules/es.typed-array.set.js\";\nimport \"core-js/modules/esnext.typed-array.find-last.js\";\nimport \"core-js/modules/esnext.typed-array.find-last-index.js\";\nimport BaseMixin from './AvBase';\n/**\n * Component props Object\n */\n\nconst props = {\n  /**\n   * prop: 'bar-width'\n   * Width of the bar in pixels.\n   * Default: 5\n   */\n  barWidth: {\n    type: Number,\n    default: 5\n  },\n\n  /**\n   * prop: 'bar-space'\n   * Space between bars.\n   * Default: 1\n   */\n  barSpace: {\n    type: Number,\n    default: 1\n  },\n\n  /**\n   * prop: 'bar-color'\n   * Bar fill color. Can be string RGB color or canvas gradients array.\n   */\n  barColor: {\n    type: [String, Array],\n    default: '#0A0AFF'\n  },\n\n  /**\n   * prop: 'caps-height'\n   * Create caps on bars with given height in pixels.\n   * If zero caps then skip creating bars.\n   * Default: 0\n   */\n  capsHeight: {\n    type: Number,\n    default: 0\n  },\n\n  /**\n   * prop: 'caps-drop-speed'\n   * Caps drop down animation speed.\n   * Default: 0.9\n   */\n  capsDropSpeed: {\n    type: Number,\n    default: 0.9\n  },\n\n  /**\n   * prop: 'caps-color'\n   * Caps rectangles RGB color.\n   */\n  capsColor: {\n    type: String,\n    default: '#A0A0FF'\n  },\n\n  /**\n   * prop: 'brick-height'\n   * Draw bar as bricks with set height.\n   */\n  brickHeight: {\n    type: Number,\n    default: 0\n  },\n\n  /**\n   * prop: 'brick-space'\n   * Space between bricks.\n   */\n  brickSpace: {\n    type: Number,\n    default: 1\n  },\n\n  /**\n   * prop: 'symmetric'\n   * Draw bars symmetric to canvas vertical center\n   * Default: false\n   */\n  symmetric: {\n    type: Boolean,\n    default: false\n  },\n\n  /**\n   * prop: 'fft-size'\n   * Represents the window size in samples that is used when performing\n   * a Fast Fourier Transform (FFT) to get frequency domain data.\n   * Must be power of 2 between 2^5 and 2^15\n   * Default: 1024\n   */\n  fftSize: {\n    type: Number,\n    default: 1024\n  }\n};\n/**\n * Component AvBars\n */\n\nconst AvBars = {\n  name: 'av-bars',\n  mixins: [BaseMixin],\n  props,\n\n  data() {\n    return {\n      animId: null,\n      audio: null,\n      analyser: null,\n      ctx: null,\n      audioCtx: null,\n      caps: Array.apply(null, Array(this.fftSize / 2)).map(() => 0)\n    };\n  },\n\n  methods: {\n    /**\n     * Main loop. Draws visualization.\n     */\n    mainLoop: function () {\n      const frqBits = this.analyser.frequencyBinCount;\n      const data = new Uint8Array(frqBits);\n      const barWidth = this.barWidth >= this.canvWidth ? this.canvWidth : this.barWidth;\n      const step = Math.round((barWidth + this.barSpace) / frqBits * this.canvWidth);\n      const barFill = Array.isArray(this.barColor) ? this.fillGradient(this.barColor) : this.barColor;\n      let x = 0;\n      this.analyser.getByteFrequencyData(data);\n\n      this._fillCanvasBG();\n\n      data.forEach((_, index) => {\n        if (index % step) return;\n        const bits = Math.round(data.slice(index, index + step).reduce((v, t) => t + v, 0) / step);\n        const barHeight = bits / 255 * this.canvHeight;\n\n        if (this.capsHeight) {\n          this._drawCap(index, barWidth, x, bits);\n        }\n\n        this.ctx.fillStyle = barFill;\n\n        this._drawBar(barWidth, barHeight, x);\n\n        x += barWidth + this.barSpace;\n      });\n      this.animId = requestAnimationFrame(this.mainLoop);\n    },\n\n    /**\n     * Canvas background fill\n     * @private\n     */\n    _fillCanvasBG: function () {\n      const w = this.canvWidth;\n      const h = this.canvHeight;\n      this.ctx.clearRect(0, 0, w, h);\n\n      if (this.canvFillColor) {\n        this.ctx.fillStyle = Array.isArray(this.canvFillColor) ? this.fillGradient(this.canvFillColor) : this.canvFillColor;\n        this.ctx.fillRect(0, 0, w, h);\n      }\n    },\n\n    /**\n     * Draw bar. Solid bar or brick bar.\n     * @private\n     */\n    _drawBar: function (barWidth, barHeight, barX) {\n      if (this.brickHeight) {\n        this._drawBrickBar(barWidth, barHeight, barX);\n      } else {\n        this.ctx.fillRect(barX, this.canvHeight - barHeight - this._symAlign(barHeight), barWidth, barHeight);\n      }\n    },\n\n    /**\n     * Draw bricks bar.\n     * @private\n     */\n    _drawBrickBar: function (barWidth, barHeight, barX) {\n      for (let b = 0; b < barHeight; b += this.brickHeight + this.brickSpace) {\n        this.ctx.fillRect(barX, this.canvHeight - barHeight + b - this._symAlign(barHeight), barWidth, this.brickHeight);\n      }\n    },\n\n    /**\n     * Draw cap for each bar and animate caps falling down.\n     * @private\n     */\n    _drawCap: function (index, barwidth, barX, barY) {\n      const cap = this.caps[index] <= barY ? barY : this.caps[index] - this.capsDropSpeed;\n      const y = cap / 255.0 * this.canvHeight;\n\n      const capY = this.canvHeight - y - this.capsHeight - this._symAlign(y);\n\n      this.ctx.fillStyle = this.capsColor;\n      this.ctx.fillRect(barX, capY, barwidth, this.capsHeight);\n\n      if (this.symmetric) {\n        this.ctx.fillRect(barX, this.canvHeight - capY - this.capsHeight, barwidth, this.capsHeight);\n      }\n\n      this.caps[index] = cap;\n    },\n\n    /**\n     * Shift for symmetric alignment\n     * @private\n     */\n    _symAlign: function (barHeight) {\n      return this.symmetric ? (this.canvHeight - barHeight) / 2 : 0;\n    }\n  }\n};\nexport default AvBars;","map":{"version":3,"names":["BaseMixin","props","barWidth","type","Number","default","barSpace","barColor","String","Array","capsHeight","capsDropSpeed","capsColor","brickHeight","brickSpace","symmetric","Boolean","fftSize","AvBars","name","mixins","data","animId","audio","analyser","ctx","audioCtx","caps","apply","map","methods","mainLoop","frqBits","frequencyBinCount","Uint8Array","canvWidth","step","Math","round","barFill","isArray","fillGradient","x","getByteFrequencyData","_fillCanvasBG","forEach","_","index","bits","slice","reduce","v","t","barHeight","canvHeight","_drawCap","fillStyle","_drawBar","requestAnimationFrame","w","h","clearRect","canvFillColor","fillRect","barX","_drawBrickBar","_symAlign","b","barwidth","barY","cap","y","capY"],"sources":["/home/little/Documents/music_web/startproj/zhengdao-ui/node_modules/vue-audio-visual/src/components/AvBars.js"],"sourcesContent":["import BaseMixin from './AvBase'\n/**\n * Component props Object\n */\nconst props = {\n  /**\n   * prop: 'bar-width'\n   * Width of the bar in pixels.\n   * Default: 5\n   */\n  barWidth: {\n    type: Number,\n    default: 5\n  },\n  /**\n   * prop: 'bar-space'\n   * Space between bars.\n   * Default: 1\n   */\n  barSpace: {\n    type: Number,\n    default: 1\n  },\n  /**\n   * prop: 'bar-color'\n   * Bar fill color. Can be string RGB color or canvas gradients array.\n   */\n  barColor: {\n    type: [String, Array],\n    default: '#0A0AFF'\n  },\n  /**\n   * prop: 'caps-height'\n   * Create caps on bars with given height in pixels.\n   * If zero caps then skip creating bars.\n   * Default: 0\n   */\n  capsHeight: {\n    type: Number,\n    default: 0\n  },\n  /**\n   * prop: 'caps-drop-speed'\n   * Caps drop down animation speed.\n   * Default: 0.9\n   */\n  capsDropSpeed: {\n    type: Number,\n    default: 0.9\n  },\n  /**\n   * prop: 'caps-color'\n   * Caps rectangles RGB color.\n   */\n  capsColor: {\n    type: String,\n    default: '#A0A0FF'\n  },\n  /**\n   * prop: 'brick-height'\n   * Draw bar as bricks with set height.\n   */\n  brickHeight: {\n    type: Number,\n    default: 0\n  },\n  /**\n   * prop: 'brick-space'\n   * Space between bricks.\n   */\n  brickSpace: {\n    type: Number,\n    default: 1\n  },\n  /**\n   * prop: 'symmetric'\n   * Draw bars symmetric to canvas vertical center\n   * Default: false\n   */\n  symmetric: {\n    type: Boolean,\n    default: false\n  },\n  /**\n   * prop: 'fft-size'\n   * Represents the window size in samples that is used when performing\n   * a Fast Fourier Transform (FFT) to get frequency domain data.\n   * Must be power of 2 between 2^5 and 2^15\n   * Default: 1024\n   */\n  fftSize: {\n    type: Number,\n    default: 1024\n  }\n}\n\n/**\n * Component AvBars\n */\nconst AvBars = {\n  name: 'av-bars',\n  mixins: [ BaseMixin ],\n  props,\n  data () {\n    return {\n      animId: null,\n      audio: null,\n      analyser: null,\n      ctx: null,\n      audioCtx: null,\n      caps: Array.apply(null, Array(this.fftSize / 2)).map(() => 0)\n    }\n  },\n  methods: {\n    /**\n     * Main loop. Draws visualization.\n     */\n    mainLoop: function () {\n      const frqBits = this.analyser.frequencyBinCount\n      const data = new Uint8Array(frqBits)\n      const barWidth = this.barWidth >= this.canvWidth ? this.canvWidth : this.barWidth\n      const step = Math.round((barWidth + this.barSpace) / frqBits * this.canvWidth)\n      const barFill = Array.isArray(this.barColor)\n        ? this.fillGradient(this.barColor)\n        : this.barColor\n      let x = 0\n\n      this.analyser.getByteFrequencyData(data)\n      this._fillCanvasBG()\n\n      data.forEach((_, index) => {\n        if (index % step) return\n        const bits = Math.round(data.slice(index, index + step)\n          .reduce((v, t) => t + v, 0) / step)\n        const barHeight = bits / 255 * this.canvHeight\n        if (this.capsHeight) {\n          this._drawCap(index, barWidth, x, bits)\n        }\n        this.ctx.fillStyle = barFill\n        this._drawBar(barWidth, barHeight, x)\n        x += barWidth + this.barSpace\n      })\n      this.animId = requestAnimationFrame(this.mainLoop)\n    },\n    /**\n     * Canvas background fill\n     * @private\n     */\n    _fillCanvasBG: function () {\n      const w = this.canvWidth\n      const h = this.canvHeight\n      this.ctx.clearRect(0, 0, w, h)\n      if (this.canvFillColor) {\n        this.ctx.fillStyle = Array.isArray(this.canvFillColor)\n          ? this.fillGradient(this.canvFillColor)\n          : this.canvFillColor\n        this.ctx.fillRect(0, 0, w, h)\n      }\n    },\n    /**\n     * Draw bar. Solid bar or brick bar.\n     * @private\n     */\n    _drawBar: function (barWidth, barHeight, barX) {\n      if (this.brickHeight) {\n        this._drawBrickBar(barWidth, barHeight, barX)\n      } else {\n        this.ctx.fillRect(\n          barX, this.canvHeight - barHeight - this._symAlign(barHeight),\n          barWidth, barHeight\n        )\n      }\n    },\n    /**\n     * Draw bricks bar.\n     * @private\n     */\n    _drawBrickBar: function (barWidth, barHeight, barX) {\n      for (let b = 0; b < barHeight; b += this.brickHeight + this.brickSpace) {\n        this.ctx.fillRect(\n          barX, this.canvHeight - barHeight + b - this._symAlign(barHeight),\n          barWidth, this.brickHeight\n        )\n      }\n    },\n    /**\n     * Draw cap for each bar and animate caps falling down.\n     * @private\n     */\n    _drawCap: function (index, barwidth, barX, barY) {\n      const cap = this.caps[index] <= barY\n        ? barY\n        : this.caps[index] - this.capsDropSpeed\n      const y = (cap / 255.0 * this.canvHeight)\n      const capY = this.canvHeight - y - this.capsHeight - this._symAlign(y)\n      this.ctx.fillStyle = this.capsColor\n      this.ctx.fillRect(barX, capY, barwidth, this.capsHeight)\n      if (this.symmetric) {\n        this.ctx.fillRect(\n          barX, this.canvHeight - capY - this.capsHeight,\n          barwidth, this.capsHeight)\n      }\n      this.caps[index] = cap\n    },\n    /**\n     * Shift for symmetric alignment\n     * @private\n     */\n    _symAlign: function (barHeight) {\n      return this.symmetric ? ((this.canvHeight - barHeight) / 2) : 0\n    }\n  }\n}\n\nexport default AvBars\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}