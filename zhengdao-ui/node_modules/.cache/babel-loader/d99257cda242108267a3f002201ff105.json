{"ast":null,"code":"import _toConsumableArray from \"/home/little/Documents/music_web/backandfrontsep/zhengdao-ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.set.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.array.is-array.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport { ref, computed, unref, watch } from 'vue';\n\nvar useData = function useData(props, _ref) {\n  var expandedRowKeys = _ref.expandedRowKeys,\n      lastRenderedRowIndex = _ref.lastRenderedRowIndex,\n      resetAfterIndex = _ref.resetAfterIndex;\n  var depthMap = ref({});\n  var flattenedData = computed(function () {\n    var depths = {};\n    var data2 = props.data,\n        rowKey = props.rowKey;\n\n    var _expandedRowKeys = unref(expandedRowKeys);\n\n    if (!_expandedRowKeys || !_expandedRowKeys.length) return data2;\n    var array = [];\n    var keysSet = /* @__PURE__ */new Set();\n\n    _expandedRowKeys.forEach(function (x) {\n      return keysSet.add(x);\n    });\n\n    var copy = data2.slice();\n    copy.forEach(function (x) {\n      return depths[x[rowKey]] = 0;\n    });\n\n    var _loop = function _loop() {\n      var item = copy.shift();\n      array.push(item);\n\n      if (keysSet.has(item[rowKey]) && Array.isArray(item.children) && item.children.length > 0) {\n        copy = [].concat(_toConsumableArray(item.children), _toConsumableArray(copy));\n        item.children.forEach(function (child) {\n          return depths[child[rowKey]] = depths[item[rowKey]] + 1;\n        });\n      }\n    };\n\n    while (copy.length > 0) {\n      _loop();\n    }\n\n    depthMap.value = depths;\n    return array;\n  });\n  var data = computed(function () {\n    var data2 = props.data,\n        expandColumnKey = props.expandColumnKey;\n    return expandColumnKey ? unref(flattenedData) : data2;\n  });\n  watch(data, function (val, prev) {\n    if (val !== prev) {\n      lastRenderedRowIndex.value = -1;\n      resetAfterIndex(0, true);\n    }\n  });\n  return {\n    data: data,\n    depthMap: depthMap\n  };\n};\n\nexport { useData };","map":{"version":3,"mappings":";;;;;;;;;;;;AACY,IAACA,OAAO,GAAG,SAAVA,OAAU,CAACC,KAAD,QAAuE;EAAA,IAA7DC,eAA6D,QAA7DA,eAA6D;EAAA,IAA5CC,oBAA4C,QAA5CA,oBAA4C;EAAA,IAAtBC,eAAsB,QAAtBA,eAAsB;EAC5F,IAAMC,QAAQ,GAAGC,GAAG,CAAC,EAAD,CAApB;EACA,IAAMC,aAAa,GAAGC,QAAQ,CAAC,YAAM;IACnC,IAAMC,MAAM,GAAG,EAAf;IACA,IAAcC,KAAd,GAAgCT,KAAhC,CAAQU,IAAR;IAAA,IAAqBC,MAArB,GAAgCX,KAAhC,CAAqBW,MAArB;;IACA,IAAMC,gBAAgB,GAAGC,KAAK,CAACZ,eAAD,CAA9B;;IACA,IAAI,CAACW,gBAAD,IAAqB,CAACA,gBAAgB,CAACE,MAA3C,EACE,OAAOL,KAAP;IACF,IAAMM,KAAK,GAAG,EAAd;IACA,IAAMC,OAAO,kBAAmB,IAAIC,GAAJ,EAAhC;;IACAL,gBAAgB,CAACM,OAAjB,CAAyB,UAACC,CAAD;MAAA,OAAOH,OAAO,CAACI,GAAR,CAAYD,CAAZ,CAAP;IAAA,CAAzB;;IACA,IAAIE,IAAI,GAAGZ,KAAK,CAACa,KAAN,EAAX;IACAD,IAAI,CAACH,OAAL,CAAa,UAACC,CAAD;MAAA,OAAOX,MAAM,CAACW,CAAC,CAACR,MAAD,CAAF,CAAN,GAAoB,CAA3B;IAAA,CAAb;;IAVmC;MAYjC,IAAMY,IAAI,GAAGF,IAAI,CAACG,KAAL,EAAb;MACAT,KAAK,CAACU,IAAN,CAAWF,IAAX;;MACA,IAAIP,OAAO,CAACU,GAAR,CAAYH,IAAI,CAACZ,MAAD,CAAhB,KAA6BgB,KAAK,CAACC,OAAN,CAAcL,IAAI,CAACM,QAAnB,CAA7B,IAA6DN,IAAI,CAACM,QAAL,CAAcf,MAAd,GAAuB,CAAxF,EAA2F;QACzFO,IAAI,gCAAOE,IAAI,CAACM,QAAZ,sBAAyBR,IAAzB,EAAJ;QACAE,IAAI,CAACM,QAAL,CAAcX,OAAd,CAAsB,UAACY,KAAD;UAAA,OAAWtB,MAAM,CAACsB,KAAK,CAACnB,MAAD,CAAN,CAAN,GAAwBH,MAAM,CAACe,IAAI,CAACZ,MAAD,CAAL,CAAN,GAAuB,CAA1D;QAAA,CAAtB;MACD;IAjBgC;;IAWnC,OAAOU,IAAI,CAACP,MAAL,GAAc,CAArB,EAAwB;MAAA;IAOvB;;IACDV,QAAQ,CAAC2B,KAAT,GAAiBvB,MAAjB;IACA,OAAOO,KAAP;EACD,CArB6B,CAA9B;EAsBA,IAAML,IAAI,GAAGH,QAAQ,CAAC,YAAM;IAC1B,IAAcE,KAAd,GAAyCT,KAAzC,CAAQU,IAAR;IAAA,IAAqBsB,eAArB,GAAyChC,KAAzC,CAAqBgC,eAArB;IACA,OAAOA,eAAe,GAAGnB,KAAK,CAACP,aAAD,CAAR,GAA0BG,KAAhD;EACD,CAHoB,CAArB;EAIAwB,KAAK,CAACvB,IAAD,EAAO,UAACwB,GAAD,EAAMC,IAAN,EAAe;IACzB,IAAID,GAAG,KAAKC,IAAZ,EAAkB;MAChBjC,oBAAoB,CAAC6B,KAArB,GAA6B,CAAC,CAA9B;MACA5B,eAAe,CAAC,CAAD,EAAI,IAAJ,CAAf;IACD;EACF,CALI,CAAL;EAMA,OAAO;IACLO,IAAI,EAAJA,IADK;IAELN,QAAQ,EAARA;EAFK,CAAP;AAIF,CAtCY","names":["useData","props","expandedRowKeys","lastRenderedRowIndex","resetAfterIndex","depthMap","ref","flattenedData","computed","depths","data2","data","rowKey","_expandedRowKeys","unref","length","array","keysSet","Set","forEach","x","add","copy","slice","item","shift","push","has","Array","isArray","children","child","value","expandColumnKey","watch","val","prev"],"sources":["../../../../../../../packages/components/table-v2/src/composables/use-data.ts"],"sourcesContent":["import { computed, ref, unref, watch } from 'vue'\n\nimport type { TableV2Props } from '../table'\nimport type { KeyType } from '../types'\nimport type { UseRowReturn } from './use-row'\n\ntype UseDataProps = {\n  expandedRowKeys: UseRowReturn['expandedRowKeys']\n  lastRenderedRowIndex: UseRowReturn['lastRenderedRowIndex']\n  resetAfterIndex: UseRowReturn['resetAfterIndex']\n}\n\nexport const useData = (\n  props: TableV2Props,\n  { expandedRowKeys, lastRenderedRowIndex, resetAfterIndex }: UseDataProps\n) => {\n  const depthMap = ref<Record<KeyType, number>>({})\n\n  const flattenedData = computed(() => {\n    const depths: Record<KeyType, number> = {}\n    const { data, rowKey } = props\n\n    const _expandedRowKeys = unref(expandedRowKeys)\n\n    if (!_expandedRowKeys || !_expandedRowKeys.length) return data\n\n    const array: any[] = []\n    const keysSet = new Set()\n    _expandedRowKeys.forEach((x) => keysSet.add(x))\n\n    let copy: any[] = data.slice()\n    copy.forEach((x) => (depths[x[rowKey]] = 0))\n    while (copy.length > 0) {\n      const item = copy.shift()!\n\n      array.push(item)\n      if (\n        keysSet.has(item[rowKey]) &&\n        Array.isArray(item.children) &&\n        item.children.length > 0\n      ) {\n        copy = [...item.children, ...copy]\n        item.children.forEach(\n          (child: any) => (depths[child[rowKey]] = depths[item[rowKey]] + 1)\n        )\n      }\n    }\n\n    depthMap.value = depths\n    return array\n  })\n\n  const data = computed(() => {\n    const { data, expandColumnKey } = props\n    return expandColumnKey ? unref(flattenedData) : data\n  })\n\n  watch(data, (val, prev) => {\n    if (val !== prev) {\n      lastRenderedRowIndex.value = -1\n      resetAfterIndex(0, true)\n    }\n  })\n\n  return {\n    data,\n    depthMap,\n  }\n}\n\nexport type UseDataReturn = ReturnType<typeof useData>\n"]},"metadata":{},"sourceType":"module"}