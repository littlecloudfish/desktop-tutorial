{"ast":null,"code":"import _regeneratorRuntime from \"/home/little/Documents/music_web/startproj/zhengdao-ui/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _slicedToArray from \"/home/little/Documents/music_web/startproj/zhengdao-ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _asyncToGenerator from \"/home/little/Documents/music_web/startproj/zhengdao-ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _objectSpread from \"/home/little/Documents/music_web/startproj/zhengdao-ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"core-js/modules/es.number.parse-int.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.object.entries.js\";\nimport { nextTick } from 'vue';\nimport { isString } from '@vue/shared';\nimport { isClient } from '@vueuse/core';\nimport '../../../utils/index.mjs';\nimport '../../../hooks/index.mjs';\nimport { createLoadingComponent } from './loading.mjs';\nimport { useZIndex } from '../../../hooks/use-z-index/index.mjs';\nimport { getStyle, addClass, removeClass } from '../../../utils/dom/style.mjs';\nimport { useNamespace } from '../../../hooks/use-namespace/index.mjs';\nvar fullscreenInstance = void 0;\n\nvar Loading = function Loading() {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  if (!isClient) return void 0;\n  var resolved = resolveOptions(options);\n\n  if (resolved.fullscreen && fullscreenInstance) {\n    return fullscreenInstance;\n  }\n\n  var instance = createLoadingComponent(_objectSpread(_objectSpread({}, resolved), {}, {\n    closed: function closed() {\n      var _a;\n\n      (_a = resolved.closed) == null ? void 0 : _a.call(resolved);\n      if (resolved.fullscreen) fullscreenInstance = void 0;\n    }\n  }));\n  addStyle(resolved, resolved.parent, instance);\n  addClassList(resolved, resolved.parent, instance);\n\n  resolved.parent.vLoadingAddClassList = function () {\n    return addClassList(resolved, resolved.parent, instance);\n  };\n\n  var loadingNumber = resolved.parent.getAttribute(\"loading-number\");\n\n  if (!loadingNumber) {\n    loadingNumber = \"1\";\n  } else {\n    loadingNumber = \"\".concat(Number.parseInt(loadingNumber) + 1);\n  }\n\n  resolved.parent.setAttribute(\"loading-number\", loadingNumber);\n  resolved.parent.appendChild(instance.$el);\n  nextTick(function () {\n    return instance.visible.value = resolved.visible;\n  });\n\n  if (resolved.fullscreen) {\n    fullscreenInstance = instance;\n  }\n\n  return instance;\n};\n\nvar resolveOptions = function resolveOptions(options) {\n  var _a, _b, _c, _d;\n\n  var target;\n\n  if (isString(options.target)) {\n    target = (_a = document.querySelector(options.target)) != null ? _a : document.body;\n  } else {\n    target = options.target || document.body;\n  }\n\n  return {\n    parent: target === document.body || options.body ? document.body : target,\n    background: options.background || \"\",\n    svg: options.svg || \"\",\n    svgViewBox: options.svgViewBox || \"\",\n    spinner: options.spinner || false,\n    text: options.text || \"\",\n    fullscreen: target === document.body && ((_b = options.fullscreen) != null ? _b : true),\n    lock: (_c = options.lock) != null ? _c : false,\n    customClass: options.customClass || \"\",\n    visible: (_d = options.visible) != null ? _d : true,\n    target: target\n  };\n};\n\nvar addStyle = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(options, parent, instance) {\n    var _useZIndex, nextZIndex, maskStyle, _i, _arr, property, scroll, _i2, _arr2, _property, _i3, _Object$entries, _Object$entries$_i, key, value;\n\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _useZIndex = useZIndex(), nextZIndex = _useZIndex.nextZIndex;\n            maskStyle = {};\n\n            if (!options.fullscreen) {\n              _context.next = 8;\n              break;\n            }\n\n            instance.originalPosition.value = getStyle(document.body, \"position\");\n            instance.originalOverflow.value = getStyle(document.body, \"overflow\");\n            maskStyle.zIndex = nextZIndex();\n            _context.next = 17;\n            break;\n\n          case 8:\n            if (!(options.parent === document.body)) {\n              _context.next = 16;\n              break;\n            }\n\n            instance.originalPosition.value = getStyle(document.body, \"position\");\n            _context.next = 12;\n            return nextTick();\n\n          case 12:\n            for (_i = 0, _arr = [\"top\", \"left\"]; _i < _arr.length; _i++) {\n              property = _arr[_i];\n              scroll = property === \"top\" ? \"scrollTop\" : \"scrollLeft\";\n              maskStyle[property] = \"\".concat(options.target.getBoundingClientRect()[property] + document.body[scroll] + document.documentElement[scroll] - Number.parseInt(getStyle(document.body, \"margin-\".concat(property)), 10), \"px\");\n            }\n\n            for (_i2 = 0, _arr2 = [\"height\", \"width\"]; _i2 < _arr2.length; _i2++) {\n              _property = _arr2[_i2];\n              maskStyle[_property] = \"\".concat(options.target.getBoundingClientRect()[_property], \"px\");\n            }\n\n            _context.next = 17;\n            break;\n\n          case 16:\n            instance.originalPosition.value = getStyle(parent, \"position\");\n\n          case 17:\n            for (_i3 = 0, _Object$entries = Object.entries(maskStyle); _i3 < _Object$entries.length; _i3++) {\n              _Object$entries$_i = _slicedToArray(_Object$entries[_i3], 2), key = _Object$entries$_i[0], value = _Object$entries$_i[1];\n              instance.$el.style[key] = value;\n            }\n\n          case 18:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function addStyle(_x, _x2, _x3) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar addClassList = function addClassList(options, parent, instance) {\n  var ns = useNamespace(\"loading\");\n\n  if (instance.originalPosition.value !== \"absolute\" && instance.originalPosition.value !== \"fixed\") {\n    addClass(parent, ns.bm(\"parent\", \"relative\"));\n  } else {\n    removeClass(parent, ns.bm(\"parent\", \"relative\"));\n  }\n\n  if (options.fullscreen && options.lock) {\n    addClass(parent, ns.bm(\"parent\", \"hidden\"));\n  } else {\n    removeClass(parent, ns.bm(\"parent\", \"hidden\"));\n  }\n};\n\nexport { Loading };","map":{"version":3,"mappings":"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","names":["fullscreenInstance","Loading","options","isClient","resolved","resolveOptions","fullscreen","instance","createLoadingComponent","closed","_a","call","addStyle","parent","addClassList","vLoadingAddClassList","loadingNumber","getAttribute","Number","parseInt","setAttribute","appendChild","$el","nextTick","visible","value","_b","_c","_d","target","isString","document","querySelector","body","background","svg","svgViewBox","spinner","text","lock","customClass","useZIndex","nextZIndex","maskStyle","originalPosition","getStyle","originalOverflow","zIndex","property","scroll","getBoundingClientRect","documentElement","Object","entries","key","style","ns","useNamespace","addClass","bm","removeClass"],"sources":["../../../../../../packages/components/loading/src/service.ts"],"sourcesContent":["// @ts-nocheck\nimport { nextTick } from 'vue'\nimport { isString } from '@vue/shared'\nimport { isClient } from '@vueuse/core'\nimport { addClass, getStyle, removeClass } from '@element-plus/utils'\nimport { useNamespace, useZIndex } from '@element-plus/hooks'\nimport { createLoadingComponent } from './loading'\nimport type { LoadingInstance } from './loading'\nimport type { LoadingOptionsResolved } from '..'\nimport type { LoadingOptions } from './types'\nimport type { CSSProperties } from 'vue'\n\nlet fullscreenInstance: LoadingInstance | undefined = undefined\n\nexport const Loading = function (\n  options: LoadingOptions = {}\n): LoadingInstance {\n  if (!isClient) return undefined as any\n\n  const resolved = resolveOptions(options)\n\n  if (resolved.fullscreen && fullscreenInstance) {\n    return fullscreenInstance\n  }\n\n  const instance = createLoadingComponent({\n    ...resolved,\n    closed: () => {\n      resolved.closed?.()\n      if (resolved.fullscreen) fullscreenInstance = undefined\n    },\n  })\n\n  addStyle(resolved, resolved.parent, instance)\n  addClassList(resolved, resolved.parent, instance)\n\n  resolved.parent.vLoadingAddClassList = () =>\n    addClassList(resolved, resolved.parent, instance)\n\n  /**\n   * add loading-number to parent.\n   * because if a fullscreen loading is triggered when somewhere\n   * a v-loading.body was triggered before and it's parent is\n   * document.body which with a margin , the fullscreen loading's\n   * destroySelf function will remove 'el-loading-parent--relative',\n   * and then the position of v-loading.body will be error.\n   */\n  let loadingNumber: string | null =\n    resolved.parent.getAttribute('loading-number')\n  if (!loadingNumber) {\n    loadingNumber = '1'\n  } else {\n    loadingNumber = `${Number.parseInt(loadingNumber) + 1}`\n  }\n  resolved.parent.setAttribute('loading-number', loadingNumber)\n\n  resolved.parent.appendChild(instance.$el)\n\n  // after instance render, then modify visible to trigger transition\n  nextTick(() => (instance.visible.value = resolved.visible))\n\n  if (resolved.fullscreen) {\n    fullscreenInstance = instance\n  }\n  return instance\n}\n\nconst resolveOptions = (options: LoadingOptions): LoadingOptionsResolved => {\n  let target: HTMLElement\n  if (isString(options.target)) {\n    target =\n      document.querySelector<HTMLElement>(options.target) ?? document.body\n  } else {\n    target = options.target || document.body\n  }\n  return {\n    parent: target === document.body || options.body ? document.body : target,\n    background: options.background || '',\n    svg: options.svg || '',\n    svgViewBox: options.svgViewBox || '',\n    spinner: options.spinner || false,\n    text: options.text || '',\n    fullscreen: target === document.body && (options.fullscreen ?? true),\n    lock: options.lock ?? false,\n    customClass: options.customClass || '',\n    visible: options.visible ?? true,\n    target,\n  }\n}\n\nconst addStyle = async (\n  options: LoadingOptionsResolved,\n  parent: HTMLElement,\n  instance: LoadingInstance\n) => {\n  const { nextZIndex } = useZIndex()\n\n  const maskStyle: CSSProperties = {}\n  if (options.fullscreen) {\n    instance.originalPosition.value = getStyle(document.body, 'position')\n    instance.originalOverflow.value = getStyle(document.body, 'overflow')\n    maskStyle.zIndex = nextZIndex()\n  } else if (options.parent === document.body) {\n    instance.originalPosition.value = getStyle(document.body, 'position')\n    /**\n     * await dom render when visible is true in init,\n     * because some component's height maybe 0.\n     * e.g. el-table.\n     */\n    await nextTick()\n    for (const property of ['top', 'left']) {\n      const scroll = property === 'top' ? 'scrollTop' : 'scrollLeft'\n      maskStyle[property] = `${\n        (options.target as HTMLElement).getBoundingClientRect()[property] +\n        document.body[scroll] +\n        document.documentElement[scroll] -\n        Number.parseInt(getStyle(document.body, `margin-${property}`), 10)\n      }px`\n    }\n    for (const property of ['height', 'width']) {\n      maskStyle[property] = `${\n        (options.target as HTMLElement).getBoundingClientRect()[property]\n      }px`\n    }\n  } else {\n    instance.originalPosition.value = getStyle(parent, 'position')\n  }\n  for (const [key, value] of Object.entries(maskStyle)) {\n    instance.$el.style[key] = value\n  }\n}\n\nconst addClassList = (\n  options: LoadingOptions,\n  parent: HTMLElement,\n  instance: LoadingInstance\n) => {\n  const ns = useNamespace('loading')\n\n  if (\n    instance.originalPosition.value !== 'absolute' &&\n    instance.originalPosition.value !== 'fixed'\n  ) {\n    addClass(parent, ns.bm('parent', 'relative'))\n  } else {\n    removeClass(parent, ns.bm('parent', 'relative'))\n  }\n  if (options.fullscreen && options.lock) {\n    addClass(parent, ns.bm('parent', 'hidden'))\n  } else {\n    removeClass(parent, ns.bm('parent', 'hidden'))\n  }\n}\n"]},"metadata":{},"sourceType":"module"}