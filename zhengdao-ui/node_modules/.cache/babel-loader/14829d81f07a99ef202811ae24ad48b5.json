{"ast":null,"code":"import _objectSpread from \"/home/little/Documents/music_web/backandfrontsep/zhengdao-ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.fixed.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.reduce.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport { computed, unref } from 'vue';\nimport '../../../../utils/index.mjs';\nimport { SortOrder, oppositeOrderMap } from '../constants.mjs';\nimport { placeholderSign } from '../private.mjs';\nimport { calcColumnStyle } from './utils.mjs';\nimport { isObject } from '@vue/shared';\n\nfunction useColumns(props, columns, fixed) {\n  var visibleColumns = computed(function () {\n    return unref(columns).filter(function (column) {\n      return !column.hidden;\n    });\n  });\n  var fixedColumnsOnLeft = computed(function () {\n    return unref(visibleColumns).filter(function (column) {\n      return column.fixed === \"left\" || column.fixed === true;\n    });\n  });\n  var fixedColumnsOnRight = computed(function () {\n    return unref(visibleColumns).filter(function (column) {\n      return column.fixed === \"right\";\n    });\n  });\n  var normalColumns = computed(function () {\n    return unref(visibleColumns).filter(function (column) {\n      return !column.fixed;\n    });\n  });\n  var mainColumns = computed(function () {\n    var ret = [];\n    unref(fixedColumnsOnLeft).forEach(function (column) {\n      ret.push(_objectSpread(_objectSpread({}, column), {}, {\n        placeholderSign: placeholderSign\n      }));\n    });\n    unref(normalColumns).forEach(function (column) {\n      ret.push(column);\n    });\n    unref(fixedColumnsOnRight).forEach(function (column) {\n      ret.push(_objectSpread(_objectSpread({}, column), {}, {\n        placeholderSign: placeholderSign\n      }));\n    });\n    return ret;\n  });\n  var hasFixedColumns = computed(function () {\n    return unref(fixedColumnsOnLeft).length || unref(fixedColumnsOnRight).length;\n  });\n  var columnsStyles = computed(function () {\n    var _columns = unref(columns);\n\n    return _columns.reduce(function (style, column) {\n      style[column.key] = calcColumnStyle(column, unref(fixed), props.fixed);\n      return style;\n    }, {});\n  });\n  var columnsTotalWidth = computed(function () {\n    return unref(visibleColumns).reduce(function (width, column) {\n      return width + column.width;\n    }, 0);\n  });\n\n  var getColumn = function getColumn(key) {\n    return unref(columns).find(function (column) {\n      return column.key === key;\n    });\n  };\n\n  var getColumnStyle = function getColumnStyle(key) {\n    return unref(columnsStyles)[key];\n  };\n\n  var updateColumnWidth = function updateColumnWidth(column, width) {\n    column.width = width;\n  };\n\n  function onColumnSorted(e) {\n    var _a;\n\n    var key = e.currentTarget.dataset.key;\n    if (!key) return;\n    var sortState = props.sortState,\n        sortBy = props.sortBy;\n    var order = SortOrder.ASC;\n\n    if (isObject(sortState)) {\n      order = oppositeOrderMap[sortState[key]];\n    } else {\n      order = oppositeOrderMap[sortBy.order];\n    }\n\n    (_a = props.onColumnSort) == null ? void 0 : _a.call(props, {\n      column: getColumn(key),\n      key: key,\n      order: order\n    });\n  }\n\n  return {\n    columns: columns,\n    columnsStyles: columnsStyles,\n    columnsTotalWidth: columnsTotalWidth,\n    fixedColumnsOnLeft: fixedColumnsOnLeft,\n    fixedColumnsOnRight: fixedColumnsOnRight,\n    hasFixedColumns: hasFixedColumns,\n    mainColumns: mainColumns,\n    normalColumns: normalColumns,\n    visibleColumns: visibleColumns,\n    getColumn: getColumn,\n    getColumnStyle: getColumnStyle,\n    updateColumnWidth: updateColumnWidth,\n    onColumnSorted: onColumnSorted\n  };\n}\n\nexport { useColumns };","map":{"version":3,"mappings":"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","names":["useColumns","props","columns","fixed","visibleColumns","computed","unref","filter","column","hidden","fixedColumnsOnLeft","fixedColumnsOnRight","normalColumns","mainColumns","ret","forEach","push","placeholderSign","hasFixedColumns","length","columnsStyles","_columns","reduce","style","key","calcColumnStyle","columnsTotalWidth","width","getColumn","find","getColumnStyle","updateColumnWidth","onColumnSorted","e","_a","currentTarget","dataset","sortState","sortBy","order","SortOrder","ASC","isObject","oppositeOrderMap","onColumnSort","call"],"sources":["../../../../../../../packages/components/table-v2/src/composables/use-columns.ts"],"sourcesContent":["// @ts-nocheck\nimport { computed, unref } from 'vue'\nimport { isObject } from '@element-plus/utils'\nimport { SortOrder, oppositeOrderMap } from '../constants'\nimport { placeholderSign } from '../private'\nimport { calcColumnStyle } from './utils'\n\nimport type { CSSProperties, Ref } from 'vue'\nimport type { TableV2Props } from '../table'\nimport type { AnyColumns, Column, KeyType } from '../types'\n\nfunction useColumns(\n  props: TableV2Props,\n  columns: Ref<AnyColumns>,\n  fixed: Ref<boolean>\n) {\n  const visibleColumns = computed(() => {\n    return unref(columns).filter((column) => !column.hidden)\n  })\n\n  const fixedColumnsOnLeft = computed(() =>\n    unref(visibleColumns).filter(\n      (column) => column.fixed === 'left' || column.fixed === true\n    )\n  )\n\n  const fixedColumnsOnRight = computed(() =>\n    unref(visibleColumns).filter((column) => column.fixed === 'right')\n  )\n\n  const normalColumns = computed(() =>\n    unref(visibleColumns).filter((column) => !column.fixed)\n  )\n\n  const mainColumns = computed(() => {\n    const ret: AnyColumns = []\n\n    unref(fixedColumnsOnLeft).forEach((column) => {\n      ret.push({\n        ...column,\n        placeholderSign,\n      })\n    })\n\n    unref(normalColumns).forEach((column) => {\n      ret.push(column)\n    })\n\n    unref(fixedColumnsOnRight).forEach((column) => {\n      ret.push({\n        ...column,\n        placeholderSign,\n      })\n    })\n\n    return ret\n  })\n\n  const hasFixedColumns = computed(() => {\n    return unref(fixedColumnsOnLeft).length || unref(fixedColumnsOnRight).length\n  })\n\n  const columnsStyles = computed(() => {\n    const _columns = unref(columns)\n\n    return _columns.reduce<Record<Column<any>['key'], CSSProperties>>(\n      (style, column) => {\n        style[column.key] = calcColumnStyle(column, unref(fixed), props.fixed)\n        return style\n      },\n      {}\n    )\n  })\n\n  const columnsTotalWidth = computed(() => {\n    return unref(visibleColumns).reduce(\n      (width, column) => width + column.width,\n      0\n    )\n  })\n\n  const getColumn = (key: KeyType) => {\n    return unref(columns).find((column) => column.key === key)\n  }\n\n  const getColumnStyle = (key: KeyType) => {\n    return unref(columnsStyles)[key]\n  }\n\n  const updateColumnWidth = (column: Column<any>, width: number) => {\n    column.width = width\n  }\n\n  function onColumnSorted(e: MouseEvent) {\n    const { key } = (e.currentTarget as HTMLElement).dataset\n    if (!key) return\n    const { sortState, sortBy } = props\n\n    let order = SortOrder.ASC\n\n    if (isObject(sortState)) {\n      order = oppositeOrderMap[sortState[key]]\n    } else {\n      order = oppositeOrderMap[sortBy.order]\n    }\n\n    props.onColumnSort?.({ column: getColumn(key)!, key, order })\n  }\n\n  return {\n    columns,\n    columnsStyles,\n    columnsTotalWidth,\n    fixedColumnsOnLeft,\n    fixedColumnsOnRight,\n    hasFixedColumns,\n    mainColumns,\n    normalColumns,\n    visibleColumns,\n\n    getColumn,\n    getColumnStyle,\n    updateColumnWidth,\n    onColumnSorted,\n  }\n}\n\nexport { useColumns }\nexport type UseColumnsReturn = ReturnType<typeof useColumns>\n"]},"metadata":{},"sourceType":"module"}