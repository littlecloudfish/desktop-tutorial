{"version":3,"file":"index.cjs.js","sources":["../node_modules/classnames/index.js","../node_modules/easy-bem/index.js","../node_modules/debounce/index.js","../node_modules/tslib/tslib.es6.js","../src/core/utils.ts","../src/core/events.ts","../src/components/service/DraggableElement.vue","../src/components/service/HandlerWrapper.vue","../src/components/service/LineWrapper.vue","../src/core/constants.ts","../src/core/service.ts","../src/core/algorithms/approximatedSize.ts","../src/core/algorithms/move.ts","../src/core/algorithms/applyTransform.ts","../src/core/algorithms/autoZoom.ts","../src/core/algorithms/defaultPosition.ts","../src/core/algorithms/defaultSize.ts","../src/core/algorithms/defaultVisibleArea.ts","../src/core/algorithms/limitBy.ts","../src/core/algorithms/manipulateImage.ts","../src/core/algorithms/rotateImage.ts","../src/core/algorithms/flipImage.ts","../src/core/algorithms/resize.ts","../src/components/handlers/SimpleHandler.vue","../src/components/lines/SimpleLine.vue","../src/components/service/BoundingBox.vue","../src/components/service/DraggableArea.vue","../src/core/image.ts","../src/components/service/PreviewResult.vue","../src/core/touch.ts","../src/components/service/TransformableImage.vue","../src/components/service/BackgroundWrapper.vue","../src/components/helpers/Preview.vue","../src/components/service/StencilPreview.vue","../src/components/stencils/RectangleStencil.vue","../src/components/stencils/CircleStencil.vue","../src/Cropper.vue","../src/core/algorithms/initStretcher.ts","../src/core/algorithms/fitCoordinates.ts","../src/core/algorithms/fitVisibleArea.ts","../src/core/algorithms/areaRestrictions.ts","../src/core/algorithms/sizeRestrictions.ts","../src/core/algorithms/positionRestrictions.ts","../src/core/algorithms/refineSizeRestrictions.ts","../src/core/algorithms/roundCoordinates.ts","../src/core/algorithms/normalizeEvent.ts","../src/core/canvas.ts","../src/core/algorithms/defaultBoundaries.ts","../src/core/algorithms/refineVisibleArea.ts","../src/core/algorithms/stencil.ts"],"sourcesContent":["/*!\n  Copyright (c) 2018 Jed Watson.\n  Licensed under the MIT License (MIT), see\n  http://jedwatson.github.io/classnames\n*/\n/* global define */\n\n(function () {\n\t'use strict';\n\n\tvar hasOwn = {}.hasOwnProperty;\n\n\tfunction classNames() {\n\t\tvar classes = [];\n\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tvar arg = arguments[i];\n\t\t\tif (!arg) continue;\n\n\t\t\tvar argType = typeof arg;\n\n\t\t\tif (argType === 'string' || argType === 'number') {\n\t\t\t\tclasses.push(arg);\n\t\t\t} else if (Array.isArray(arg)) {\n\t\t\t\tif (arg.length) {\n\t\t\t\t\tvar inner = classNames.apply(null, arg);\n\t\t\t\t\tif (inner) {\n\t\t\t\t\t\tclasses.push(inner);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (argType === 'object') {\n\t\t\t\tif (arg.toString === Object.prototype.toString) {\n\t\t\t\t\tfor (var key in arg) {\n\t\t\t\t\t\tif (hasOwn.call(arg, key) && arg[key]) {\n\t\t\t\t\t\t\tclasses.push(key);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tclasses.push(arg.toString());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn classes.join(' ');\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tclassNames.default = classNames;\n\t\tmodule.exports = classNames;\n\t} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n\t\t// register as 'classnames', consistent with npm package name\n\t\tdefine('classnames', [], function () {\n\t\t\treturn classNames;\n\t\t});\n\t} else {\n\t\twindow.classNames = classNames;\n\t}\n}());\n","'use strict';\r\n\r\n/**\r\n * BEM class name factory.\r\n *\r\n * @typedef {Function} Bem\r\n * @param {String|Object} [elementOrMods] Element name or hash object with mods\r\n * @param {Object} [mods] Hash object with mods\r\n * @returns {String}\r\n */\r\n\r\n/**\r\n * Returns BEM class name factory.\r\n *\r\n * @param {String} componentName Block name\r\n * @returns {Bem}\r\n */\r\nmodule.exports = function bem(componentName) {\r\n    return function (elementOrMods, mods) {\r\n        if (!elementOrMods) {\r\n            return componentName;\r\n        }\r\n\r\n        var element;\r\n\r\n        if (typeof elementOrMods === 'string') {\r\n            element = elementOrMods;\r\n        } else {\r\n            mods = elementOrMods;\r\n        }\r\n\r\n        var base = componentName;\r\n        if (element) {\r\n            base += '__' + element;\r\n        }\r\n\r\n        return base + (\r\n            mods\r\n                ? Object.keys(mods).reduce(function (result, name) {\r\n                    var value = mods[name];\r\n\r\n                    if (value) {\r\n                        result += ' ' + (\r\n                            typeof value === 'boolean'\r\n                                ? (base + '--' + name)\r\n                                : (base + '--' + name + '_' + value)\r\n                        );\r\n                    }\r\n\r\n                    return result;\r\n                }, '')\r\n                : ''\r\n        );\r\n    };\r\n}\r\n","/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing. The function also has a property 'clear' \n * that is a function which will clear the timer to prevent previously scheduled executions. \n *\n * @source underscore.js\n * @see http://unscriptable.com/2009/03/20/debouncing-javascript-methods/\n * @param {Function} function to wrap\n * @param {Number} timeout in ms (`100`)\n * @param {Boolean} whether to execute at the beginning (`false`)\n * @api public\n */\nfunction debounce(func, wait, immediate){\n  var timeout, args, context, timestamp, result;\n  if (null == wait) wait = 100;\n\n  function later() {\n    var last = Date.now() - timestamp;\n\n    if (last < wait && last >= 0) {\n      timeout = setTimeout(later, wait - last);\n    } else {\n      timeout = null;\n      if (!immediate) {\n        result = func.apply(context, args);\n        context = args = null;\n      }\n    }\n  };\n\n  var debounced = function(){\n    context = this;\n    args = arguments;\n    timestamp = Date.now();\n    var callNow = immediate && !timeout;\n    if (!timeout) timeout = setTimeout(later, wait);\n    if (callNow) {\n      result = func.apply(context, args);\n      context = args = null;\n    }\n\n    return result;\n  };\n\n  debounced.clear = function() {\n    if (timeout) {\n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n  \n  debounced.flush = function() {\n    if (timeout) {\n      result = func.apply(context, args);\n      context = args = null;\n      \n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n\n  return debounced;\n};\n\n// Adds compatibility for ES modules\ndebounce.debounce = debounce;\n\nmodule.exports = debounce;\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","type Protocol = 'http' | 'https';\r\n\r\nexport function directionNames(hDirection, vDirection) {\r\n\tlet name, classname;\r\n\tif (hDirection && vDirection) {\r\n\t\tname = `${hDirection}${vDirection[0].toUpperCase()}${vDirection.slice(1)}`;\r\n\t\tclassname = `${hDirection}-${vDirection}`;\r\n\t} else {\r\n\t\tname = hDirection || vDirection;\r\n\t\tclassname = hDirection || vDirection;\r\n\t}\r\n\treturn { name, classname };\r\n}\r\n\r\nexport function isBlob(url: string) {\r\n\treturn /^blob:/.test(url);\r\n}\r\n\r\nexport function isDataUrl(url: string) {\r\n\treturn /^data:/.test(url);\r\n}\r\n\r\nexport function isLocal(url: string) {\r\n\treturn isBlob(url) || isDataUrl(url);\r\n}\r\n\r\nexport function isCrossOriginURL(url: string) {\r\n\tif (isLocal(url)) {\r\n\t\treturn false;\r\n\t}\r\n\tconst pageLocation = window.location;\r\n\tconst URL_HOST_PATTERN = /(\\w+:)?(?:\\/\\/)([\\w.-]+)?(?::(\\d+))?\\/?/;\r\n\tconst urlMatch = URL_HOST_PATTERN.exec(url) || [];\r\n\tconst urlparts = {\r\n\t\tprotocol: urlMatch[1] || '',\r\n\t\thost: urlMatch[2] || '',\r\n\t\tport: urlMatch[3] || '',\r\n\t};\r\n\r\n\tconst defaultPort = (protocol: Protocol) => {\r\n\t\tif (protocol === 'http') {\r\n\t\t\treturn 80;\r\n\t\t} else {\r\n\t\t\treturn 433;\r\n\t\t}\r\n\t};\r\n\r\n\tconst portOf = (location: any) => {\r\n\t\treturn location.port || defaultPort((location.protocol || pageLocation.protocol) as Protocol);\r\n\t};\r\n\r\n\treturn !(\r\n\t\t(!urlparts.protocol && !urlparts.host && !urlparts.port) ||\r\n\t\tBoolean(\r\n\t\t\turlparts.protocol &&\r\n\t\t\t\turlparts.protocol == pageLocation.protocol &&\r\n\t\t\t\turlparts.host &&\r\n\t\t\t\turlparts.host == pageLocation.host &&\r\n\t\t\t\turlparts.host &&\r\n\t\t\t\tportOf(urlparts) == portOf(pageLocation),\r\n\t\t)\r\n\t);\r\n}\r\n\r\nexport function isFunction(obj: any) {\r\n\treturn !!(obj && obj.constructor && obj.call && obj.apply);\r\n}\r\n\r\nexport function isUndefined(obj: any): boolean {\r\n\treturn obj === undefined;\r\n}\r\n\r\nexport function isObject(obj) {\r\n\treturn typeof obj === 'object' && obj !== null;\r\n}\r\n\r\nexport function getOptions(options: any, defaultScheme: any, falseScheme: any) {\r\n\tconst result: any = {};\r\n\tif (isObject(options)) {\r\n\t\tObject.keys(defaultScheme).forEach((key) => {\r\n\t\t\tif (isUndefined(options[key])) {\r\n\t\t\t\tresult[key] = defaultScheme[key];\r\n\t\t\t} else if (isObject(defaultScheme[key])) {\r\n\t\t\t\tif (isObject(options[key])) {\r\n\t\t\t\t\tresult[key] = getOptions(options[key], defaultScheme[key], falseScheme[key]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult[key] = options[key] ? defaultScheme[key] : falseScheme[key];\r\n\t\t\t\t}\r\n\t\t\t} else if (defaultScheme[key] === true || defaultScheme[key] === false) {\r\n\t\t\t\tresult[key] = Boolean(options[key]);\r\n\t\t\t} else {\r\n\t\t\t\tresult[key] = options[key];\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t} else {\r\n\t\tif (options) {\r\n\t\t\treturn defaultScheme;\r\n\t\t} else {\r\n\t\t\treturn falseScheme;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function getSettings<T extends {}>(param, defaultParams?: T) {\r\n\tlet result = {\r\n\t\tenabled: Boolean(param),\r\n\t\t...defaultParams,\r\n\t};\r\n\tif (isObject(param)) {\r\n\t\tresult = { ...result, ...param };\r\n\t}\r\n\treturn result;\r\n}\r\n\r\nexport function parseNumber(number) {\r\n\tconst parsedNumber = Number(number);\r\n\tif (Number.isNaN(parsedNumber)) {\r\n\t\treturn number;\r\n\t} else {\r\n\t\treturn parsedNumber;\r\n\t}\r\n}\r\n\r\nexport function replacedProp(value, oldName, currentName) {\r\n\tif (!isEmpty(value) && process.env.NODE_ENV !== 'production') {\r\n\t\tconsole.warn(`Warning: prop \"${oldName}\" is deprecated, use \"${currentName}\" instead. Value:`, value);\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nexport function isEmpty(obj) {\r\n\treturn (!obj || Object.keys(obj).length === 0) && typeof obj !== 'function';\r\n}\r\n\r\nexport function isObjectLike(value) {\r\n\treturn typeof value === 'object' && value !== null;\r\n}\r\n\r\nexport function isNumber(value) {\r\n\treturn (\r\n\t\ttypeof (value == 'number' || (isObjectLike(value) && toString.call(value) == '[object Number]')) &&\r\n\t\t!isNaN(value)\r\n\t);\r\n}\r\n\r\nexport function isNumeric(value) {\r\n\treturn !Number.isNaN(parseFloat(value)) && isFinite(value);\r\n}\r\n\r\nexport function isNaN(value) {\r\n\treturn value !== value;\r\n}\r\n\r\nexport function isLoadedImage(image) {\r\n\treturn Boolean(image.naturalWidth);\r\n}\r\n\r\nexport function distance(firstPoint, secondPoint) {\r\n\treturn Math.sqrt(Math.pow(firstPoint.x - secondPoint.x, 2) + Math.pow(firstPoint.y - secondPoint.y, 2));\r\n}\r\n\r\nexport function isApproximatelyEqual(a: number, b: number, precision = 0.001) {\r\n\tif (a === 0 || b === 0) {\r\n\t\treturn Math.abs(b - a) < precision;\r\n\t} else {\r\n\t\treturn Math.abs(b / a) < 1 + precision && Math.abs(b / a) > 1 - precision;\r\n\t}\r\n}\r\n\r\nexport function sign(value) {\r\n\tconst number = +value;\r\n\tif (number === 0 || isNaN(number)) {\r\n\t\treturn number;\r\n\t}\r\n\treturn number > 0 ? 1 : -1;\r\n}\r\n\r\nexport function radians(angle: number) {\r\n\treturn (angle * Math.PI) / 180;\r\n}\r\n","import { StencilEvent, Diff, MoveDirections, Point, ResizeDirections, Scale } from './typings';\r\n\r\nexport class ManipulateImageEvent implements StencilEvent {\r\n\ttype: 'manipulateImage';\r\n\tnativeEvent: Event;\r\n\tmove: Partial<MoveDirections>;\r\n\tscale: Partial<Scale>;\r\n\tconstructor(move: Partial<MoveDirections> = {}, scale: Partial<Scale> = {}) {\r\n\t\tthis.type = 'manipulateImage';\r\n\t\tthis.move = move;\r\n\t\tthis.scale = scale;\r\n\t}\r\n}\r\n\r\nexport interface ResizeEventParams {\r\n\tcompensate?: boolean;\r\n\tpreserveRatio?: boolean;\r\n\tallowedDirections?: ResizeDirections;\r\n\trespectDirection?: 'width' | 'height';\r\n}\r\n\r\nexport class ResizeEvent implements StencilEvent {\r\n\ttype: 'resize';\r\n\tdirections: ResizeDirections;\r\n\tparams: ResizeEventParams;\r\n\r\n\tconstructor(directions: ResizeDirections, params: ResizeEventParams = {}) {\r\n\t\tthis.type = 'resize';\r\n\t\tthis.directions = directions;\r\n\t\tthis.params = params;\r\n\t}\r\n}\r\n\r\nexport class MoveEvent implements StencilEvent {\r\n\ttype: 'move';\r\n\tdirections: MoveDirections;\r\n\r\n\tconstructor(directions: MoveDirections) {\r\n\t\tthis.type = 'move';\r\n\t\tthis.directions = directions;\r\n\t}\r\n}\r\n\r\nexport class DragEvent implements StencilEvent {\r\n\ttype: 'drag';\r\n\tnativeEvent: Event;\r\n\tposition: Point;\r\n\tpreviousPosition: Point;\r\n\tanchor: Point;\r\n\telement: HTMLElement;\r\n\r\n\tconstructor(nativeEvent: Event, element: HTMLElement, position: Point, previousPosition: Point, anchor: Point) {\r\n\t\tthis.type = 'drag';\r\n\t\tthis.nativeEvent = nativeEvent;\r\n\t\tthis.position = position;\r\n\t\tthis.previousPosition = previousPosition;\r\n\t\tthis.element = element;\r\n\t\tthis.anchor = anchor;\r\n\t}\r\n\tpublic shift(): Diff {\r\n\t\tconst { element, anchor, position } = this;\r\n\r\n\t\tif (element) {\r\n\t\t\tconst { left, top } = element.getBoundingClientRect();\r\n\t\t\treturn {\r\n\t\t\t\tleft: position.left - left - anchor.left,\r\n\t\t\t\ttop: position.top - top - anchor.top,\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\tleft: 0,\r\n\t\t\t\ttop: 0,\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n}\r\n","<script>\r\nimport { DragEvent } from '../../core/events';\r\n\r\nexport default {\r\n\tname: 'DraggableElement',\r\n\tprops: {\r\n\t\tclassname: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t},\r\n\tbeforeMount() {\r\n\t\twindow.addEventListener('mouseup', this.onMouseUp, { passive: false });\r\n\t\twindow.addEventListener('mousemove', this.onMouseMove, { passive: false });\r\n\t\twindow.addEventListener('touchmove', this.onTouchMove, { passive: false });\r\n\t\twindow.addEventListener('touchend', this.onTouchEnd, { passive: false });\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\twindow.removeEventListener('mouseup', this.onMouseUp);\r\n\t\twindow.removeEventListener('mousemove', this.onMouseMove);\r\n\t\twindow.removeEventListener('touchmove', this.onTouchMove);\r\n\t\twindow.removeEventListener('touchend', this.onTouchEnd);\r\n\t},\r\n\tmounted() {\r\n\t\tif (!this.$refs.draggable) {\r\n\t\t\tthrow new Error('You should add ref \"draggable\" to your root element to use draggable mixin');\r\n\t\t}\r\n\t\tthis.touches = [];\r\n\t\tthis.hovered = false;\r\n\t},\r\n\tmethods: {\r\n\t\tonMouseOver() {\r\n\t\t\tif (!this.hovered) {\r\n\t\t\t\tthis.hovered = true;\r\n\t\t\t\tthis.$emit('enter');\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMouseLeave() {\r\n\t\t\tif (this.hovered && !this.touches.length) {\r\n\t\t\t\tthis.hovered = false;\r\n\t\t\t\tthis.$emit('leave');\r\n\t\t\t}\r\n\t\t},\r\n\t\tonTouchStart(e) {\r\n\t\t\tif (e.cancelable && !this.disabled && e.touches.length === 1) {\r\n\t\t\t\tthis.touches = [...e.touches];\r\n\r\n\t\t\t\tif (!this.hovered) {\r\n\t\t\t\t\tthis.$emit('enter');\r\n\t\t\t\t\tthis.hovered = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (e.touches.length) {\r\n\t\t\t\t\tthis.initAnchor(\r\n\t\t\t\t\t\tthis.touches.reduce(\r\n\t\t\t\t\t\t\t(mean, touch) => {\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\tclientX: mean.clientX + touch.clientX / e.touches.length,\r\n\t\t\t\t\t\t\t\t\tclientY: mean.clientY + touch.clientY / e.touches.length,\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{ clientX: 0, clientY: 0 },\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tif (e.preventDefault) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t},\r\n\t\tonTouchEnd() {\r\n\t\t\tthis.processEnd();\r\n\t\t},\r\n\t\tonTouchMove(e) {\r\n\t\t\tif (this.touches.length) {\r\n\t\t\t\tthis.processMove(e, e.touches);\r\n\t\t\t\tif (e.preventDefault) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\tif (e.stopPropagation) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMouseDown(e) {\r\n\t\t\tif (!this.disabled) {\r\n\t\t\t\tconst touch = {\r\n\t\t\t\t\tfake: true,\r\n\t\t\t\t\tclientX: e.clientX,\r\n\t\t\t\t\tclientY: e.clientY,\r\n\t\t\t\t};\r\n\t\t\t\tthis.touches = [touch];\r\n\t\t\t\tthis.initAnchor(touch);\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMouseMove(e) {\r\n\t\t\tif (this.touches.length) {\r\n\t\t\t\tthis.processMove(e, [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfake: true,\r\n\t\t\t\t\t\tclientX: e.clientX,\r\n\t\t\t\t\t\tclientY: e.clientY,\r\n\t\t\t\t\t},\r\n\t\t\t\t]);\r\n\t\t\t\tif (e.preventDefault) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMouseUp() {\r\n\t\t\tthis.processEnd();\r\n\t\t},\r\n\t\tinitAnchor(touch) {\r\n\t\t\tconst draggable = this.$refs.draggable;\r\n\t\t\tconst { left, right, bottom, top } = draggable.getBoundingClientRect();\r\n\r\n\t\t\tthis.anchor = {\r\n\t\t\t\tleft: touch.clientX - left,\r\n\t\t\t\ttop: touch.clientY - top,\r\n\t\t\t\tbottom: bottom - touch.clientY,\r\n\t\t\t\tright: right - touch.clientX,\r\n\t\t\t};\r\n\t\t},\r\n\t\tprocessMove(event, touches) {\r\n\t\t\tconst newTouches = [...touches];\r\n\t\t\tif (this.touches.length) {\r\n\t\t\t\tif (this.touches.length === 1 && newTouches.length === 1) {\r\n\t\t\t\t\tconst element = this.$refs.draggable;\r\n\t\t\t\t\tthis.$emit(\r\n\t\t\t\t\t\t'drag',\r\n\t\t\t\t\t\tnew DragEvent(\r\n\t\t\t\t\t\t\tevent,\r\n\t\t\t\t\t\t\telement,\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tleft: newTouches[0].clientX,\r\n\t\t\t\t\t\t\t\ttop: newTouches[0].clientY,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tleft: this.touches[0].clientX,\r\n\t\t\t\t\t\t\t\ttop: this.touches[0].clientY,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tthis.anchor,\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tthis.touches = newTouches;\r\n\t\t\t}\r\n\t\t},\r\n\t\tprocessEnd() {\r\n\t\t\tif (this.touches.length) {\r\n\t\t\t\tthis.$emit('drag-end');\r\n\t\t\t}\r\n\t\t\tif (this.hovered) {\r\n\t\t\t\tthis.$emit('leave');\r\n\t\t\t\tthis.hovered = false;\r\n\t\t\t}\r\n\t\t\tthis.touches = [];\r\n\t\t},\r\n\t},\r\n\temits: ['drag', 'drag-end', 'leave', 'enter'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<div\r\n\t\tref=\"draggable\"\r\n\t\t:class=\"classname\"\r\n\t\t@touchstart=\"onTouchStart\"\r\n\t\t@mousedown=\"onMouseDown\"\r\n\t\t@mouseover=\"onMouseOver\"\r\n\t\t@mouseleave=\"onMouseLeave\"\r\n\t>\r\n\t\t<slot />\r\n\t</div>\r\n</template>\r\n","<script>\r\nimport bem from 'easy-bem';\r\nimport classnames from 'classnames';\r\nimport { directionNames } from '../../core/utils';\r\nimport DraggableElement from './DraggableElement.vue';\r\n\r\nconst cn = bem('vue-handler-wrapper');\r\n\r\nexport default {\r\n\tname: 'HandlerWrapper',\r\n\tcomponents: {\r\n\t\tDraggableElement,\r\n\t},\r\n\tprops: {\r\n\t\thorizontalPosition: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tverticalPosition: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tdisabled: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false,\r\n\t\t},\r\n\t},\r\n\tcomputed: {\r\n\t\tclasses() {\r\n\t\t\tlet rootClass;\r\n\t\t\tif (this.horizontalPosition || this.verticalPosition) {\r\n\t\t\t\tconst position = directionNames(this.horizontalPosition, this.verticalPosition);\r\n\t\t\t\trootClass = cn({ [position.classname]: true, disabled: this.disabled });\r\n\t\t\t} else {\r\n\t\t\t\trootClass = cn({ disabled: this.disabled });\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\troot: rootClass,\r\n\t\t\t\tdraggable: cn('draggable'),\r\n\t\t\t};\r\n\t\t},\r\n\t},\r\n\temits: ['leave', 'enter', 'drag', 'drag-end'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<div :class=\"classes.root\">\r\n\t\t<DraggableElement\r\n\t\t\t:class=\"classes.draggable\"\r\n\t\t\t@drag=\"$emit('drag', $event)\"\r\n\t\t\t@drag-end=\"$emit('drag-end')\"\r\n\t\t\t@leave=\"$emit('leave')\"\r\n\t\t\t@enter=\"$emit('enter')\"\r\n\t\t>\r\n\t\t\t<slot />\r\n\t\t</DraggableElement>\r\n\t</div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-handler-wrapper {\r\n\tposition: absolute;\r\n\ttransform: translate(-50%, -50%);\r\n\twidth: 30px;\r\n\theight: 30px;\r\n\t&__draggable {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\t&--west-north {\r\n\t\tcursor: nw-resize;\r\n\t}\r\n\t&--north {\r\n\t\tcursor: n-resize;\r\n\t}\r\n\t&--east-north {\r\n\t\tcursor: ne-resize;\r\n\t}\r\n\t&--east {\r\n\t\tcursor: e-resize;\r\n\t}\r\n\t&--east-south {\r\n\t\tcursor: se-resize;\r\n\t}\r\n\t&--south {\r\n\t\tcursor: s-resize;\r\n\t}\r\n\t&--west-south {\r\n\t\tcursor: sw-resize;\r\n\t}\r\n\t&--west {\r\n\t\tcursor: w-resize;\r\n\t}\r\n\t&--disabled {\r\n\t\tcursor: auto;\r\n\t}\r\n}\r\n</style>\r\n","<script>\r\nimport bem from 'easy-bem';\r\nimport DraggableElement from './DraggableElement.vue';\r\n\r\nconst cn = bem('vue-line-wrapper');\r\n\r\nexport default {\r\n\tname: 'LineWrapper',\r\n\tcomponents: {\r\n\t\tDraggableElement,\r\n\t},\r\n\tprops: {\r\n\t\tposition: {\r\n\t\t\ttype: String,\r\n\t\t\trequired: true,\r\n\t\t},\r\n\t\tdisabled: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false,\r\n\t\t},\r\n\t},\r\n\tcomputed: {\r\n\t\tclassname() {\r\n\t\t\treturn cn({ [this.position]: true, disabled: this.disabled });\r\n\t\t},\r\n\t},\r\n\temits: ['leave', 'enter', 'drag', 'drag-end'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<DraggableElement\r\n\t\t:class=\"classname\"\r\n\t\t@drag=\"$emit('drag', $event)\"\r\n\t\t@drag-end=\"$emit('drag-end')\"\r\n\t\t@leave=\"$emit('leave')\"\r\n\t\t@enter=\"$emit('enter')\"\r\n\t>\r\n\t\t<slot />\r\n\t</DraggableElement>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-line-wrapper {\r\n\tbackground: none;\r\n\tposition: absolute;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\r\n\t&--north,\r\n\t&--south {\r\n\t\theight: 12px;\r\n\t\twidth: 100%;\r\n\t\tleft: 0;\r\n\t\ttransform: translateY(-50%);\r\n\t}\r\n\t&--north {\r\n\t\ttop: 0;\r\n\t\tcursor: n-resize;\r\n\t}\r\n\t&--south {\r\n\t\ttop: 100%;\r\n\t\tcursor: s-resize;\r\n\t}\r\n\r\n\t&--east,\r\n\t&--west {\r\n\t\twidth: 12px;\r\n\t\theight: 100%;\r\n\t\ttransform: translateX(-50%);\r\n\t\ttop: 0;\r\n\t}\r\n\t&--east {\r\n\t\tleft: 100%;\r\n\t\tcursor: e-resize;\r\n\t}\r\n\t&--west {\r\n\t\tleft: 0;\r\n\t\tcursor: w-resize;\r\n\t}\r\n\t&--disabled {\r\n\t\tcursor: auto;\r\n\t}\r\n}\r\n</style>\r\n","import { HorizontalDirection, PositionDirection, VerticalDirection, MainDirections } from './typings';\r\n\r\nexport const ALL_DIRECTIONS: PositionDirection[] = ['left', 'right', 'top', 'bottom'];\r\nexport const HORIZONTAL_DIRECTIONS: HorizontalDirection[] = ['left', 'right'];\r\nexport const VERTICAL_DIRECTIONS: VerticalDirection[] = ['top', 'bottom'];\r\nexport const MAIN_DIRECTIONS: MainDirections[] = ['left', 'top'];\r\nexport const IMAGE_RESTRICTIONS = ['fill-area', 'fit-area', 'stencil', 'none'];\r\nexport const XHR_DONE = 4;\r\n\r\nexport const DEFAULT_COORDINATES = {\r\n\tleft: 0,\r\n\ttop: 0,\r\n\twidth: 0,\r\n\theight: 0,\r\n};\r\n","import {\r\n\tAspectRatio,\r\n\tCoordinates,\r\n\tDiff,\r\n\tIntersections,\r\n\tLimits,\r\n\tMoveDirections,\r\n\tPoint,\r\n\tResizeDirections,\r\n\tSize,\r\n\tSizeRestrictions,\r\n} from './typings';\r\nimport { ALL_DIRECTIONS } from './constants';\r\n\r\nexport function isEqual(a: any, b: any, properties?: string[]): boolean {\r\n\tproperties = properties || ['width', 'height', 'left', 'top'];\r\n\treturn !properties.some((property) => a[property] !== b[property]);\r\n}\r\n\r\nexport function toLimits(object: Coordinates): Limits {\r\n\treturn {\r\n\t\tleft: object.left,\r\n\t\ttop: object.top,\r\n\t\tright: object.left + object.width,\r\n\t\tbottom: object.top + object.height,\r\n\t};\r\n}\r\n\r\nexport function diff(firstObject: Point, secondObject: Point): Diff {\r\n\treturn {\r\n\t\tleft: firstObject.left - secondObject.left,\r\n\t\ttop: firstObject.top - secondObject.top,\r\n\t};\r\n}\r\n\r\nexport function getCenter(object: Coordinates): Point {\r\n\treturn {\r\n\t\tleft: object.left + object.width / 2,\r\n\t\ttop: object.top + object.height / 2,\r\n\t};\r\n}\r\n\r\nexport function getIntersections(object: Coordinates, limits: Limits): Intersections {\r\n\tconst intersections: Intersections = {\r\n\t\tleft: 0,\r\n\t\ttop: 0,\r\n\t\tright: 0,\r\n\t\tbottom: 0,\r\n\t};\r\n\tALL_DIRECTIONS.forEach((direction) => {\r\n\t\tconst areaLimit = limits[direction];\r\n\t\tconst objectLimit = toLimits(object)[direction];\r\n\t\tif (areaLimit !== undefined && objectLimit !== undefined) {\r\n\t\t\tif (direction === 'left' || direction === 'top') {\r\n\t\t\t\tintersections[direction] = Math.max(0, areaLimit - objectLimit);\r\n\t\t\t} else {\r\n\t\t\t\tintersections[direction] = Math.max(0, objectLimit - areaLimit);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tintersections[direction] = 0;\r\n\t\t}\r\n\t});\r\n\treturn intersections;\r\n}\r\n\r\nexport function applyDirections(coordinates: Coordinates, directions: ResizeDirections): Coordinates {\r\n\treturn {\r\n\t\tleft: coordinates.left - directions.left,\r\n\t\ttop: coordinates.top - directions.top,\r\n\t\twidth: coordinates.width + directions.left + directions.right,\r\n\t\theight: coordinates.height + directions.top + directions.bottom,\r\n\t};\r\n}\r\n\r\nexport function inverseMove(directions: MoveDirections): MoveDirections {\r\n\treturn {\r\n\t\tleft: -directions.left,\r\n\t\ttop: -directions.top,\r\n\t};\r\n}\r\n\r\nexport function applyMove(object: Coordinates, move: MoveDirections): Coordinates {\r\n\treturn {\r\n\t\t...object,\r\n\t\tleft: object.left + move.left,\r\n\t\ttop: object.top + move.top,\r\n\t};\r\n}\r\n\r\nexport function applyScale(object: Coordinates, scaleFactor: number, center?: Point, progress?: number): Coordinates {\r\n\tif (scaleFactor !== 1) {\r\n\t\tif (center) {\r\n\t\t\tconst currentCenter = getCenter(object);\r\n\t\t\treturn {\r\n\t\t\t\twidth: object.width * scaleFactor,\r\n\t\t\t\theight: object.height * scaleFactor,\r\n\t\t\t\tleft:\r\n\t\t\t\t\tobject.left +\r\n\t\t\t\t\t(object.width * (1 - scaleFactor)) / 2 +\r\n\t\t\t\t\t(center.left - currentCenter.left) * (progress || 1 - scaleFactor),\r\n\t\t\t\ttop:\r\n\t\t\t\t\tobject.top +\r\n\t\t\t\t\t(object.height * (1 - scaleFactor)) / 2 +\r\n\t\t\t\t\t(center.top - currentCenter.top) * (progress || 1 - scaleFactor),\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\twidth: object.width * scaleFactor,\r\n\t\t\t\theight: object.height * scaleFactor,\r\n\t\t\t\tleft: object.left + (object.width * (1 - scaleFactor)) / 2,\r\n\t\t\t\ttop: object.top + (object.height * (1 - scaleFactor)) / 2,\r\n\t\t\t};\r\n\t\t}\r\n\t} else {\r\n\t\treturn object;\r\n\t}\r\n}\r\n\r\nexport function ratio(object: Size): number {\r\n\treturn object.width / object.height;\r\n}\r\n\r\nexport function maxScale(object: Coordinates, area: Limits): number {\r\n\treturn Math.min(\r\n\t\tarea.right !== undefined && area.left !== undefined ? (area.right - area.left) / object.width : Infinity,\r\n\t\tarea.bottom !== undefined && area.top !== undefined ? (area.bottom - area.top) / object.height : Infinity,\r\n\t);\r\n}\r\n\r\n// Move object to correspond limits\r\nexport function fit(object: Coordinates, limits: Limits): MoveDirections {\r\n\tconst directions = {\r\n\t\tleft: 0,\r\n\t\ttop: 0,\r\n\t};\r\n\r\n\tconst intersection = getIntersections(object, limits);\r\n\r\n\tif (intersection.left && intersection.left > 0) {\r\n\t\tdirections.left = intersection.left;\r\n\t} else if (intersection.right && intersection.right > 0) {\r\n\t\tdirections.left = -intersection.right;\r\n\t}\r\n\tif (intersection.top && intersection.top > 0) {\r\n\t\tdirections.top = intersection.top;\r\n\t} else if (intersection.bottom && intersection.bottom > 0) {\r\n\t\tdirections.top = -intersection.bottom;\r\n\t}\r\n\r\n\treturn directions;\r\n}\r\n\r\nexport function getBrokenRatio(currentAspectRatio: number, aspectRatio: AspectRatio): number | undefined {\r\n\tlet ratioBroken;\r\n\tif (aspectRatio.minimum && currentAspectRatio < aspectRatio.minimum) {\r\n\t\tratioBroken = aspectRatio.minimum;\r\n\t} else if (aspectRatio.maximum && currentAspectRatio > aspectRatio.maximum) {\r\n\t\tratioBroken = aspectRatio.maximum;\r\n\t}\r\n\treturn ratioBroken;\r\n}\r\n\r\nexport function fitSize(firstSize: Size, secondSize: Size): Size {\r\n\tconst firstRatio = ratio(firstSize);\r\n\tconst secondRatio = ratio(secondSize);\r\n\r\n\tif (secondSize.width < Infinity && secondSize.height < Infinity) {\r\n\t\tif (firstRatio > secondRatio) {\r\n\t\t\treturn {\r\n\t\t\t\twidth: secondSize.width,\r\n\t\t\t\theight: secondSize.width / firstRatio,\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\twidth: secondSize.height * firstRatio,\r\n\t\t\t\theight: secondSize.height,\r\n\t\t\t};\r\n\t\t}\r\n\t} else if (secondSize.width < Infinity) {\r\n\t\treturn {\r\n\t\t\twidth: secondSize.width,\r\n\t\t\theight: secondSize.width / firstRatio,\r\n\t\t};\r\n\t} else if (secondSize.height < Infinity) {\r\n\t\treturn {\r\n\t\t\twidth: secondSize.height * firstRatio,\r\n\t\t\theight: secondSize.height,\r\n\t\t};\r\n\t} else {\r\n\t\treturn firstSize;\r\n\t}\r\n}\r\n\r\nexport function rotateSize(size: Size, angle: number) {\r\n\tconst radians = (angle * Math.PI) / 180;\r\n\treturn {\r\n\t\twidth: Math.abs(size.width * Math.cos(radians)) + Math.abs(size.height * Math.sin(radians)),\r\n\t\theight: Math.abs(size.width * Math.sin(radians)) + Math.abs(size.height * Math.cos(radians)),\r\n\t};\r\n}\r\n\r\nexport function rotatePoint(point: Point, angle: number) {\r\n\tconst radians = (angle * Math.PI) / 180;\r\n\treturn {\r\n\t\tleft: point.left * Math.cos(radians) - point.top * Math.sin(radians),\r\n\t\ttop: point.left * Math.sin(radians) + point.top * Math.cos(radians),\r\n\t};\r\n}\r\n\r\nexport function adjustSize(coordinates: Coordinates, area: Limits) {\r\n\tconst intersections = getIntersections(fitToLimits(coordinates, area), area);\r\n\r\n\tif (intersections.left + intersections.right + intersections.top + intersections.bottom) {\r\n\t\tif (intersections.left + intersections.right > intersections.top + intersections.bottom) {\r\n\t\t\treturn Math.min(\r\n\t\t\t\t(coordinates.width + intersections.left + intersections.right) / coordinates.width,\r\n\t\t\t\tmaxScale(coordinates, area),\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\treturn Math.min(\r\n\t\t\t\t(coordinates.height + intersections.top + intersections.bottom) / coordinates.height,\r\n\t\t\t\tmaxScale(coordinates, area),\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\treturn 1;\r\n}\r\n\r\nexport function fitToLimits(coordinates: Coordinates, area: Limits, inverse = false) {\r\n\tconst move = fit(coordinates, area);\r\n\treturn applyMove(coordinates, inverse ? inverseMove(move) : move);\r\n}\r\n\r\nexport function limitsToSize(area: Limits) {\r\n\treturn {\r\n\t\twidth: area.right !== undefined && area.left !== undefined ? area.right - area.left : Infinity,\r\n\t\theight: area.bottom !== undefined && area.top !== undefined ? area.bottom - area.top : Infinity,\r\n\t};\r\n}\r\n\r\nexport function limitSizeRestrictions(sizeRestrictions: SizeRestrictions, object: Size) {\r\n\treturn {\r\n\t\t...sizeRestrictions,\r\n\t\tminWidth: Math.min(object.width, sizeRestrictions.minWidth),\r\n\t\tminHeight: Math.min(object.height, sizeRestrictions.minHeight),\r\n\t\tmaxWidth: Math.min(object.width, sizeRestrictions.maxWidth),\r\n\t\tmaxHeight: Math.min(object.height, sizeRestrictions.maxHeight),\r\n\t};\r\n}\r\n\r\nexport function joinLimits(a: Limits, b: Limits, intersection = true): Limits {\r\n\tconst limits: Limits = {};\r\n\tALL_DIRECTIONS.forEach((direction) => {\r\n\t\tconst firstDirection = a[direction];\r\n\t\tconst secondDirection = b[direction];\r\n\t\tif (firstDirection !== undefined && secondDirection !== undefined) {\r\n\t\t\tif (direction === 'left' || direction === 'top') {\r\n\t\t\t\tlimits[direction] = intersection\r\n\t\t\t\t\t? Math.max(firstDirection, secondDirection)\r\n\t\t\t\t\t: Math.min(firstDirection, secondDirection);\r\n\t\t\t} else {\r\n\t\t\t\tlimits[direction] = intersection\r\n\t\t\t\t\t? Math.min(firstDirection, secondDirection)\r\n\t\t\t\t\t: Math.max(firstDirection, secondDirection);\r\n\t\t\t}\r\n\t\t} else if (secondDirection !== undefined) {\r\n\t\t\tlimits[direction] = secondDirection;\r\n\t\t} else if (firstDirection !== undefined) {\r\n\t\t\tlimits[direction] = firstDirection;\r\n\t\t}\r\n\t});\r\n\treturn limits;\r\n}\r\n\r\nexport function unionLimits(a: Limits, b: Limits) {\r\n\treturn joinLimits(a, b, false);\r\n}\r\n\r\nexport function intersectionLimits(a: Limits, b: Limits) {\r\n\treturn joinLimits(a, b, true);\r\n}\r\n","// This function returns the approximation size to width / height with respect to\r\n// restrictions and aspect ratio\r\nimport { AspectRatio, Size, SizeRestrictions } from '../typings';\r\nimport { ratio } from '../service';\r\n\r\ninterface CandidateSize extends Size {\r\n\t// Additional param to prevent double precision problems\r\n\tcorrectRatio?: boolean;\r\n}\r\n\r\ninterface ValidateSizeParams {\r\n\tsize: CandidateSize;\r\n\taspectRatio: AspectRatio;\r\n\tsizeRestrictions: SizeRestrictions;\r\n\tignoreMinimum?: boolean;\r\n}\r\nfunction validateSize(params: ValidateSizeParams): boolean {\r\n\tconst { size, aspectRatio, ignoreMinimum, sizeRestrictions } = params;\r\n\treturn Boolean(\r\n\t\t(size.correctRatio || (ratio(size) >= aspectRatio.minimum && ratio(size) <= aspectRatio.maximum)) &&\r\n\t\t\tsize.height <= sizeRestrictions.maxHeight &&\r\n\t\t\tsize.width <= sizeRestrictions.maxWidth &&\r\n\t\t\tsize.width &&\r\n\t\t\tsize.height &&\r\n\t\t\t(ignoreMinimum || (size.height >= sizeRestrictions.minHeight && size.width >= sizeRestrictions.minWidth)),\r\n\t);\r\n}\r\n\r\nfunction distance(a: Size, b: Size): number {\r\n\treturn Math.pow(a.width - b.width, 2) + Math.pow(a.height - b.height, 2);\r\n}\r\n\r\n// Limitations:\r\n// 1. Assume that maximum width and height always larger than minimum width and height\r\n// 2. Assume that aspectRatio.minimum < aspectRatio.maximum\r\n// If you break this limitations function could return null!\r\ninterface ApproximatedSizeParams {\r\n\twidth: number;\r\n\theight: number;\r\n\tsizeRestrictions: SizeRestrictions;\r\n\taspectRatio?: AspectRatio;\r\n}\r\nexport function approximatedSize(params: ApproximatedSizeParams): Size {\r\n\tconst { width, height, sizeRestrictions } = params;\r\n\r\n\tconst aspectRatio = {\r\n\t\tminimum: (params.aspectRatio && params.aspectRatio.minimum) || 0,\r\n\t\tmaximum: (params.aspectRatio && params.aspectRatio.maximum) || Infinity,\r\n\t};\r\n\r\n\tconst coordinates = {\r\n\t\twidth: Math.max(sizeRestrictions.minWidth, Math.min(sizeRestrictions.maxWidth, width)),\r\n\t\theight: Math.max(sizeRestrictions.minHeight, Math.min(sizeRestrictions.maxHeight, height)),\r\n\t};\r\n\r\n\tfunction findBestCandidate(candidates: CandidateSize[], ignoreMinimum = false): CandidateSize | null {\r\n\t\treturn candidates.reduce<CandidateSize | null>((minimum: CandidateSize | null, size: CandidateSize) => {\r\n\t\t\tif (validateSize({ size, aspectRatio, sizeRestrictions, ignoreMinimum })) {\r\n\t\t\t\treturn !minimum || distance(size, { width, height }) < distance(minimum, { width, height })\r\n\t\t\t\t\t? size\r\n\t\t\t\t\t: minimum;\r\n\t\t\t} else {\r\n\t\t\t\treturn minimum;\r\n\t\t\t}\r\n\t\t}, null);\r\n\t}\r\n\r\n\tconst candidates: CandidateSize[] = [];\r\n\r\n\tif (aspectRatio) {\r\n\t\t[aspectRatio.minimum, aspectRatio.maximum].forEach((ratio) => {\r\n\t\t\tif (ratio) {\r\n\t\t\t\tcandidates.push(\r\n\t\t\t\t\t{ width: coordinates.width, height: coordinates.width / ratio, correctRatio: true },\r\n\t\t\t\t\t{ width: coordinates.height * ratio, height: coordinates.height, correctRatio: true },\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tif (validateSize({ size: coordinates, aspectRatio, sizeRestrictions })) {\r\n\t\tcandidates.push(coordinates);\r\n\t}\r\n\r\n\tconst candidate = findBestCandidate(candidates) || findBestCandidate(candidates, true);\r\n\r\n\treturn (\r\n\t\tcandidate && {\r\n\t\t\twidth: candidate.width,\r\n\t\t\theight: candidate.height,\r\n\t\t}\r\n\t);\r\n}\r\n","import { MoveEvent } from '../events';\r\nimport { Coordinates, PositionRestrictions } from '../typings';\r\nimport { applyMove, fit } from '../service';\r\n\r\nexport interface MoveParams {\r\n\tevent: MoveEvent;\r\n\tcoordinates: Coordinates;\r\n\tpositionRestrictions: PositionRestrictions;\r\n}\r\n\r\nexport function move(params: MoveParams): Coordinates {\r\n\tconst { event, coordinates, positionRestrictions = {} } = params;\r\n\r\n\tconst movedCoordinates = applyMove(coordinates, event.directions);\r\n\r\n\treturn applyMove(movedCoordinates, fit(movedCoordinates, positionRestrictions));\r\n}\r\n","import {\r\n\tAspectRatio,\r\n\tPositionRestrictions,\r\n\tSizeRestrictions,\r\n\tTransform,\r\n\tCoordinates,\r\n\tSize,\r\n\tVisibleArea,\r\n} from '../typings';\r\nimport { MoveEvent } from '../events';\r\nimport { approximatedSize } from './approximatedSize';\r\nimport { isUndefined } from '../utils';\r\nimport { move } from './move';\r\n\r\ninterface ApplyTransformParams {\r\n\tcoordinates: Coordinates;\r\n\ttransform: Transform | Transform[];\r\n\tsizeRestrictions: SizeRestrictions;\r\n\tpositionRestrictions: PositionRestrictions;\r\n\timageSize: Size;\r\n\tvisibleArea: VisibleArea;\r\n\taspectRatio?: AspectRatio;\r\n}\r\n\r\nexport function applyTransform(params: ApplyTransformParams) {\r\n\tconst {\r\n\t\tcoordinates: initialCoordinates,\r\n\t\ttransform,\r\n\t\timageSize,\r\n\t\tsizeRestrictions,\r\n\t\tpositionRestrictions,\r\n\t\taspectRatio,\r\n\t\tvisibleArea,\r\n\t} = params;\r\n\r\n\tconst moveAlgorithm = (prevCoordinates, newCoordinates) => {\r\n\t\treturn move({\r\n\t\t\tcoordinates: prevCoordinates,\r\n\t\t\tpositionRestrictions,\r\n\t\t\tevent: new MoveEvent({\r\n\t\t\t\tleft: newCoordinates.left - prevCoordinates.left,\r\n\t\t\t\ttop: newCoordinates.top - prevCoordinates.top,\r\n\t\t\t}),\r\n\t\t});\r\n\t};\r\n\r\n\tconst resizeAlgorithm = (prevCoordinates, newCoordinates) => {\r\n\t\tlet coordinates = {\r\n\t\t\t...prevCoordinates,\r\n\t\t\t...approximatedSize({\r\n\t\t\t\twidth: newCoordinates.width,\r\n\t\t\t\theight: newCoordinates.height,\r\n\t\t\t\tsizeRestrictions,\r\n\t\t\t\taspectRatio,\r\n\t\t\t}),\r\n\t\t\tleft: 0,\r\n\t\t\ttop: 0,\r\n\t\t};\r\n\r\n\t\treturn moveAlgorithm(coordinates, {\r\n\t\t\tleft: prevCoordinates.left,\r\n\t\t\ttop: prevCoordinates.top,\r\n\t\t});\r\n\t};\r\n\r\n\tlet coordinates = { ...initialCoordinates };\r\n\r\n\tconst transforms = Array.isArray(transform) ? transform : [transform];\r\n\r\n\ttransforms.forEach((transform) => {\r\n\t\tlet changes: Partial<Coordinates> = {};\r\n\t\tif (typeof transform === 'function') {\r\n\t\t\tchanges = transform({ coordinates, imageSize, visibleArea });\r\n\t\t} else {\r\n\t\t\tchanges = transform;\r\n\t\t}\r\n\r\n\t\tif (!isUndefined(changes.width) || !isUndefined(changes.height)) {\r\n\t\t\tcoordinates = resizeAlgorithm(coordinates, { ...coordinates, ...changes });\r\n\t\t}\r\n\t\tif (!isUndefined(changes.left) || !isUndefined(changes.top)) {\r\n\t\t\tcoordinates = moveAlgorithm(coordinates, { ...coordinates, ...changes });\r\n\t\t}\r\n\t});\r\n\r\n\treturn coordinates;\r\n}\r\n","import {\r\n\tadjustSize,\r\n\tapplyMove,\r\n\tapplyScale,\r\n\tdiff,\r\n\tfit,\r\n\tfitToLimits,\r\n\tgetCenter,\r\n\tintersectionLimits,\r\n\tinverseMove,\r\n\tmaxScale,\r\n\tratio,\r\n\ttoLimits,\r\n} from '../service';\r\nimport {\r\n\tAspectRatio,\r\n\tBoundaries,\r\n\tCoordinates,\r\n\tCropperEvent,\r\n\tGetAreaRestrictions,\r\n\tPositionRestrictions,\r\n\tSize,\r\n\tSizeRestrictions,\r\n\tVisibleArea,\r\n} from '../typings';\r\nimport { isApproximatelyEqual } from '../utils';\r\nimport { approximatedSize } from './approximatedSize';\r\nimport { ALL_DIRECTIONS } from '../constants';\r\n\r\ninterface AutoZoomResult {\r\n\tvisibleArea: VisibleArea;\r\n\tcoordinates: Coordinates;\r\n}\r\n\r\ninterface AutoZoomParams {\r\n\tevent: CropperEvent;\r\n\tcoordinates: Coordinates;\r\n\tstencilReference: Coordinates;\r\n\tvisibleArea: VisibleArea;\r\n\tboundaries: Boundaries;\r\n\taspectRatio: AspectRatio;\r\n\tstencilSize: Size;\r\n\tsizeRestrictions: SizeRestrictions;\r\n\tpositionRestrictions: PositionRestrictions;\r\n\tgetAreaRestrictions: GetAreaRestrictions;\r\n}\r\n\r\nexport function fixedStencilAutoZoom(params: AutoZoomParams): AutoZoomResult {\r\n\tconst {\r\n\t\tevent,\r\n\t\tgetAreaRestrictions,\r\n\t\tboundaries,\r\n\t\tcoordinates: originalCoordinates,\r\n\t\tvisibleArea: originalVisibleArea,\r\n\t\taspectRatio,\r\n\t\tstencilSize,\r\n\t\tsizeRestrictions,\r\n\t\tpositionRestrictions,\r\n\t\tstencilReference,\r\n\t} = params;\r\n\r\n\tlet coordinates = { ...originalCoordinates };\r\n\tlet visibleArea = { ...originalVisibleArea };\r\n\r\n\t// Checks that coordinates has the same ratio that coordinates:\r\n\tlet stencil = { ...stencilSize };\r\n\r\n\tif (!isApproximatelyEqual(ratio(stencil), ratio(coordinates))) {\r\n\t\tif (process.env.NODE_ENV !== 'production') {\r\n\t\t\tconsole.error(\r\n\t\t\t\t`[Adjusting stencil] The aspect ratio of coordinates is not equal to the aspect ratio of stencil (${ratio(\r\n\t\t\t\t\tcoordinates,\r\n\t\t\t\t)} != ${ratio(stencil)})! Coordinates will be changed`,\r\n\t\t\t);\r\n\t\t}\r\n\t\tcoordinates = {\r\n\t\t\t...coordinates,\r\n\t\t\t...approximatedSize({\r\n\t\t\t\tsizeRestrictions,\r\n\t\t\t\twidth: coordinates.width,\r\n\t\t\t\theight: coordinates.height,\r\n\t\t\t\taspectRatio: {\r\n\t\t\t\t\tminimum: ratio(stencil),\r\n\t\t\t\t\tmaximum: ratio(stencil),\r\n\t\t\t\t},\r\n\t\t\t}),\r\n\t\t};\r\n\t}\r\n\r\n\t// First of all try to resize visible area as much as possible:\r\n\tvisibleArea = applyScale(visibleArea, (coordinates.width * boundaries.width) / (visibleArea.width * stencil.width));\r\n\r\n\t// Check that visible area doesn't break the area restrictions:\r\n\tconst scale = adjustSize(visibleArea, getAreaRestrictions({ visibleArea, type: 'resize' }));\r\n\tif (scale !== 1) {\r\n\t\tvisibleArea = applyScale(visibleArea, scale);\r\n\t\tcoordinates = applyScale(coordinates, scale);\r\n\t}\r\n\r\n\tvisibleArea = applyMove(visibleArea, diff(getCenter(coordinates), getCenter(visibleArea)));\r\n\r\n\t// Center stencil in visible area:\r\n\tvisibleArea = fitToLimits(visibleArea, getAreaRestrictions({ visibleArea, type: 'move' }));\r\n\tcoordinates = fitToLimits(coordinates, intersectionLimits(toLimits(visibleArea), positionRestrictions));\r\n\r\n\treturn {\r\n\t\tcoordinates,\r\n\t\tvisibleArea,\r\n\t};\r\n}\r\n\r\nexport function hybridStencilAutoZoom(params: AutoZoomParams): AutoZoomResult {\r\n\tconst {\r\n\t\tevent,\r\n\t\tgetAreaRestrictions,\r\n\t\tboundaries,\r\n\t\tcoordinates: originalCoordinates,\r\n\t\tvisibleArea: originalVisibleArea,\r\n\t\taspectRatio,\r\n\t\tstencilSize,\r\n\t\tsizeRestrictions,\r\n\t\tpositionRestrictions,\r\n\t\tstencilReference,\r\n\t} = params;\r\n\r\n\tlet coordinates = { ...originalCoordinates };\r\n\tlet visibleArea = { ...originalVisibleArea };\r\n\r\n\tif (originalCoordinates && originalVisibleArea && event.type !== 'manipulateImage') {\r\n\t\t// Checks that coordinates has the same ratio that coordinates:\r\n\t\tlet stencil: Size = {\r\n\t\t\twidth: 0,\r\n\t\t\theight: 0,\r\n\t\t};\r\n\r\n\t\tconst coefficient = visibleArea.width / boundaries.width;\r\n\r\n\t\tif (ratio(boundaries) > ratio(coordinates)) {\r\n\t\t\tstencil.height = boundaries.height * 0.8;\r\n\t\t\tstencil.width = stencil.height * ratio(coordinates);\r\n\t\t} else {\r\n\t\t\tstencil.width = boundaries.width * 0.8;\r\n\t\t\tstencil.height = stencil.width * ratio(coordinates);\r\n\t\t}\r\n\r\n\t\t// First of all try to resize visible area as much as possible:\r\n\t\tvisibleArea = applyScale(\r\n\t\t\tvisibleArea,\r\n\t\t\t(coordinates.width * boundaries.width) / (visibleArea.width * stencil.width),\r\n\t\t);\r\n\r\n\t\t// Check that visible area doesn't break the area restrictions:\r\n\t\tconst scale = adjustSize(visibleArea, getAreaRestrictions({ visibleArea, type: 'resize' }));\r\n\t\tvisibleArea = applyScale(visibleArea, scale);\r\n\r\n\t\tif (scale !== 1) {\r\n\t\t\tstencil.height /= scale;\r\n\t\t\tstencil.width /= scale;\r\n\t\t}\r\n\r\n\t\tvisibleArea = applyMove(visibleArea, diff(getCenter(coordinates), getCenter(visibleArea)));\r\n\r\n\t\t// Center stencil in visible area:\r\n\t\tvisibleArea = fitToLimits(visibleArea, getAreaRestrictions({ visibleArea, type: 'move' }));\r\n\t\tcoordinates = fitToLimits(coordinates, intersectionLimits(toLimits(visibleArea), positionRestrictions));\r\n\t}\r\n\r\n\treturn {\r\n\t\tcoordinates,\r\n\t\tvisibleArea,\r\n\t};\r\n}\r\n\r\n// The main point of this feature is calculating the needed position of stencil and parameters of world transforms\r\n// Real coordinates don't changes here\r\ninterface SimplestAutoZoomParams {\r\n\tevent: CropperEvent;\r\n\tcoordinates: Coordinates;\r\n\tvisibleArea: VisibleArea;\r\n\tgetAreaRestrictions: GetAreaRestrictions;\r\n}\r\nexport function simplestAutoZoom(params: SimplestAutoZoomParams): AutoZoomResult {\r\n\tconst { event, coordinates: originalCoordinates, visibleArea: originalVisibleArea, getAreaRestrictions } = params;\r\n\r\n\tlet visibleArea = { ...originalVisibleArea };\r\n\tconst coordinates = { ...originalCoordinates };\r\n\r\n\tif (event.type === 'setCoordinates') {\r\n\t\tconst widthIntersections = Math.max(0, coordinates.width - visibleArea.width);\r\n\t\tconst heightIntersections = Math.max(0, coordinates.height - visibleArea.height);\r\n\r\n\t\tif (widthIntersections > heightIntersections) {\r\n\t\t\tvisibleArea = applyScale(\r\n\t\t\t\tvisibleArea,\r\n\t\t\t\tMath.min(\r\n\t\t\t\t\tcoordinates.width / visibleArea.width,\r\n\t\t\t\t\tmaxScale(visibleArea, getAreaRestrictions({ visibleArea, type: 'resize' })),\r\n\t\t\t\t),\r\n\t\t\t);\r\n\t\t} else if (heightIntersections > widthIntersections) {\r\n\t\t\tvisibleArea = applyScale(\r\n\t\t\t\tvisibleArea,\r\n\t\t\t\tMath.min(\r\n\t\t\t\t\tcoordinates.height / visibleArea.height,\r\n\t\t\t\t\tmaxScale(visibleArea, getAreaRestrictions({ visibleArea, type: 'resize' })),\r\n\t\t\t\t),\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tvisibleArea = applyMove(visibleArea, inverseMove(fit(coordinates, toLimits(visibleArea))));\r\n\r\n\t\tvisibleArea = fitToLimits(visibleArea, getAreaRestrictions({ visibleArea, type: 'move' }));\r\n\t}\r\n\treturn {\r\n\t\tvisibleArea,\r\n\t\tcoordinates,\r\n\t};\r\n}\r\n","import { ImageSize, Point, Size, VisibleArea } from '../typings';\r\n\r\nexport interface DefaultPositionParams {\r\n\tcoordinates: Size;\r\n\timageSize?: ImageSize;\r\n\tvisibleArea?: VisibleArea;\r\n}\r\nexport function defaultPosition({ imageSize, visibleArea, coordinates }: DefaultPositionParams): Point {\r\n\tconst area = visibleArea || imageSize;\r\n\r\n\treturn {\r\n\t\tleft: (visibleArea ? visibleArea.left : 0) + area.width / 2 - coordinates.width / 2,\r\n\t\ttop: (visibleArea ? visibleArea.top : 0) + area.height / 2 - coordinates.height / 2,\r\n\t};\r\n}\r\n","import {\r\n\tAspectRatio,\r\n\tBoundaries,\r\n\tFalsy,\r\n\tImageSize,\r\n\tSize,\r\n\tSizeRestrictions,\r\n\tStencilSize,\r\n\tVisibleArea,\r\n} from '../typings';\r\nimport { approximatedSize } from './approximatedSize';\r\nimport { ratio } from '../service';\r\nimport { isNumber } from '../utils';\r\n\r\ninterface DefaultSizeBasicParams {\r\n\taspectRatio: AspectRatio;\r\n\tboundaries: Boundaries;\r\n\tsizeRestrictions: SizeRestrictions;\r\n}\r\n\r\ninterface ImageDefaultSizeParams extends DefaultSizeBasicParams {\r\n\timageSize: ImageSize;\r\n\tvisibleArea?: VisibleArea | Falsy;\r\n}\r\n\r\ninterface VisibleAreaDefaultSizeParams extends DefaultSizeBasicParams {\r\n\timageSize?: ImageSize | Falsy;\r\n\tvisibleArea: VisibleArea;\r\n}\r\n\r\nexport type DefaultSizeParams = VisibleAreaDefaultSizeParams | ImageDefaultSizeParams;\r\n\r\nexport function defaultSize(params: DefaultSizeParams): Size {\r\n\tconst { imageSize, visibleArea, aspectRatio, sizeRestrictions } = params;\r\n\r\n\tconst area = (visibleArea || imageSize) as Size;\r\n\r\n\tconst optimalRatio = Math.min(aspectRatio.maximum || Infinity, Math.max(aspectRatio.minimum || 0, ratio(area)));\r\n\r\n\tconst size =\r\n\t\tarea.width < area.height\r\n\t\t\t? {\r\n\t\t\t\t\twidth: area.width * 0.8,\r\n\t\t\t\t\theight: (area.width * 0.8) / optimalRatio,\r\n\t\t\t  }\r\n\t\t\t: {\r\n\t\t\t\t\theight: area.height * 0.8,\r\n\t\t\t\t\twidth: area.height * 0.8 * optimalRatio,\r\n\t\t\t  };\r\n\r\n\treturn approximatedSize({\r\n\t\t...size,\r\n\t\taspectRatio,\r\n\t\tsizeRestrictions: sizeRestrictions,\r\n\t});\r\n}\r\n\r\nexport type FixedDefaultSizeParams = DefaultSizeParams & { stencilSize: Size };\r\n\r\nexport function fixedDefaultSize(params: FixedDefaultSizeParams): Size {\r\n\tconst { imageSize, visibleArea, boundaries, aspectRatio, sizeRestrictions, stencilSize } = params;\r\n\r\n\tconst area = (visibleArea || imageSize) as Size;\r\n\r\n\tlet height, width;\r\n\tif (ratio(area) > ratio(boundaries)) {\r\n\t\theight = (stencilSize.height * area.height) / boundaries.height;\r\n\t\twidth = height * ratio(stencilSize);\r\n\t} else {\r\n\t\twidth = (stencilSize.width * area.width) / boundaries.width;\r\n\t\theight = width / ratio(stencilSize);\r\n\t}\r\n\r\n\treturn approximatedSize({\r\n\t\twidth,\r\n\t\theight,\r\n\t\taspectRatio,\r\n\t\tsizeRestrictions: sizeRestrictions,\r\n\t});\r\n}\r\n","import { Size, VisibleArea, Coordinates, GetAreaRestrictions, Limits, Falsy } from '../typings';\r\nimport { ratio, toLimits, intersectionLimits, fitToLimits, getIntersections, fitSize, limitsToSize } from '../service';\r\n\r\nexport interface DefaultVisibleAreaParams {\r\n\timageSize: Size;\r\n\tboundaries: Size;\r\n\tcoordinates?: Coordinates | Falsy;\r\n\tgetAreaRestrictions: GetAreaRestrictions;\r\n}\r\nexport function defaultVisibleArea(params: DefaultVisibleAreaParams): VisibleArea {\r\n\tconst { getAreaRestrictions, coordinates, imageSize, boundaries } = params;\r\n\r\n\tconst boundaryRatio = ratio(boundaries);\r\n\r\n\tif (coordinates) {\r\n\t\t// Visible area will try to fit reference:\r\n\t\tconst reference = {\r\n\t\t\theight: Math.max(coordinates.height, imageSize.height),\r\n\t\t\twidth: Math.max(coordinates.width, imageSize.width),\r\n\t\t};\r\n\r\n\t\tconst areaProperties = fitSize(\r\n\t\t\t{\r\n\t\t\t\twidth: ratio(reference) > boundaryRatio ? reference.width : reference.height * boundaryRatio,\r\n\t\t\t\theight: ratio(reference) > boundaryRatio ? reference.width / boundaryRatio : reference.height,\r\n\t\t\t},\r\n\t\t\tlimitsToSize(getAreaRestrictions()),\r\n\t\t);\r\n\r\n\t\t// Visible area will try to center stencil:\r\n\t\tconst visibleArea = {\r\n\t\t\tleft: coordinates.left + coordinates.width / 2 - areaProperties.width / 2,\r\n\t\t\ttop: coordinates.top + coordinates.height / 2 - areaProperties.height / 2,\r\n\t\t\twidth: areaProperties.width,\r\n\t\t\theight: areaProperties.height,\r\n\t\t};\r\n\r\n\t\t// TODO: Controversial behavior:\r\n\t\t// If the coordinates are beyond image visible area will be allowed to be beyond image alike:\r\n\t\tconst coordinatesIntersection = getIntersections(\r\n\t\t\tcoordinates,\r\n\t\t\ttoLimits({\r\n\t\t\t\tleft: 0,\r\n\t\t\t\ttop: 0,\r\n\t\t\t\t...imageSize,\r\n\t\t\t}),\r\n\t\t);\r\n\r\n\t\tconst limits: Limits = {};\r\n\r\n\t\tif (!coordinatesIntersection.left && !coordinatesIntersection.right && visibleArea.width <= imageSize.width) {\r\n\t\t\tlimits.left = 0;\r\n\t\t\tlimits.right = imageSize.width;\r\n\t\t}\r\n\r\n\t\tif (!coordinatesIntersection.top && !coordinatesIntersection.bottom && visibleArea.height <= imageSize.height) {\r\n\t\t\tlimits.top = 0;\r\n\t\t\tlimits.bottom = imageSize.height;\r\n\t\t}\r\n\r\n\t\treturn fitToLimits(visibleArea, limits);\r\n\t} else {\r\n\t\tconst imageRatio = ratio(imageSize);\r\n\r\n\t\tconst areaProperties = {\r\n\t\t\theight: imageRatio > boundaryRatio ? imageSize.height : imageSize.width / boundaryRatio,\r\n\t\t\twidth: imageRatio > boundaryRatio ? imageSize.height * boundaryRatio : imageSize.width,\r\n\t\t};\r\n\r\n\t\treturn {\r\n\t\t\tleft: imageSize.width / 2 - areaProperties.width / 2,\r\n\t\t\ttop: imageSize.height / 2 - areaProperties.height / 2,\r\n\t\t\twidth: areaProperties.width,\r\n\t\t\theight: areaProperties.height,\r\n\t\t};\r\n\t}\r\n}\r\n","import { Coordinates, Limits } from '../typings';\r\nimport { joinLimits } from '../service';\r\nimport { toLimits } from '../service';\r\n\r\nexport function limitBy(limits: Limits, object: Coordinates): Limits {\r\n\treturn joinLimits(limits, toLimits(object));\r\n}\r\n","import { ManipulateImageEvent } from '../events';\r\nimport { GetAreaRestrictions, Coordinates, PositionRestrictions, SizeRestrictions, VisibleArea } from '../typings';\r\nimport {\r\n\tapplyMove,\r\n\tapplyScale,\r\n\tfit,\r\n\tfitToLimits,\r\n\tgetCenter,\r\n\tintersectionLimits,\r\n\tinverseMove,\r\n\tmaxScale,\r\n\ttoLimits,\r\n} from '../service';\r\n\r\ninterface ManipulateImageParams {\r\n\tevent: ManipulateImageEvent;\r\n\tcoordinates: Coordinates;\r\n\tvisibleArea: VisibleArea;\r\n\tsizeRestrictions: SizeRestrictions;\r\n\tpositionRestrictions: PositionRestrictions;\r\n\tgetAreaRestrictions: GetAreaRestrictions;\r\n\tadjustStencil: boolean;\r\n}\r\ninterface ManipulateImageResult {\r\n\tvisibleArea: VisibleArea;\r\n\tcoordinates: Coordinates;\r\n}\r\nexport function manipulateImage(params: ManipulateImageParams): ManipulateImageResult {\r\n\tconst {\r\n\t\tevent,\r\n\t\tcoordinates: originalCoordinates,\r\n\t\tvisibleArea: originalVisibleArea,\r\n\t\tsizeRestrictions,\r\n\t\tgetAreaRestrictions,\r\n\t\tpositionRestrictions,\r\n\t\tadjustStencil,\r\n\t} = params;\r\n\r\n\tconst { scale, move } = event;\r\n\r\n\tlet visibleArea = { ...originalVisibleArea };\r\n\tlet coordinates = { ...originalCoordinates };\r\n\r\n\tlet areaScale = 1;\r\n\tlet stencilScale = 1;\r\n\tconst allowedScale = scale.factor && Math.abs(scale.factor - 1) > 1e-3;\r\n\r\n\tvisibleArea = applyMove(visibleArea, {\r\n\t\tleft: move.left || 0,\r\n\t\ttop: move.top || 0,\r\n\t});\r\n\r\n\tconst scaleRestrictions = {\r\n\t\tstencil: {\r\n\t\t\tminimum: Math.max(\r\n\t\t\t\tsizeRestrictions.minWidth ? sizeRestrictions.minWidth / coordinates.width : 0,\r\n\t\t\t\tsizeRestrictions.minHeight ? sizeRestrictions.minHeight / coordinates.height : 0,\r\n\t\t\t),\r\n\t\t\tmaximum: Math.min(\r\n\t\t\t\tsizeRestrictions.maxWidth ? sizeRestrictions.maxWidth / coordinates.width : Infinity,\r\n\t\t\t\tsizeRestrictions.maxHeight ? sizeRestrictions.maxHeight / coordinates.height : Infinity,\r\n\t\t\t\tmaxScale(coordinates, positionRestrictions),\r\n\t\t\t),\r\n\t\t},\r\n\t\tarea: {\r\n\t\t\tmaximum: maxScale(visibleArea, getAreaRestrictions({ visibleArea, type: 'resize' })),\r\n\t\t},\r\n\t};\r\n\r\n\t// If there is scaling then begin scale\r\n\tif (scale.factor && allowedScale) {\r\n\t\t// Determine scale factor\r\n\t\tif (scale.factor < 1) {\r\n\t\t\tstencilScale = Math.max(scale.factor, scaleRestrictions.stencil.minimum);\r\n\t\t\tif (stencilScale > 1) {\r\n\t\t\t\tstencilScale = 1;\r\n\t\t\t}\r\n\t\t} else if (scale.factor > 1) {\r\n\t\t\tstencilScale = Math.min(\r\n\t\t\t\tscale.factor,\r\n\t\t\t\tMath.min(scaleRestrictions.area.maximum, scaleRestrictions.stencil.maximum),\r\n\t\t\t);\r\n\t\t\tif (stencilScale < 1) {\r\n\t\t\t\tstencilScale = 1;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (stencilScale) {\r\n\t\t// Resize stencil with area as much is possible\r\n\t\tvisibleArea = applyScale(visibleArea, stencilScale, scale.center);\r\n\t}\r\n\r\n\tconst relativeCoordinates = {\r\n\t\tleft: originalCoordinates.left - originalVisibleArea.left,\r\n\t\tright:\r\n\t\t\toriginalVisibleArea.width +\r\n\t\t\toriginalVisibleArea.left -\r\n\t\t\t(originalCoordinates.width + originalCoordinates.left),\r\n\t\ttop: originalCoordinates.top - originalVisibleArea.top,\r\n\t\tbottom:\r\n\t\t\toriginalVisibleArea.height +\r\n\t\t\toriginalVisibleArea.top -\r\n\t\t\t(originalCoordinates.height + originalCoordinates.top),\r\n\t};\r\n\r\n\t// Move the area to fit to coordinates limits:\r\n\tvisibleArea = applyMove(\r\n\t\tvisibleArea,\r\n\t\tfit(visibleArea, {\r\n\t\t\tleft:\r\n\t\t\t\tpositionRestrictions.left !== undefined\r\n\t\t\t\t\t? positionRestrictions.left - relativeCoordinates.left * stencilScale\r\n\t\t\t\t\t: undefined,\r\n\t\t\ttop:\r\n\t\t\t\tpositionRestrictions.top !== undefined\r\n\t\t\t\t\t? positionRestrictions.top - relativeCoordinates.top * stencilScale\r\n\t\t\t\t\t: undefined,\r\n\t\t\tbottom:\r\n\t\t\t\tpositionRestrictions.bottom !== undefined\r\n\t\t\t\t\t? positionRestrictions.bottom + relativeCoordinates.bottom * stencilScale\r\n\t\t\t\t\t: undefined,\r\n\t\t\tright:\r\n\t\t\t\tpositionRestrictions.right !== undefined\r\n\t\t\t\t\t? positionRestrictions.right + relativeCoordinates.right * stencilScale\r\n\t\t\t\t\t: undefined,\r\n\t\t}),\r\n\t);\r\n\r\n\t// But the more important to fit are to the area restrictions, so we should fit it to that restrictions:\r\n\tvisibleArea = fitToLimits(visibleArea, getAreaRestrictions({ visibleArea, type: 'move' }));\r\n\r\n\t// Set the same coordinates of stencil inside visible area\r\n\tcoordinates.width = coordinates.width * stencilScale;\r\n\tcoordinates.height = coordinates.height * stencilScale;\r\n\tcoordinates.left = visibleArea.left + relativeCoordinates.left * stencilScale;\r\n\tcoordinates.top = visibleArea.top + relativeCoordinates.top * stencilScale;\r\n\r\n\t// Move the coordinates to prevent the intersection with visible area and position restrictions\r\n\tcoordinates = fitToLimits(coordinates, intersectionLimits(toLimits(visibleArea), positionRestrictions));\r\n\r\n\t// Resize only area if stencil can't be resized and stencil resize is disabled\r\n\tif (scale.factor && allowedScale && adjustStencil) {\r\n\t\tif (scale.factor > 1) {\r\n\t\t\tareaScale = Math.min(scaleRestrictions.area.maximum, scale.factor) / stencilScale;\r\n\t\t} else if (scale.factor < 1) {\r\n\t\t\tareaScale = Math.max(\r\n\t\t\t\tcoordinates.height / visibleArea.height,\r\n\t\t\t\tcoordinates.width / visibleArea.width,\r\n\t\t\t\tscale.factor / stencilScale,\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (areaScale !== 1) {\r\n\t\t\tvisibleArea = applyScale(visibleArea, areaScale, scale.factor > 1 ? scale.center : getCenter(coordinates));\r\n\r\n\t\t\t// Move to prevent the breaking of the area restrictions:\r\n\t\t\tvisibleArea = fitToLimits(visibleArea, getAreaRestrictions({ visibleArea, type: 'move' }));\r\n\r\n\t\t\t// Move to prevent the intersection with coordinates:\r\n\t\t\tvisibleArea = applyMove(visibleArea, inverseMove(fit(coordinates, toLimits(visibleArea))));\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\tcoordinates,\r\n\t\tvisibleArea,\r\n\t};\r\n}\r\n","import {\r\n\tAspectRatio,\r\n\tBoundaries,\r\n\tCoordinates,\r\n\tCropperEvent,\r\n\tGetAreaRestrictions,\r\n\tImageSize,\r\n\tPositionRestrictions,\r\n\tSize,\r\n\tSizeRestrictions,\r\n\tVisibleArea,\r\n} from '../typings';\r\nimport { isApproximatelyEqual, sign } from '../utils';\r\nimport {\r\n\tadjustSize,\r\n\tapplyMove,\r\n\tapplyScale,\r\n\tdiff,\r\n\tfitSize,\r\n\tfitToLimits,\r\n\tgetCenter,\r\n\tintersectionLimits,\r\n\tratio,\r\n\trotatePoint,\r\n\trotateSize,\r\n\ttoLimits,\r\n} from '../service';\r\nimport { approximatedSize } from './approximatedSize';\r\n\r\ninterface RotateImageParams {\r\n\taspectRatio: AspectRatio;\r\n\tcoordinates: Coordinates;\r\n\tvisibleArea: VisibleArea;\r\n\tsizeRestrictions: SizeRestrictions;\r\n\tpositionRestrictions: PositionRestrictions;\r\n\tgetAreaRestrictions: GetAreaRestrictions;\r\n\timageSize: ImageSize;\r\n\tpreviousImageSize: ImageSize;\r\n\tangle: number;\r\n}\r\n\r\ninterface RotateImageResult {\r\n\tvisibleArea: VisibleArea;\r\n\tcoordinates: Coordinates;\r\n}\r\n\r\nexport function rotateImage(params: RotateImageParams): RotateImageResult {\r\n\tconst {\r\n\t\taspectRatio,\r\n\t\tgetAreaRestrictions,\r\n\t\tcoordinates: originalCoordinates,\r\n\t\tvisibleArea: originalVisibleArea,\r\n\t\tsizeRestrictions,\r\n\t\tpositionRestrictions,\r\n\t\timageSize,\r\n\t\tpreviousImageSize,\r\n\t\tangle,\r\n\t} = params;\r\n\r\n\tlet coordinates = { ...originalCoordinates };\r\n\tlet visibleArea = { ...originalVisibleArea };\r\n\r\n\tconst imageCenter = rotatePoint(\r\n\t\tgetCenter({\r\n\t\t\tleft: 0,\r\n\t\t\ttop: 0,\r\n\t\t\t...previousImageSize,\r\n\t\t}),\r\n\t\tangle,\r\n\t);\r\n\r\n\tcoordinates = {\r\n\t\t...approximatedSize({\r\n\t\t\tsizeRestrictions,\r\n\t\t\taspectRatio,\r\n\t\t\twidth: coordinates.width,\r\n\t\t\theight: coordinates.height,\r\n\t\t}),\r\n\t\t...rotatePoint(getCenter(coordinates), angle),\r\n\t};\r\n\r\n\tcoordinates.left -= imageCenter.left - imageSize.width / 2 + coordinates.width / 2;\r\n\tcoordinates.top -= imageCenter.top - imageSize.height / 2 + coordinates.height / 2;\r\n\r\n\t// Check that visible area doesn't break the area restrictions:\r\n\tvisibleArea = applyScale(\r\n\t\tvisibleArea,\r\n\t\tadjustSize(visibleArea, getAreaRestrictions({ visibleArea, type: 'resize' })),\r\n\t);\r\n\r\n\tcoordinates = fitToLimits(coordinates, positionRestrictions);\r\n\r\n\tvisibleArea = applyMove(visibleArea, diff(getCenter(coordinates), getCenter(originalCoordinates)));\r\n\r\n\tvisibleArea = fitToLimits(visibleArea, getAreaRestrictions({ visibleArea, type: 'move' }));\r\n\r\n\treturn {\r\n\t\tcoordinates,\r\n\t\tvisibleArea,\r\n\t};\r\n}\r\n","import {\r\n\tAspectRatio,\r\n\tBoundaries,\r\n\tCoordinates,\r\n\tCropperEvent,\r\n\tGetAreaRestrictions,\r\n\tImageSize,\r\n\tPositionRestrictions,\r\n\tSize,\r\n\tSizeRestrictions,\r\n\tVisibleArea,\r\n} from '../typings';\r\nimport { isApproximatelyEqual, sign } from '../utils';\r\nimport {\r\n\tadjustSize,\r\n\tapplyMove,\r\n\tapplyScale,\r\n\tdiff,\r\n\tfitSize,\r\n\tfitToLimits,\r\n\tgetCenter,\r\n\tintersectionLimits,\r\n\tratio,\r\n\trotatePoint,\r\n\trotateSize,\r\n\ttoLimits,\r\n} from '../service';\r\nimport { approximatedSize } from './approximatedSize';\r\n\r\ninterface Reflect {\r\n\thorizontal: boolean;\r\n\tvertical: boolean;\r\n}\r\n\r\ninterface FlipImageParams {\r\n\taspectRatio: AspectRatio;\r\n\tcoordinates: Coordinates;\r\n\tvisibleArea: VisibleArea;\r\n\tgetAreaRestrictions: GetAreaRestrictions;\r\n\timageSize: ImageSize;\r\n\tpreviousFlip: Reflect;\r\n\tflip: Reflect;\r\n\trotate: number;\r\n}\r\n\r\ninterface FlipImageResult {\r\n\tvisibleArea: VisibleArea;\r\n\tcoordinates: Coordinates;\r\n}\r\n\r\nexport function flipImage(params: FlipImageParams): FlipImageResult {\r\n\tconst {\r\n\t\tflip,\r\n\t\tpreviousFlip,\r\n\t\trotate,\r\n\t\taspectRatio,\r\n\t\tgetAreaRestrictions,\r\n\t\tcoordinates: originalCoordinates,\r\n\t\tvisibleArea: originalVisibleArea,\r\n\t\timageSize,\r\n\t} = params;\r\n\r\n\tlet coordinates = { ...originalCoordinates };\r\n\tlet visibleArea = { ...originalVisibleArea };\r\n\r\n\tconst changed = {\r\n\t\thorizontal: previousFlip.horizontal !== flip.horizontal,\r\n\t\tvertical: previousFlip.vertical !== flip.vertical,\r\n\t};\r\n\r\n\tif (changed.horizontal || changed.vertical) {\r\n\t\tconst imageCenter = rotatePoint(\r\n\t\t\t{\r\n\t\t\t\tleft: imageSize.width / 2,\r\n\t\t\t\ttop: imageSize.height / 2,\r\n\t\t\t},\r\n\t\t\t-rotate,\r\n\t\t);\r\n\r\n\t\tlet oldCenter = rotatePoint(getCenter(coordinates), -rotate);\r\n\t\tlet newCenter = rotatePoint(\r\n\t\t\t{\r\n\t\t\t\tleft: changed.horizontal ? imageCenter.left - (oldCenter.left - imageCenter.left) : oldCenter.left,\r\n\t\t\t\ttop: changed.vertical ? imageCenter.top - (oldCenter.top - imageCenter.top) : oldCenter.top,\r\n\t\t\t},\r\n\t\t\trotate,\r\n\t\t);\r\n\t\tcoordinates = applyMove(coordinates, diff(newCenter, getCenter(coordinates)));\r\n\r\n\t\toldCenter = rotatePoint(getCenter(visibleArea), -rotate);\r\n\t\tnewCenter = rotatePoint(\r\n\t\t\t{\r\n\t\t\t\tleft: changed.horizontal ? imageCenter.left - (oldCenter.left - imageCenter.left) : oldCenter.left,\r\n\t\t\t\ttop: changed.vertical ? imageCenter.top - (oldCenter.top - imageCenter.top) : oldCenter.top,\r\n\t\t\t},\r\n\t\t\trotate,\r\n\t\t);\r\n\t\tvisibleArea = applyMove(visibleArea, diff(newCenter, getCenter(visibleArea)));\r\n\r\n\t\tvisibleArea = fitToLimits(visibleArea, getAreaRestrictions({ visibleArea, type: 'move' }));\r\n\t}\r\n\r\n\treturn {\r\n\t\tcoordinates,\r\n\t\tvisibleArea,\r\n\t};\r\n}\r\n","import { MoveEvent, ResizeEvent } from '../events';\r\nimport { AspectRatio, Coordinates, Limits, PositionRestrictions, ResizeDirections, SizeRestrictions } from '../typings';\r\nimport { ALL_DIRECTIONS, HORIZONTAL_DIRECTIONS, VERTICAL_DIRECTIONS } from '../constants';\r\nimport { applyDirections, getBrokenRatio, getIntersections, ratio } from '../service';\r\nimport { move } from './move';\r\n\r\ninterface FitConditionsParams {\r\n\tdirections: ResizeDirections;\r\n\tcoordinates: Coordinates;\r\n\tpositionRestrictions: Limits;\r\n\tsizeRestrictions: SizeRestrictions;\r\n\tpreserveRatio?: boolean;\r\n\tcompensate?: boolean;\r\n}\r\n\r\nexport function fitConditions({\r\n\tdirections,\r\n\tcoordinates,\r\n\tpositionRestrictions = {},\r\n\tsizeRestrictions,\r\n\tpreserveRatio,\r\n\tcompensate,\r\n}: FitConditionsParams): ResizeDirections {\r\n\tconst fittedDirections = { ...directions };\r\n\r\n\tlet currentWidth = applyDirections(coordinates, fittedDirections).width;\r\n\tlet currentHeight = applyDirections(coordinates, fittedDirections).height;\r\n\r\n\t// Prevent strange resizes when the width or height of stencil becomes smaller than 0\r\n\tif (currentWidth < 0) {\r\n\t\tif (fittedDirections.left < 0 && fittedDirections.right < 0) {\r\n\t\t\tfittedDirections.left =\r\n\t\t\t\t-(coordinates.width - sizeRestrictions.minWidth) / (fittedDirections.left / fittedDirections.right);\r\n\t\t\tfittedDirections.right =\r\n\t\t\t\t-(coordinates.width - sizeRestrictions.minWidth) / (fittedDirections.right / fittedDirections.left);\r\n\t\t} else if (fittedDirections.left < 0) {\r\n\t\t\tfittedDirections.left = -(coordinates.width - sizeRestrictions.minWidth);\r\n\t\t} else if (fittedDirections.right < 0) {\r\n\t\t\tfittedDirections.right = -(coordinates.width - sizeRestrictions.minWidth);\r\n\t\t}\r\n\t}\r\n\tif (currentHeight < 0) {\r\n\t\tif (fittedDirections.top < 0 && fittedDirections.bottom < 0) {\r\n\t\t\tfittedDirections.top =\r\n\t\t\t\t-(coordinates.height - sizeRestrictions.minHeight) / (fittedDirections.top / fittedDirections.bottom);\r\n\t\t\tfittedDirections.bottom =\r\n\t\t\t\t-(coordinates.height - sizeRestrictions.minHeight) / (fittedDirections.bottom / fittedDirections.top);\r\n\t\t} else if (fittedDirections.top < 0) {\r\n\t\t\tfittedDirections.top = -(coordinates.height - sizeRestrictions.minHeight);\r\n\t\t} else if (fittedDirections.bottom < 0) {\r\n\t\t\tfittedDirections.bottom = -(coordinates.height - sizeRestrictions.minHeight);\r\n\t\t}\r\n\t}\r\n\r\n\t// Prevent breaking limits\r\n\tlet breaks = getIntersections(applyDirections(coordinates, fittedDirections), positionRestrictions);\r\n\r\n\tif (compensate) {\r\n\t\tif (breaks.left && breaks.left > 0 && breaks.right === 0) {\r\n\t\t\tfittedDirections.right += breaks.left;\r\n\t\t\tfittedDirections.left -= breaks.left;\r\n\t\t} else if (breaks.right && breaks.right > 0 && breaks.left === 0) {\r\n\t\t\tfittedDirections.left += breaks.right;\r\n\t\t\tfittedDirections.right -= breaks.right;\r\n\t\t}\r\n\r\n\t\tif (breaks.top && breaks.top > 0 && breaks.bottom === 0) {\r\n\t\t\tfittedDirections.bottom += breaks.top;\r\n\t\t\tfittedDirections.top -= breaks.top;\r\n\t\t} else if (breaks.bottom && breaks.bottom > 0 && breaks.top === 0) {\r\n\t\t\tfittedDirections.top += breaks.bottom;\r\n\t\t\tfittedDirections.bottom -= breaks.bottom;\r\n\t\t}\r\n\r\n\t\tbreaks = getIntersections(applyDirections(coordinates, fittedDirections), positionRestrictions);\r\n\t}\r\n\r\n\tconst maxResize = {\r\n\t\twidth: Infinity,\r\n\t\theight: Infinity,\r\n\t\tleft: Infinity,\r\n\t\tright: Infinity,\r\n\t\ttop: Infinity,\r\n\t\tbottom: Infinity,\r\n\t};\r\n\r\n\tALL_DIRECTIONS.forEach((direction) => {\r\n\t\tconst intersection = breaks[direction];\r\n\t\tif (intersection && fittedDirections[direction]) {\r\n\t\t\tmaxResize[direction] = Math.max(0, 1 - intersection / fittedDirections[direction]);\r\n\t\t}\r\n\t});\r\n\r\n\tif (preserveRatio) {\r\n\t\t// TODO: Temporary solution to replace spread operator\r\n\t\tconst multiplier = Math.min.apply(\r\n\t\t\tnull,\r\n\t\t\tALL_DIRECTIONS.map((direction) => maxResize[direction]),\r\n\t\t);\r\n\t\tif (multiplier !== Infinity) {\r\n\t\t\tALL_DIRECTIONS.forEach((direction) => {\r\n\t\t\t\tfittedDirections[direction] *= multiplier;\r\n\t\t\t});\r\n\t\t}\r\n\t} else {\r\n\t\tALL_DIRECTIONS.forEach((direction) => {\r\n\t\t\tif (maxResize[direction] !== Infinity) {\r\n\t\t\t\tfittedDirections[direction] *= maxResize[direction];\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tcurrentWidth = applyDirections(coordinates, fittedDirections).width;\r\n\tcurrentHeight = applyDirections(coordinates, fittedDirections).height;\r\n\r\n\tif (fittedDirections.right + fittedDirections.left) {\r\n\t\tif (currentWidth > sizeRestrictions.maxWidth) {\r\n\t\t\tmaxResize.width =\r\n\t\t\t\t(sizeRestrictions.maxWidth - coordinates.width) / (fittedDirections.right + fittedDirections.left);\r\n\t\t} else if (currentWidth < sizeRestrictions.minWidth) {\r\n\t\t\tmaxResize.width =\r\n\t\t\t\t(sizeRestrictions.minWidth - coordinates.width) / (fittedDirections.right + fittedDirections.left);\r\n\t\t}\r\n\t}\r\n\r\n\tif (fittedDirections.bottom + fittedDirections.top) {\r\n\t\tif (currentHeight > sizeRestrictions.maxHeight) {\r\n\t\t\tmaxResize.height =\r\n\t\t\t\t(sizeRestrictions.maxHeight - coordinates.height) / (fittedDirections.bottom + fittedDirections.top);\r\n\t\t} else if (currentHeight < sizeRestrictions.minHeight) {\r\n\t\t\tmaxResize.height =\r\n\t\t\t\t(sizeRestrictions.minHeight - coordinates.height) / (fittedDirections.bottom + fittedDirections.top);\r\n\t\t}\r\n\t}\r\n\r\n\tif (preserveRatio) {\r\n\t\tconst multiplier = Math.min(maxResize.width, maxResize.height);\r\n\t\tif (multiplier !== Infinity) {\r\n\t\t\tALL_DIRECTIONS.forEach((direction) => {\r\n\t\t\t\tfittedDirections[direction] *= multiplier;\r\n\t\t\t});\r\n\t\t}\r\n\t} else {\r\n\t\tif (maxResize.width !== Infinity) {\r\n\t\t\tHORIZONTAL_DIRECTIONS.forEach((direction) => {\r\n\t\t\t\tfittedDirections[direction] *= maxResize.width;\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (maxResize.height !== Infinity) {\r\n\t\t\tVERTICAL_DIRECTIONS.forEach((direction) => {\r\n\t\t\t\tfittedDirections[direction] *= maxResize.height;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\treturn fittedDirections;\r\n}\r\n\r\nexport interface ResizeParams {\r\n\tevent: ResizeEvent;\r\n\tcoordinates: Coordinates;\r\n\taspectRatio: AspectRatio;\r\n\tsizeRestrictions: SizeRestrictions;\r\n\tpositionRestrictions: PositionRestrictions;\r\n}\r\n\r\nfunction distributeOverlap(overlap: number, first: number, second: number) {\r\n\tif (first == 0 && second == 0) {\r\n\t\treturn overlap / 2;\r\n\t} else if (first == 0) {\r\n\t\treturn 0;\r\n\t} else if (second == 0) {\r\n\t\treturn overlap;\r\n\t} else {\r\n\t\treturn overlap * Math.abs(first / (first + second));\r\n\t}\r\n}\r\n\r\nexport function resize(params: ResizeParams): Coordinates {\r\n\tconst { event, coordinates, aspectRatio, positionRestrictions, sizeRestrictions } = params;\r\n\tconst actualCoordinates = {\r\n\t\t...coordinates,\r\n\t\tright: coordinates.left + coordinates.width,\r\n\t\tbottom: coordinates.top + coordinates.height,\r\n\t};\r\n\r\n\tconst eventParams = event.params || {};\r\n\r\n\tlet directions = {\r\n\t\t...event.directions,\r\n\t};\r\n\r\n\tconst allowedDirections = eventParams.allowedDirections || {\r\n\t\tleft: true,\r\n\t\tright: true,\r\n\t\tbottom: true,\r\n\t\ttop: true,\r\n\t};\r\n\r\n\tif (sizeRestrictions.widthFrozen) {\r\n\t\tdirections.left = 0;\r\n\t\tdirections.right = 0;\r\n\t}\r\n\r\n\tif (sizeRestrictions.heightFrozen) {\r\n\t\tdirections.top = 0;\r\n\t\tdirections.bottom = 0;\r\n\t}\r\n\r\n\tALL_DIRECTIONS.forEach((direction) => {\r\n\t\tif (!allowedDirections[direction]) {\r\n\t\t\tdirections[direction] = 0;\r\n\t\t}\r\n\t});\r\n\r\n\t// 1. First step: determine the safe and desired area\r\n\tdirections = fitConditions({\r\n\t\tcoordinates: actualCoordinates,\r\n\t\tdirections,\r\n\t\tsizeRestrictions: sizeRestrictions,\r\n\t\tpositionRestrictions,\r\n\t});\r\n\r\n\t// 2. Second step: fix desired box to correspondent to aspect ratio\r\n\tlet currentWidth = applyDirections(actualCoordinates, directions).width;\r\n\tlet currentHeight = applyDirections(actualCoordinates, directions).height;\r\n\r\n\t// Checks ratio:\r\n\tlet ratioBroken = eventParams.preserveRatio\r\n\t\t? ratio(actualCoordinates)\r\n\t\t: getBrokenRatio(currentWidth / currentHeight, aspectRatio);\r\n\r\n\tif (ratioBroken) {\r\n\t\tlet { respectDirection } = eventParams;\r\n\t\tif (!respectDirection) {\r\n\t\t\tif (actualCoordinates.width >= actualCoordinates.height || ratioBroken === 1) {\r\n\t\t\t\trespectDirection = 'width';\r\n\t\t\t} else {\r\n\t\t\t\trespectDirection = 'height';\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (respectDirection === 'width') {\r\n\t\t\tconst overlapHeight = currentWidth / ratioBroken - actualCoordinates.height;\r\n\t\t\tif (allowedDirections.top && allowedDirections.bottom) {\r\n\t\t\t\tconst { top, bottom } = directions;\r\n\t\t\t\tdirections.bottom = distributeOverlap(overlapHeight, bottom, top);\r\n\t\t\t\tdirections.top = distributeOverlap(overlapHeight, top, bottom);\r\n\t\t\t} else if (allowedDirections.bottom) {\r\n\t\t\t\tdirections.bottom = overlapHeight;\r\n\t\t\t} else if (allowedDirections.top) {\r\n\t\t\t\tdirections.top = overlapHeight;\r\n\t\t\t} else if (allowedDirections.right) {\r\n\t\t\t\tdirections.right = 0;\r\n\t\t\t} else if (allowedDirections.left) {\r\n\t\t\t\tdirections.left = 0;\r\n\t\t\t}\r\n\t\t} else if (respectDirection === 'height') {\r\n\t\t\tconst overlapWidth = actualCoordinates.width - currentHeight * ratioBroken;\r\n\t\t\tif (allowedDirections.left && allowedDirections.right) {\r\n\t\t\t\tconst { left, right } = directions;\r\n\t\t\t\tdirections.left = -distributeOverlap(overlapWidth, left, right);\r\n\t\t\t\tdirections.right = -distributeOverlap(overlapWidth, right, left);\r\n\t\t\t} else if (allowedDirections.left) {\r\n\t\t\t\tdirections.left = -overlapWidth;\r\n\t\t\t} else if (allowedDirections.right) {\r\n\t\t\t\tdirections.right = -overlapWidth;\r\n\t\t\t} else if (allowedDirections.top) {\r\n\t\t\t\tdirections.top = 0;\r\n\t\t\t} else if (allowedDirections.bottom) {\r\n\t\t\t\tdirections.bottom = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// 3. Third step: check if desired box with correct aspect ratios break some limits and fit to this conditions\r\n\t\tdirections = fitConditions({\r\n\t\t\tdirections,\r\n\t\t\tcoordinates: actualCoordinates,\r\n\t\t\tsizeRestrictions: sizeRestrictions,\r\n\t\t\tpositionRestrictions,\r\n\t\t\tpreserveRatio: true,\r\n\t\t\tcompensate: eventParams.compensate,\r\n\t\t});\r\n\t}\r\n\r\n\t// 4. Check if ratio broken (temporary):\r\n\tcurrentWidth = applyDirections(actualCoordinates, directions).width;\r\n\tcurrentHeight = applyDirections(actualCoordinates, directions).height;\r\n\tratioBroken = eventParams.preserveRatio\r\n\t\t? ratio(actualCoordinates)\r\n\t\t: getBrokenRatio(currentWidth / currentHeight, aspectRatio);\r\n\tif (ratioBroken && Math.abs(ratioBroken - currentWidth / currentHeight) > 1e-3) {\r\n\t\tif (process.env.NODE_ENV !== 'production') {\r\n\t\t\tconsole.error(\r\n\t\t\t\t`Something went wrong and ratio was broken: ${currentWidth / currentHeight} instead of ${ratioBroken}`,\r\n\t\t\t);\r\n\t\t}\r\n\t\tALL_DIRECTIONS.forEach((direction) => {\r\n\t\t\tif (!allowedDirections[direction]) {\r\n\t\t\t\tdirections[direction] = 0;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\treturn move({\r\n\t\tevent: new MoveEvent({\r\n\t\t\tleft: -directions.left,\r\n\t\t\ttop: -directions.top,\r\n\t\t}),\r\n\t\tcoordinates: {\r\n\t\t\twidth: coordinates.width + directions.right + directions.left,\r\n\t\t\theight: coordinates.height + directions.top + directions.bottom,\r\n\t\t\tleft: coordinates.left,\r\n\t\t\ttop: coordinates.top,\r\n\t\t},\r\n\t\tpositionRestrictions,\r\n\t});\r\n}\r\n","<script>\r\nimport classnames from 'classnames';\r\nimport bem from 'easy-bem';\r\nimport { HandlerWrapper } from '../service';\r\n\r\nconst block = bem('vue-simple-handler');\r\nconst wrapper = bem('vue-simple-handler-wrapper');\r\n\r\nexport default {\r\n\tname: 'SimpleHandler',\r\n\tcomponents: {\r\n\t\tHandlerWrapper,\r\n\t},\r\n\tprops: {\r\n\t\tdefaultClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\thoverClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\twrapperClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\thorizontalPosition: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tverticalPosition: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tdisabled: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false,\r\n\t\t},\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\thover: false,\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tclasses() {\r\n\t\t\tconst options = {\r\n\t\t\t\t[this.horizontalPosition]: Boolean(this.horizontalPosition),\r\n\t\t\t\t[this.verticalPosition]: Boolean(this.verticalPosition),\r\n\t\t\t\t[`${this.horizontalPosition}-${this.verticalPosition}`]: Boolean(\r\n\t\t\t\t\tthis.verticalPosition && this.horizontalPosition,\r\n\t\t\t\t),\r\n\t\t\t\thover: this.hover,\r\n\t\t\t};\r\n\t\t\treturn {\r\n\t\t\t\tdefault: classnames(block(options), this.defaultClass, this.hover && this.hoverClass),\r\n\t\t\t\twrapper: classnames(wrapper(options), this.wrapperClass),\r\n\t\t\t};\r\n\t\t},\r\n\t},\r\n\tmethods: {\r\n\t\tonDrag(dragEvent) {\r\n\t\t\tthis.$emit('drag', dragEvent);\r\n\t\t},\r\n\t\tonEnter() {\r\n\t\t\tthis.hover = true;\r\n\t\t},\r\n\t\tonLeave() {\r\n\t\t\tthis.hover = false;\r\n\t\t},\r\n\t\tonDragEnd() {\r\n\t\t\tthis.$emit('drag-end');\r\n\t\t},\r\n\t},\r\n\temits: ['drag', 'drag-end'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<HandlerWrapper\r\n\t\t:class=\"classes.wrapper\"\r\n\t\t:vertical-position=\"verticalPosition\"\r\n\t\t:horizontal-position=\"horizontalPosition\"\r\n\t\t:disabled=\"disabled\"\r\n\t\t@drag=\"onDrag\"\r\n\t\t@drag-end=\"onDragEnd\"\r\n\t\t@enter=\"onEnter\"\r\n\t\t@leave=\"onLeave\"\r\n\t>\r\n\t\t<div :class=\"classes.default\" />\r\n\t</HandlerWrapper>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-simple-handler {\r\n\tdisplay: block;\r\n\tbackground: white;\r\n\theight: 10px;\r\n\twidth: 10px;\r\n}\r\n</style>\r\n","<script>\r\nimport bem from 'easy-bem';\r\nimport classnames from 'classnames';\r\nimport { LineWrapper } from '../service';\r\n\r\nconst block = bem('vue-simple-line');\r\nconst wrapper = bem('vue-simple-line-wrapper');\r\n\r\nexport default {\r\n\tname: 'SimpleLine',\r\n\tcomponents: {\r\n\t\tLineWrapper,\r\n\t},\r\n\tprops: {\r\n\t\tdefaultClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\thoverClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\twrapperClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tposition: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tdisabled: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false,\r\n\t\t},\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\thover: false,\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tclasses() {\r\n\t\t\treturn {\r\n\t\t\t\troot: classnames(block({ [this.position]: true }), this.defaultClass, this.hover && this.hoverClass),\r\n\t\t\t\twrapper: classnames(wrapper({ [this.position]: true }), this.wrapperClass),\r\n\t\t\t};\r\n\t\t},\r\n\t},\r\n\tmethods: {\r\n\t\tonDrag(dragEvent) {\r\n\t\t\tthis.$emit('drag', dragEvent);\r\n\t\t},\r\n\t\tonEnter() {\r\n\t\t\tthis.hover = true;\r\n\t\t},\r\n\t\tonLeave() {\r\n\t\t\tthis.hover = false;\r\n\t\t},\r\n\t\tonDragEnd() {\r\n\t\t\tthis.$emit('drag-end');\r\n\t\t},\r\n\t},\r\n\temits: ['drag', 'drag-end'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<LineWrapper\r\n\t\t:class=\"classes.wrapper\"\r\n\t\t:position=\"position\"\r\n\t\t:disabled=\"disabled\"\r\n\t\t@drag=\"onDrag\"\r\n\t\t@drag-end=\"onDragEnd\"\r\n\t\t@enter=\"onEnter\"\r\n\t\t@leave=\"onLeave\"\r\n\t>\r\n\t\t<div :class=\"classes.root\" />\r\n\t</LineWrapper>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-simple-line {\r\n\tbackground: none;\r\n\ttransition: border 0.5s;\r\n\tborder-color: rgba(white, 0.3);\r\n\tborder-width: 0;\r\n\tborder-style: solid;\r\n\r\n\t&--south,\r\n\t&--north {\r\n\t\theight: 0;\r\n\t\twidth: 100%;\r\n\t}\r\n\r\n\t&--east,\r\n\t&--west {\r\n\t\theight: 100%;\r\n\t\twidth: 0;\r\n\t}\r\n\r\n\t&--east {\r\n\t\tborder-right-width: 1px;\r\n\t}\r\n\t&--west {\r\n\t\tborder-left-width: 1px;\r\n\t}\r\n\t&--south {\r\n\t\tborder-bottom-width: 1px;\r\n\t}\r\n\t&--north {\r\n\t\tborder-top-width: 1px;\r\n\t}\r\n\r\n\t&--hover {\r\n\t\topacity: 1;\r\n\t\tborder-color: white;\r\n\t}\r\n}\r\n</style>\r\n","<script>\r\nimport bem from 'easy-bem';\r\nimport classnames from 'classnames';\r\nimport { isEmpty, replacedProp } from '../../core';\r\nimport { directionNames } from '../../core/utils';\r\nimport { ResizeEvent } from '../../core/events';\r\nimport { SimpleHandler } from '../handlers';\r\nimport { SimpleLine } from '../lines';\r\n\r\nconst cn = bem('vue-bounding-box');\r\n\r\nconst HORIZONTAL_DIRECTIONS = ['east', 'west', null];\r\nconst VERTICAL_DIRECTIONS = ['south', 'north', null];\r\n\r\nexport default {\r\n\tname: 'BoundingBox',\r\n\tprops: {\r\n\t\twidth: {\r\n\t\t\ttype: Number,\r\n\t\t},\r\n\t\theight: {\r\n\t\t\ttype: Number,\r\n\t\t},\r\n\t\ttransitions: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\thandlers: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\teastNorth: true,\r\n\t\t\t\t\tnorth: true,\r\n\t\t\t\t\twestNorth: true,\r\n\t\t\t\t\twest: true,\r\n\t\t\t\t\twestSouth: true,\r\n\t\t\t\t\tsouth: true,\r\n\t\t\t\t\teastSouth: true,\r\n\t\t\t\t\teast: true,\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t},\r\n\t\thandlersComponent: {\r\n\t\t\ttype: [Object, String],\r\n\t\t\tdefault() {\r\n\t\t\t\treturn SimpleHandler;\r\n\t\t\t},\r\n\t\t},\r\n\t\thandlersClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\thandlersWrappersClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\tlines: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\twest: true,\r\n\t\t\t\t\tnorth: true,\r\n\t\t\t\t\teast: true,\r\n\t\t\t\t\tsouth: true,\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t},\r\n\t\tlinesComponent: {\r\n\t\t\ttype: [Object, String],\r\n\t\t\tdefault() {\r\n\t\t\t\treturn SimpleLine;\r\n\t\t\t},\r\n\t\t},\r\n\t\tlinesClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\tlinesWrappersClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\tresizable: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t},\r\n\tdata() {\r\n\t\tconst points = [];\r\n\t\tHORIZONTAL_DIRECTIONS.forEach((hDirection) => {\r\n\t\t\tVERTICAL_DIRECTIONS.forEach((vDirection) => {\r\n\t\t\t\tif (hDirection !== vDirection) {\r\n\t\t\t\t\tlet { name, classname } = directionNames(hDirection, vDirection);\r\n\t\t\t\t\tpoints.push({\r\n\t\t\t\t\t\tname,\r\n\t\t\t\t\t\tclassname,\r\n\t\t\t\t\t\tverticalDirection: vDirection,\r\n\t\t\t\t\t\thorizontalDirection: hDirection,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tpoints,\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tstyle() {\r\n\t\t\tconst result = {};\r\n\t\t\tif (this.width && this.height) {\r\n\t\t\t\tresult.width = `${this.width}px`;\r\n\t\t\t\tresult.height = `${this.height}px`;\r\n\r\n\t\t\t\tif (this.transitions && this.transitions.enabled) {\r\n\t\t\t\t\tresult.transition = `${this.transitions.time}ms ${this.transitions.timingFunction}`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\tclasses() {\r\n\t\t\tconst handlers = this.handlersClasses;\r\n\t\t\tconst handlersWrappers = this.handlersWrappersClasses;\r\n\t\t\tconst lines = this.linesClasses;\r\n\t\t\tconst linesWrappers = this.linesWrappersClasses;\r\n\r\n\t\t\treturn {\r\n\t\t\t\troot: cn(),\r\n\t\t\t\thandlers,\r\n\t\t\t\thandlersWrappers,\r\n\t\t\t\tlines,\r\n\t\t\t\tlinesWrappers,\r\n\t\t\t};\r\n\t\t},\r\n\t\tlineNodes() {\r\n\t\t\tconst lines = [];\r\n\t\t\tthis.points.forEach((point) => {\r\n\t\t\t\tif ((!point.horizontalDirection || !point.verticalDirection) && this.lines[point.name]) {\r\n\t\t\t\t\tlines.push({\r\n\t\t\t\t\t\tname: point.name,\r\n\t\t\t\t\t\tcomponent: this.linesComponent,\r\n\t\t\t\t\t\tclass: classnames(\r\n\t\t\t\t\t\t\tthis.classes.lines.default,\r\n\t\t\t\t\t\t\tthis.classes.lines[point.name],\r\n\t\t\t\t\t\t\t!this.resizable && this.classes.lines.disabled,\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\twrapperClass: classnames(\r\n\t\t\t\t\t\t\tthis.classes.linesWrappers.default,\r\n\t\t\t\t\t\t\tthis.classes.linesWrappers[point.name],\r\n\t\t\t\t\t\t\t!this.resizable && this.classes.linesWrappers.disabled,\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\thoverClass: this.classes.lines.hover,\r\n\t\t\t\t\t\tverticalDirection: point.verticalDirection,\r\n\t\t\t\t\t\thorizontalDirection: point.horizontalDirection,\r\n\t\t\t\t\t\tdisabled: !this.resizable,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn lines;\r\n\t\t},\r\n\t\thandlerNodes() {\r\n\t\t\tconst handlers = [];\r\n\t\t\tconst { width, height } = this;\r\n\t\t\tthis.points.forEach((point) => {\r\n\t\t\t\tif (this.handlers[point.name]) {\r\n\t\t\t\t\tconst result = {\r\n\t\t\t\t\t\tname: point.name,\r\n\t\t\t\t\t\tcomponent: this.handlersComponent,\r\n\t\t\t\t\t\tclass: classnames(this.classes.handlers.default, this.classes.handlers[point.name]),\r\n\t\t\t\t\t\twrapperClass: classnames(\r\n\t\t\t\t\t\t\tthis.classes.handlersWrappers.default,\r\n\t\t\t\t\t\t\tthis.classes.handlersWrappers[point.name],\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\thoverClass: this.classes.handlers.hover,\r\n\t\t\t\t\t\tverticalDirection: point.verticalDirection,\r\n\t\t\t\t\t\thorizontalDirection: point.horizontalDirection,\r\n\t\t\t\t\t\tdisabled: !this.resizable,\r\n\t\t\t\t\t};\r\n\t\t\t\t\tif (width && height) {\r\n\t\t\t\t\t\tconst { horizontalDirection, verticalDirection } = point;\r\n\t\t\t\t\t\tconst left =\r\n\t\t\t\t\t\t\thorizontalDirection === 'east' ? width : horizontalDirection === 'west' ? 0 : width / 2;\r\n\t\t\t\t\t\tconst top =\r\n\t\t\t\t\t\t\tverticalDirection === 'south' ? height : verticalDirection === 'north' ? 0 : height / 2;\r\n\t\t\t\t\t\tresult.wrapperClass = cn('handler');\r\n\t\t\t\t\t\tresult.wrapperStyle = {\r\n\t\t\t\t\t\t\ttransform: `translate(${left}px, ${top}px)`,\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tif (this.transitions && this.transitions.enabled) {\r\n\t\t\t\t\t\t\tresult.wrapperStyle.transition = `${this.transitions.time}ms ${this.transitions.timingFunction}`;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresult.wrapperClass = cn('handler', { [point.classname]: true });\r\n\t\t\t\t\t}\r\n\t\t\t\t\thandlers.push(result);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn handlers;\r\n\t\t},\r\n\t},\r\n\tbeforeMount() {\r\n\t\twindow.addEventListener('mouseup', this.onMouseUp, { passive: false });\r\n\t\twindow.addEventListener('mousemove', this.onMouseMove, { passive: false });\r\n\t\twindow.addEventListener('touchmove', this.onTouchMove, { passive: false });\r\n\t\twindow.addEventListener('touchend', this.onTouchEnd, { passive: false });\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\twindow.removeEventListener('mouseup', this.onMouseUp);\r\n\t\twindow.removeEventListener('mousemove', this.onMouseMove);\r\n\t\twindow.removeEventListener('touchmove', this.onTouchMove);\r\n\t\twindow.removeEventListener('touchend', this.onTouchEnd);\r\n\t},\r\n\tmounted() {\r\n\t\tthis.touches = [];\r\n\t},\r\n\tmethods: {\r\n\t\tonEnd() {\r\n\t\t\tthis.$emit('resize-end');\r\n\t\t},\r\n\t\tonHandlerDrag(dragEvent, horizontalDirection, verticalDirection) {\r\n\t\t\tconst { left, top } = dragEvent.shift();\r\n\r\n\t\t\tconst directions = {\r\n\t\t\t\tleft: 0,\r\n\t\t\t\tright: 0,\r\n\t\t\t\ttop: 0,\r\n\t\t\t\tbottom: 0,\r\n\t\t\t};\r\n\r\n\t\t\tif (horizontalDirection === 'west') {\r\n\t\t\t\tdirections.left -= left;\r\n\t\t\t} else if (horizontalDirection === 'east') {\r\n\t\t\t\tdirections.right += left;\r\n\t\t\t}\r\n\t\t\tif (verticalDirection === 'north') {\r\n\t\t\t\tdirections.top -= top;\r\n\t\t\t} else if (verticalDirection === 'south') {\r\n\t\t\t\tdirections.bottom += top;\r\n\t\t\t}\r\n\r\n\t\t\tlet respectDirection;\r\n\t\t\tif (!verticalDirection && horizontalDirection) {\r\n\t\t\t\trespectDirection = 'width';\r\n\t\t\t} else if (verticalDirection && !horizontalDirection) {\r\n\t\t\t\trespectDirection = 'height';\r\n\t\t\t}\r\n\r\n\t\t\tif (this.resizable) {\r\n\t\t\t\tthis.$emit(\r\n\t\t\t\t\t'resize',\r\n\t\t\t\t\tnew ResizeEvent(directions, {\r\n\t\t\t\t\t\tallowedDirections: {\r\n\t\t\t\t\t\t\tleft: horizontalDirection === 'west' || !horizontalDirection,\r\n\t\t\t\t\t\t\tright: horizontalDirection === 'east' || !horizontalDirection,\r\n\t\t\t\t\t\t\tbottom: verticalDirection === 'south' || !verticalDirection,\r\n\t\t\t\t\t\t\ttop: verticalDirection === 'north' || !verticalDirection,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tpreserveAspectRatio: dragEvent.nativeEvent && dragEvent.nativeEvent.shiftKey,\r\n\t\t\t\t\t\trespectDirection,\r\n\t\t\t\t\t}),\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n\temits: ['resize', 'resize-end'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<div ref=\"box\" :class=\"classes.root\" :style=\"style\">\r\n\t\t<slot />\r\n\t\t<div>\r\n\t\t\t<component\r\n\t\t\t\t:is=\"line.component\"\r\n\t\t\t\tv-for=\"line in lineNodes\"\r\n\t\t\t\t:key=\"line.name\"\r\n\t\t\t\t:default-class=\"line.class\"\r\n\t\t\t\t:hover-class=\"line.hoverClass\"\r\n\t\t\t\t:wrapper-class=\"line.wrapperClass\"\r\n\t\t\t\t:position=\"line.name\"\r\n\t\t\t\t:disabled=\"line.disabled\"\r\n\t\t\t\t@drag=\"onHandlerDrag($event, line.horizontalDirection, line.verticalDirection)\"\r\n\t\t\t\t@drag-end=\"onEnd()\"\r\n\t\t\t/>\r\n\t\t</div>\r\n\t\t<div\r\n\t\t\tv-for=\"handler in handlerNodes\"\r\n\t\t\t:key=\"handler.name\"\r\n\t\t\t:style=\"handler.wrapperStyle\"\r\n\t\t\t:class=\"handler.wrapperClass\"\r\n\t\t>\r\n\t\t\t<component\r\n\t\t\t\t:is=\"handler.component\"\r\n\t\t\t\t:default-class=\"handler.class\"\r\n\t\t\t\t:hover-class=\"handler.hoverClass\"\r\n\t\t\t\t:wrapper-class=\"handler.wrapperClass\"\r\n\t\t\t\t:horizontal-position=\"handler.horizontalDirection\"\r\n\t\t\t\t:vertical-position=\"handler.verticalDirection\"\r\n\t\t\t\t:disabled=\"handler.disabled\"\r\n\t\t\t\t@drag=\"onHandlerDrag($event, handler.horizontalDirection, handler.verticalDirection)\"\r\n\t\t\t\t@drag-end=\"onEnd()\"\r\n\t\t\t/>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-bounding-box {\r\n\tposition: relative;\r\n\theight: 100%;\r\n\twidth: 100%;\r\n\t&__handler {\r\n\t\tposition: absolute;\r\n\t\t&--west-north {\r\n\t\t\tleft: 0;\r\n\t\t\ttop: 0;\r\n\t\t}\r\n\t\t&--north {\r\n\t\t\tleft: 50%;\r\n\t\t\ttop: 0;\r\n\t\t}\r\n\t\t&--east-north {\r\n\t\t\tleft: 100%;\r\n\t\t\ttop: 0;\r\n\t\t}\r\n\t\t&--east {\r\n\t\t\tleft: 100%;\r\n\t\t\ttop: 50%;\r\n\t\t}\r\n\t\t&--east-south {\r\n\t\t\tleft: 100%;\r\n\t\t\ttop: 100%;\r\n\t\t}\r\n\t\t&--south {\r\n\t\t\tleft: 50%;\r\n\t\t\ttop: 100%;\r\n\t\t}\r\n\t\t&--west-south {\r\n\t\t\tleft: 0;\r\n\t\t\ttop: 100%;\r\n\t\t}\r\n\t\t&--west {\r\n\t\t\tleft: 0;\r\n\t\t\ttop: 50%;\r\n\t\t}\r\n\t}\r\n}\r\n</style>\r\n","<script>\r\nimport classnames from 'classnames';\r\nimport bem from 'easy-bem';\r\nimport { distance } from '../../core/utils';\r\nimport { MoveEvent } from '../../core/events.ts';\r\n\r\nconst cn = bem('vue-draggable-area');\r\n\r\nexport default {\r\n\tname: 'DraggableArea',\r\n\tprops: {\r\n\t\tmovable: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t\tactivationDistance: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 20,\r\n\t\t},\r\n\t},\r\n\tcomputed: {\r\n\t\tclassnames() {\r\n\t\t\treturn {\r\n\t\t\t\tdefault: cn(),\r\n\t\t\t};\r\n\t\t},\r\n\t},\r\n\tbeforeMount() {\r\n\t\twindow.addEventListener('mouseup', this.onMouseUp, { passive: false });\r\n\t\twindow.addEventListener('mousemove', this.onMouseMove, { passive: false });\r\n\t\twindow.addEventListener('touchmove', this.onTouchMove, { passive: false });\r\n\t\twindow.addEventListener('touchend', this.onTouchEnd, { passive: false });\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\twindow.removeEventListener('mouseup', this.onMouseUp);\r\n\t\twindow.removeEventListener('mousemove', this.onMouseMove);\r\n\t\twindow.removeEventListener('touchmove', this.onTouchMove);\r\n\t\twindow.removeEventListener('touchend', this.onTouchEnd);\r\n\t},\r\n\tmounted() {\r\n\t\tthis.touches = [];\r\n\t\tthis.touchStarted = false;\r\n\t},\r\n\tmethods: {\r\n\t\tonTouchStart(e) {\r\n\t\t\tif (e.cancelable) {\r\n\t\t\t\tconst shouldStartMove = this.movable && e.touches.length === 1;\r\n\t\t\t\tif (shouldStartMove) {\r\n\t\t\t\t\tthis.touches = [...e.touches];\r\n\t\t\t\t}\r\n\t\t\t\tif (this.touchStarted || shouldStartMove) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonTouchEnd() {\r\n\t\t\tthis.touchStarted = false;\r\n\t\t\tthis.processEnd();\r\n\t\t},\r\n\t\tonTouchMove(e) {\r\n\t\t\tif (this.touches.length >= 1) {\r\n\t\t\t\tif (this.touchStarted) {\r\n\t\t\t\t\tthis.processMove(e, e.touches);\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t} else if (\r\n\t\t\t\t\tdistance(\r\n\t\t\t\t\t\t{ x: this.touches[0].clientX, y: this.touches[0].clientY },\r\n\t\t\t\t\t\t{ x: e.touches[0].clientX, y: e.touches[0].clientY },\r\n\t\t\t\t\t) > this.activationDistance\r\n\t\t\t\t) {\r\n\t\t\t\t\tthis.initAnchor({\r\n\t\t\t\t\t\tclientX: e.touches[0].clientX,\r\n\t\t\t\t\t\tclientY: e.touches[0].clientY,\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.touchStarted = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMouseDown(e) {\r\n\t\t\tif (this.movable && e.button === 0) {\r\n\t\t\t\tconst touch = {\r\n\t\t\t\t\tfake: true,\r\n\t\t\t\t\tclientX: e.clientX,\r\n\t\t\t\t\tclientY: e.clientY,\r\n\t\t\t\t};\r\n\t\t\t\tthis.touches = [touch];\r\n\t\t\t\tthis.initAnchor(touch);\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMouseMove(e) {\r\n\t\t\tif (this.touches.length) {\r\n\t\t\t\tthis.processMove(e, [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfake: true,\r\n\t\t\t\t\t\tclientX: e.clientX,\r\n\t\t\t\t\t\tclientY: e.clientY,\r\n\t\t\t\t\t},\r\n\t\t\t\t]);\r\n\t\t\t\tif (e.preventDefault && e.cancelable) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMouseUp() {\r\n\t\t\tthis.processEnd();\r\n\t\t},\r\n\t\tinitAnchor(touch) {\r\n\t\t\tconst container = this.$refs.container;\r\n\t\t\tconst { left, top } = container.getBoundingClientRect();\r\n\r\n\t\t\tthis.anchor = {\r\n\t\t\t\tx: touch.clientX - left,\r\n\t\t\t\ty: touch.clientY - top,\r\n\t\t\t};\r\n\t\t},\r\n\t\tprocessMove(event, touches) {\r\n\t\t\tconst newTouches = [...touches];\r\n\t\t\tif (this.touches.length) {\r\n\t\t\t\tconst container = this.$refs.container;\r\n\t\t\t\tconst { left, top } = container.getBoundingClientRect();\r\n\t\t\t\tif (this.touches.length === 1 && newTouches.length === 1) {\r\n\t\t\t\t\tthis.$emit(\r\n\t\t\t\t\t\t'move',\r\n\t\t\t\t\t\tnew MoveEvent({\r\n\t\t\t\t\t\t\tleft: newTouches[0].clientX - (left + this.anchor.x),\r\n\t\t\t\t\t\t\ttop: newTouches[0].clientY - (top + this.anchor.y),\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tprocessEnd() {\r\n\t\t\tif (this.touches.length) {\r\n\t\t\t\tthis.$emit('move-end');\r\n\t\t\t}\r\n\t\t\tthis.touches = [];\r\n\t\t},\r\n\t},\r\n\temits: ['move', 'move-end'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<div ref=\"container\" @touchstart=\"onTouchStart\" @mousedown=\"onMouseDown\">\r\n\t\t<slot />\r\n\t</div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-draggable-area {\r\n\tposition: relative;\r\n}\r\n</style>\r\n","import { ImageTransforms } from './typings';\r\nimport { getCenter, rotatePoint, rotateSize } from './service';\r\n\r\nexport const XHR_DONE = 4;\r\n\r\nexport function prepareSource(canvas, image, { rotate, flip }) {\r\n\tconst originalSize = {\r\n\t\twidth: image.naturalWidth,\r\n\t\theight: image.naturalHeight,\r\n\t};\r\n\r\n\tconst transformedSize = rotateSize(originalSize, rotate);\r\n\r\n\tconst ctx = canvas.getContext('2d');\r\n\tcanvas.height = transformedSize.height;\r\n\tcanvas.width = transformedSize.width;\r\n\r\n\tctx.save();\r\n\r\n\t// Rotation:\r\n\tconst originalCenter = {\r\n\t\tleft: originalSize.width / 2,\r\n\t\ttop: originalSize.height / 2,\r\n\t};\r\n\r\n\tlet canvasCenter = rotatePoint(\r\n\t\tgetCenter({\r\n\t\t\tleft: 0,\r\n\t\t\ttop: 0,\r\n\t\t\t...originalSize,\r\n\t\t}),\r\n\t\trotate,\r\n\t);\r\n\r\n\tctx.translate(-(canvasCenter.left - transformedSize.width / 2), -(canvasCenter.top - transformedSize.height / 2));\r\n\tctx.rotate((rotate * Math.PI) / 180);\r\n\r\n\t// Reflection;\r\n\tctx.translate(flip.horizontal ? originalSize.width : 0, flip.vertical ? originalSize.height : 0);\r\n\tctx.scale(flip.horizontal ? -1 : 1, flip.vertical ? -1 : 1);\r\n\r\n\tctx.drawImage(image, 0, 0, originalSize.width, originalSize.height);\r\n\tctx.restore();\r\n\r\n\treturn canvas;\r\n}\r\n\r\nfunction base64ToArrayBuffer(base64) {\r\n\tbase64 = base64.replace(/^data:([^;]+);base64,/gim, '');\r\n\tconst binary = atob(base64);\r\n\tconst len = binary.length;\r\n\tconst buffer = new ArrayBuffer(len);\r\n\tconst view = new Uint8Array(buffer);\r\n\tfor (let i = 0; i < len; i++) {\r\n\t\tview[i] = binary.charCodeAt(i);\r\n\t}\r\n\treturn buffer;\r\n}\r\n\r\nfunction objectURLToBlob(url, callback) {\r\n\tconst http = new XMLHttpRequest();\r\n\thttp.open('GET', url, true);\r\n\thttp.responseType = 'blob';\r\n\thttp.onload = function () {\r\n\t\tif (this.status == 200 || this.status === 0) {\r\n\t\t\tcallback(this.response);\r\n\t\t}\r\n\t};\r\n\thttp.send();\r\n}\r\n\r\nexport function getImageTransforms(orientation: number) {\r\n\tconst result: ImageTransforms = {\r\n\t\tflip: {\r\n\t\t\thorizontal: false,\r\n\t\t\tvertical: false,\r\n\t\t},\r\n\t\trotate: 0,\r\n\t};\r\n\tif (orientation) {\r\n\t\tswitch (orientation) {\r\n\t\t\tcase 2:\r\n\t\t\t\tresult.flip.horizontal = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tresult.rotate = -180;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tresult.flip.vertical = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tresult.rotate = 90;\r\n\t\t\t\tresult.flip.vertical = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tresult.rotate = 90;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 7:\r\n\t\t\t\tresult.rotate = 90;\r\n\t\t\t\tresult.flip.horizontal = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 8:\r\n\t\t\t\tresult.rotate = -90;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\nfunction getImageData(img) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tif (img) {\r\n\t\t\t\tif (/^data:/i.test(img)) {\r\n\t\t\t\t\t// Data URL\r\n\t\t\t\t\tresolve(base64ToArrayBuffer(img));\r\n\t\t\t\t} else if (/^blob:/i.test(img)) {\r\n\t\t\t\t\t// Blob\r\n\t\t\t\t\tconst fileReader = new FileReader();\r\n\t\t\t\t\tfileReader.onload = function (e) {\r\n\t\t\t\t\t\tresolve(e.target.result);\r\n\t\t\t\t\t};\r\n\t\t\t\t\tobjectURLToBlob(img, function (blob) {\r\n\t\t\t\t\t\tfileReader.readAsArrayBuffer(blob);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Simple URL\r\n\t\t\t\t\tlet http = new XMLHttpRequest();\r\n\t\t\t\t\thttp.onreadystatechange = function () {\r\n\t\t\t\t\t\tif (http.readyState !== XHR_DONE) return;\r\n\r\n\t\t\t\t\t\tif (http.status === 200 || http.status === 0) {\r\n\t\t\t\t\t\t\tresolve(http.response);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treject('Warning: could not load an image to parse its orientation');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\thttp = null;\r\n\t\t\t\t\t};\r\n\t\t\t\t\thttp.onprogress = function () {\r\n\t\t\t\t\t\t// Abort the request directly if it not a JPEG image for better performance\r\n\t\t\t\t\t\tif (http.getResponseHeader('content-type') !== 'image/jpeg') {\r\n\t\t\t\t\t\t\thttp.abort();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t\thttp.withCredentials = false;\r\n\t\t\t\t\thttp.open('GET', img, true);\r\n\t\t\t\t\thttp.responseType = 'arraybuffer';\r\n\t\t\t\t\thttp.send(null);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treject('Error: the image is empty');\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nexport function getStyleTransforms({ rotate, flip, scaleX, scaleY }) {\r\n\tlet transform = '';\r\n\ttransform += ` rotate(${rotate}deg) `;\r\n\ttransform += ` scaleX(${scaleX * (flip.horizontal ? -1 : 1)}) `;\r\n\ttransform += ` scaleY(${scaleY * (flip.vertical ? -1 : 1)}) `;\r\n\treturn transform;\r\n}\r\n\r\nfunction getStringFromCharCode(dataView, start, length) {\r\n\tlet str = '';\r\n\tlet i;\r\n\tfor (i = start, length += start; i < length; i++) {\r\n\t\tstr += String.fromCharCode(dataView.getUint8(i));\r\n\t}\r\n\treturn str;\r\n}\r\n\r\nfunction resetAndGetOrientation(arrayBuffer) {\r\n\ttry {\r\n\t\tconst dataView = new DataView(arrayBuffer);\r\n\t\tlet orientation;\r\n\t\tlet exifIDCode;\r\n\t\tlet tiffOffset;\r\n\t\tlet littleEndian;\r\n\t\tlet app1Start;\r\n\t\tlet ifdStart;\r\n\t\t// Only handle JPEG image (start by 0xFFD8)\r\n\t\tif (dataView.getUint8(0) === 0xff && dataView.getUint8(1) === 0xd8) {\r\n\t\t\tconst length = dataView.byteLength;\r\n\t\t\tlet offset = 2;\r\n\t\t\twhile (offset + 1 < length) {\r\n\t\t\t\tif (dataView.getUint8(offset) === 0xff && dataView.getUint8(offset + 1) === 0xe1) {\r\n\t\t\t\t\tapp1Start = offset;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\toffset++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (app1Start) {\r\n\t\t\texifIDCode = app1Start + 4;\r\n\t\t\ttiffOffset = app1Start + 10;\r\n\t\t\tif (getStringFromCharCode(dataView, exifIDCode, 4) === 'Exif') {\r\n\t\t\t\tconst endianness = dataView.getUint16(tiffOffset);\r\n\r\n\t\t\t\tlittleEndian = endianness === 0x4949;\r\n\r\n\t\t\t\tif (littleEndian || endianness === 0x4d4d /* bigEndian */) {\r\n\t\t\t\t\tif (dataView.getUint16(tiffOffset + 2, littleEndian) === 0x002a) {\r\n\t\t\t\t\t\tconst firstIFDOffset = dataView.getUint32(tiffOffset + 4, littleEndian);\r\n\t\t\t\t\t\tif (firstIFDOffset >= 0x00000008) {\r\n\t\t\t\t\t\t\tifdStart = tiffOffset + firstIFDOffset;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (ifdStart) {\r\n\t\t\tconst length = dataView.getUint16(ifdStart, littleEndian);\r\n\r\n\t\t\tfor (let i = 0; i < length; i++) {\r\n\t\t\t\tlet offset = ifdStart + i * 12 + 2;\r\n\t\t\t\tif (dataView.getUint16(offset, littleEndian) === 0x0112 /* Orientation */) {\r\n\t\t\t\t\t// 8 is the offset of the current tag's value\r\n\t\t\t\t\toffset += 8;\r\n\t\t\t\t\t// Get the original orientation value\r\n\t\t\t\t\torientation = dataView.getUint16(offset, littleEndian);\r\n\t\t\t\t\t// Override the orientation with its default value\r\n\t\t\t\t\tdataView.setUint16(offset, 1, littleEndian);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn orientation;\r\n\t} catch (error) {\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nexport function parseImage(src: string) {\r\n\treturn new Promise((resolve) => {\r\n\t\tgetImageData(src)\r\n\t\t\t.then((data) => {\r\n\t\t\t\tconst orientation = resetAndGetOrientation(data);\r\n\t\t\t\tresolve(\r\n\t\t\t\t\tdata\r\n\t\t\t\t\t\t? { source: src, arrayBuffer: data, orientation }\r\n\t\t\t\t\t\t: { source: src, arrayBuffer: null, orientation: null },\r\n\t\t\t\t);\r\n\t\t\t})\r\n\t\t\t.catch((error) => {\r\n\t\t\t\tconsole.warn(error);\r\n\t\t\t\tresolve({ source: src, arrayBuffer: null, orientation: null });\r\n\t\t\t});\r\n\t});\r\n}\r\n\r\nexport function arrayBufferToDataURL(arrayBuffer) {\r\n\tconst chunks = [];\r\n\r\n\t// Chunk Typed Array for better performance\r\n\tconst chunkSize = 8192;\r\n\tlet uint8 = new Uint8Array(arrayBuffer);\r\n\r\n\twhile (uint8.length > 0) {\r\n\t\tconst value = uint8.subarray(0, chunkSize);\r\n\t\tchunks.push(String.fromCharCode.apply(null, Array.from ? Array.from(value) : value.slice()));\r\n\t\tuint8 = uint8.subarray(chunkSize);\r\n\t}\r\n\r\n\treturn `data:image/jpeg;base64,${btoa(chunks.join(''))}`;\r\n}\r\n","<script>\r\nimport bem from 'easy-bem';\r\nimport classnames from 'classnames';\r\nimport { radians } from '../../core';\r\nimport { getStyleTransforms } from '../../core/image';\r\nimport { rotateSize } from '../../core/service';\r\n\r\nconst cn = bem('vue-preview-result');\r\n\r\nexport default {\r\n\tname: 'PreviewResult',\r\n\tprops: {\r\n\t\timage: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\ttransitions: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\tstencilCoordinates: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\twidth: 0,\r\n\t\t\t\t\theight: 0,\r\n\t\t\t\t\tleft: 0,\r\n\t\t\t\t\ttop: 0,\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t},\r\n\t\timageClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t},\r\n\tcomputed: {\r\n\t\tclasses() {\r\n\t\t\treturn {\r\n\t\t\t\troot: cn(),\r\n\t\t\t\twrapper: cn('wrapper'),\r\n\t\t\t\timageWrapper: cn('image-wrapper'),\r\n\t\t\t\timage: classnames(cn('image'), this.imageClass),\r\n\t\t\t};\r\n\t\t},\r\n\t\twrapperStyle() {\r\n\t\t\tconst result = {\r\n\t\t\t\twidth: `${this.stencilCoordinates.width}px`,\r\n\t\t\t\theight: `${this.stencilCoordinates.height}px`,\r\n\t\t\t\tleft: `calc(50% - ${this.stencilCoordinates.width / 2}px)`,\r\n\t\t\t\ttop: `calc(50% - ${this.stencilCoordinates.height / 2}px)`,\r\n\t\t\t};\r\n\t\t\tif (this.transitions && this.transitions.enabled) {\r\n\t\t\t\tresult.transition = `${this.transitions.time}ms ${this.transitions.timingFunction}`;\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\timageStyle() {\r\n\t\t\tconst imageTransforms = this.image.transforms;\r\n\r\n\t\t\tconst virtualSize = rotateSize(\r\n\t\t\t\t{\r\n\t\t\t\t\twidth: this.image.width,\r\n\t\t\t\t\theight: this.image.height,\r\n\t\t\t\t},\r\n\t\t\t\timageTransforms.rotate,\r\n\t\t\t);\r\n\r\n\t\t\tconst result = {\r\n\t\t\t\twidth: `${this.image.width}px`,\r\n\t\t\t\theight: `${this.image.height}px`,\r\n\t\t\t\tleft: '0px',\r\n\t\t\t\ttop: '0px',\r\n\t\t\t};\r\n\r\n\t\t\tconst compensations = {\r\n\t\t\t\trotate: {\r\n\t\t\t\t\tleft: ((this.image.width - virtualSize.width) * imageTransforms.scaleX) / 2,\r\n\t\t\t\t\ttop: ((this.image.height - virtualSize.height) * imageTransforms.scaleY) / 2,\r\n\t\t\t\t},\r\n\t\t\t\tscale: {\r\n\t\t\t\t\tleft: ((1 - imageTransforms.scaleX) * this.image.width) / 2,\r\n\t\t\t\t\ttop: ((1 - imageTransforms.scaleY) * this.image.height) / 2,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\r\n\t\t\tresult.transform =\r\n\t\t\t\t`translate(\r\n\t\t\t\t${\r\n\t\t\t\t\t-this.stencilCoordinates.left -\r\n\t\t\t\t\timageTransforms.translateX -\r\n\t\t\t\t\tcompensations.rotate.left -\r\n\t\t\t\t\tcompensations.scale.left\r\n\t\t\t\t}px,${\r\n\t\t\t\t\t-this.stencilCoordinates.top -\r\n\t\t\t\t\timageTransforms.translateY -\r\n\t\t\t\t\tcompensations.rotate.top -\r\n\t\t\t\t\tcompensations.scale.top\r\n\t\t\t\t}px) ` + getStyleTransforms(imageTransforms);\r\n\r\n\t\t\tif (this.transitions && this.transitions.enabled) {\r\n\t\t\t\tresult.transition = `${this.transitions.time}ms ${this.transitions.timingFunction}`;\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t},\r\n\t},\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<div :class=\"classes.root\">\r\n\t\t<div ref=\"wrapper\" :class=\"classes.wrapper\" :style=\"wrapperStyle\">\r\n\t\t\t<img ref=\"image\" :src=\"image.src\" :class=\"classes.image\" :style=\"imageStyle\" />\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-preview-result {\r\n\toverflow: hidden;\r\n\tbox-sizing: border-box;\r\n\tposition: absolute;\r\n\theight: 100%;\r\n\twidth: 100%;\r\n\t&__wrapper {\r\n\t\tposition: absolute;\r\n\t}\r\n\r\n\t&__image {\r\n\t\tpointer-events: none;\r\n\t\tposition: relative;\r\n\t\tuser-select: none;\r\n\t\ttransform-origin: center;\r\n\t\t// Workaround to prevent bugs at the websites with max-width\r\n\t\t// rule applied to img (Vuepress for example)\r\n\t\tmax-width: none !important;\r\n\t}\r\n}\r\n</style>\r\n","import { distance } from './utils';\r\n\r\nexport function calculateGeometricProperties(touches: Touch[], container: HTMLElement) {\r\n\tconst { left, top } = container.getBoundingClientRect();\r\n\r\n\tconst centerMass = { left: 0, top: 0 };\r\n\tlet spread = 0;\r\n\r\n\ttouches.forEach((touch) => {\r\n\t\tcenterMass.left += (touch.clientX - left) / touches.length;\r\n\t\tcenterMass.top += (touch.clientY - top) / touches.length;\r\n\t});\r\n\r\n\ttouches.forEach((touch) => {\r\n\t\tspread += distance(\r\n\t\t\t{ x: centerMass.left, y: centerMass.top },\r\n\t\t\t{ x: touch.clientX - left, y: touch.clientY - top },\r\n\t\t);\r\n\t});\r\n\r\n\treturn { centerMass, spread, count: touches.length };\r\n}\r\n","<script>\nimport debounce from 'debounce';\nimport { ManipulateImageEvent } from '../../core/events.ts';\nimport { calculateGeometricProperties } from '../../core/touch';\nimport { sign } from '../../core/utils';\n\nexport default {\n\tprops: {\n\t\ttouchMove: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tmouseMove: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\ttouchResize: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\twheelResize: {\n\t\t\ttype: [Boolean, Object],\n\t\t\trequired: true,\n\t\t},\n\t\teventsFilter: {\n\t\t\ttype: Function,\n\t\t\trequired: false,\n\t\t},\n\t},\n\tbeforeMount() {\n\t\twindow.addEventListener('mouseup', this.onMouseUp, { passive: false });\n\t\twindow.addEventListener('mousemove', this.onMouseMove, { passive: false });\n\t\twindow.addEventListener('touchmove', this.onTouchMove, { passive: false });\n\t\twindow.addEventListener('touchend', this.onTouchEnd, { passive: false });\n\t},\n\tbeforeUnmount() {\n\t\twindow.removeEventListener('mouseup', this.onMouseUp);\n\t\twindow.removeEventListener('mousemove', this.onMouseMove);\n\t\twindow.removeEventListener('touchmove', this.onTouchMove);\n\t\twindow.removeEventListener('touchend', this.onTouchEnd);\n\t},\n\tcreated() {\n\t\tthis.transforming = false;\n\t\tthis.debouncedProcessEnd = debounce(this.processEnd);\n\t\tthis.touches = [];\n\t},\n\tmethods: {\n\t\tprocessMove(event, newTouches) {\n\t\t\tif (this.touches.length) {\n\t\t\t\tif (this.touches.length === 1 && newTouches.length === 1) {\n\t\t\t\t\tthis.$emit(\n\t\t\t\t\t\t'move',\n\t\t\t\t\t\tnew ManipulateImageEvent({\n\t\t\t\t\t\t\tleft: this.touches[0].clientX - newTouches[0].clientX,\n\t\t\t\t\t\t\ttop: this.touches[0].clientY - newTouches[0].clientY,\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t} else if (this.touches.length > 1 && this.touchResize) {\n\t\t\t\t\tconst newProperties = calculateGeometricProperties(newTouches, this.$refs.container);\n\t\t\t\t\tconst oldProperties = this.oldGeometricProperties;\n\n\t\t\t\t\tif (oldProperties.count === newProperties.count && oldProperties.count > 1) {\n\t\t\t\t\t\tthis.$emit(\n\t\t\t\t\t\t\t'resize',\n\t\t\t\t\t\t\tnew ManipulateImageEvent(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tleft: oldProperties.centerMass.left - newProperties.centerMass.left,\n\t\t\t\t\t\t\t\t\ttop: oldProperties.centerMass.top - newProperties.centerMass.top,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfactor: oldProperties.spread / newProperties.spread,\n\t\t\t\t\t\t\t\t\tcenter: newProperties.centerMass,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tthis.oldGeometricProperties = newProperties;\n\t\t\t\t}\n\t\t\t\tthis.touches = newTouches;\n\t\t\t}\n\t\t},\n\t\tprocessEnd() {\n\t\t\tif (this.transforming) {\n\t\t\t\tthis.transforming = false;\n\t\t\t\tthis.$emit('transform-end');\n\t\t\t}\n\t\t},\n\t\tprocessStart() {\n\t\t\tthis.transforming = true;\n\t\t\tthis.debouncedProcessEnd.clear();\n\t\t},\n\t\tprocessEvent(e) {\n\t\t\tif (this.eventsFilter) {\n\t\t\t\treturn this.eventsFilter(e, this.transforming) !== false;\n\t\t\t} else {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\tonTouchStart(e) {\n\t\t\tif (e.cancelable && (this.touchMove || (this.touchResize && e.touches.length > 1))) {\n\t\t\t\tif (this.processEvent(e)) {\n\t\t\t\t\tconst container = this.$refs.container;\n\t\t\t\t\tconst { left, top, bottom, right } = container.getBoundingClientRect();\n\t\t\t\t\tthis.touches = [...e.touches].filter(\n\t\t\t\t\t\t(touch) =>\n\t\t\t\t\t\t\ttouch.clientX > left &&\n\t\t\t\t\t\t\ttouch.clientX < right &&\n\t\t\t\t\t\t\ttouch.clientY > top &&\n\t\t\t\t\t\t\ttouch.clientY < bottom,\n\t\t\t\t\t);\n\t\t\t\t\tthis.oldGeometricProperties = calculateGeometricProperties(this.touches, container);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonTouchEnd(e) {\n\t\t\tif (e.touches.length === 0) {\n\t\t\t\tthis.touches = [];\n\t\t\t\tthis.processEnd();\n\t\t\t}\n\t\t},\n\t\tonTouchMove(e) {\n\t\t\tif (this.touches.length) {\n\t\t\t\tconst touches = [...e.touches].filter(\n\t\t\t\t\t(touch) =>\n\t\t\t\t\t\t!touch.identifier ||\n\t\t\t\t\t\tthis.touches.find((anotherTouch) => anotherTouch.identifier === touch.identifier),\n\t\t\t\t);\n\t\t\t\tif (this.processEvent(e)) {\n\t\t\t\t\tthis.processMove(e, touches);\n\t\t\t\t\tthis.processStart();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonMouseDown(e) {\n\t\t\tif (this.mouseMove && 'buttons' in e && e.buttons === 1) {\n\t\t\t\tif (this.processEvent(e)) {\n\t\t\t\t\tconst touch = {\n\t\t\t\t\t\tfake: true,\n\t\t\t\t\t\tclientX: e.clientX,\n\t\t\t\t\t\tclientY: e.clientY,\n\t\t\t\t\t};\n\t\t\t\t\tthis.touches = [touch];\n\t\t\t\t\tthis.processStart();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonMouseMove(e) {\n\t\t\tif (this.touches.length) {\n\t\t\t\tif (this.processEvent(e)) {\n\t\t\t\t\tthis.processMove(e, [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tclientX: e.clientX,\n\t\t\t\t\t\t\tclientY: e.clientY,\n\t\t\t\t\t\t},\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonMouseUp() {\n\t\t\tthis.touches = [];\n\t\t\tthis.processEnd();\n\t\t},\n\t\tonWheel(event) {\n\t\t\tif (this.wheelResize) {\n\t\t\t\tif (this.processEvent(event)) {\n\t\t\t\t\tconst container = this.$refs.container;\n\t\t\t\t\tconst { left, top } = container.getBoundingClientRect();\n\t\t\t\t\tconst factor = 1 + this.wheelResize.ratio * sign(event.deltaY || event.detail || event.wheelDelta);\n\t\t\t\t\tconst center = {\n\t\t\t\t\t\tleft: event.clientX - left,\n\t\t\t\t\t\ttop: event.clientY - top,\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.$emit('resize', new ManipulateImageEvent({}, { factor, center }));\n\n\t\t\t\t\tif (!this.touches.length) {\n\t\t\t\t\t\tthis.debouncedProcessEnd();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\temits: ['resize', 'move', 'transform-end'],\n};\n</script>\n\n<template>\n\t<div ref=\"container\" @touchstart=\"onTouchStart\" @mousedown=\"onMouseDown\" @wheel=\"onWheel\">\n\t\t<slot />\n\t</div>\n</template>\n","<script>\nimport TransformableImage from './TransformableImage.vue';\n\nexport default {\n\tcomponents: {\n\t\tTransformableImage,\n\t},\n\tprops: {\n\t\ttouchMove: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tmouseMove: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\ttouchResize: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\twheelResize: {\n\t\t\ttype: [Boolean, Object],\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['resize', 'move'],\n};\n</script>\n\n<template>\n\t<transformable-image\n\t\t:touch-move=\"touchMove\"\n\t\t:touch-resize=\"touchResize\"\n\t\t:mouse-move=\"mouseMove\"\n\t\t:wheel-resize=\"wheelResize\"\n\t\t@move=\"$emit('move', $event)\"\n\t\t@resize=\"$emit('resize', $event)\"\n\t>\n\t\t<slot />\n\t</transformable-image>\n</template>\n","<script>\r\nimport classnames from 'classnames';\r\nimport bem from 'easy-bem';\r\nimport { radians } from '../../core';\r\nimport { getStyleTransforms } from '../../core/image';\r\nimport { rotateSize } from '../../core/service';\r\nconst cn = bem('vue-preview');\r\nexport default {\r\n\tprops: {\r\n\t\tcoordinates: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\ttransitions: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\timage: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\timageClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\twidth: {\r\n\t\t\ttype: Number,\r\n\t\t},\r\n\t\theight: {\r\n\t\t\ttype: Number,\r\n\t\t},\r\n\t\tfill: {\r\n\t\t\ttype: Boolean,\r\n\t\t},\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tcalculatedImageSize: {\r\n\t\t\t\twidth: 0,\r\n\t\t\t\theight: 0,\r\n\t\t\t},\r\n\t\t\tcalculatedSize: {\r\n\t\t\t\twidth: 0,\r\n\t\t\t\theight: 0,\r\n\t\t\t},\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tclasses() {\r\n\t\t\treturn {\r\n\t\t\t\troot: cn({ fill: this.fill }),\r\n\t\t\t\twrapper: cn('wrapper'),\r\n\t\t\t\timageWrapper: cn('image-wrapper'),\r\n\t\t\t\timage: classnames(cn('image'), this.imageClass),\r\n\t\t\t};\r\n\t\t},\r\n\t\tstyle() {\r\n\t\t\tif (!this.fill) {\r\n\t\t\t\tconst result = {};\r\n\t\t\t\tif (this.width) {\r\n\t\t\t\t\tresult.width = `${this.size.width}px`;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.height) {\r\n\t\t\t\t\tresult.height = `${this.size.height}px`;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.transitions && this.transitions.enabled) {\r\n\t\t\t\t\tresult.transition = `${this.transitions.time}ms ${this.transitions.timingFunction}`;\r\n\t\t\t\t}\r\n\t\t\t\treturn result;\r\n\t\t\t} else {\r\n\t\t\t\treturn {};\r\n\t\t\t}\r\n\t\t},\r\n\t\twrapperStyle() {\r\n\t\t\tconst result = {\r\n\t\t\t\twidth: `${this.size.width}px`,\r\n\t\t\t\theight: `${this.size.height}px`,\r\n\t\t\t\tleft: `calc(50% - ${this.size.width / 2}px)`,\r\n\t\t\t\ttop: `calc(50% - ${this.size.height / 2}px)`,\r\n\t\t\t};\r\n\t\t\tif (this.transitions && this.transitions.enabled) {\r\n\t\t\t\tresult.transition = `${this.transitions.time}ms ${this.transitions.timingFunction}`;\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\timageStyle() {\r\n\t\t\tif (this.coordinates && this.image) {\r\n\t\t\t\tconst coefficient = this.coordinates.width / this.size.width;\r\n\t\t\t\tconst transforms = {\r\n\t\t\t\t\trotate: 0,\r\n\t\t\t\t\tflip: {\r\n\t\t\t\t\t\thorizontal: false,\r\n\t\t\t\t\t\tvertical: false,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t...this.image.transforms,\r\n\t\t\t\t\tscaleX: 1 / coefficient,\r\n\t\t\t\t\tscaleY: 1 / coefficient,\r\n\t\t\t\t};\r\n\t\t\t\tconst width = this.imageSize.width;\r\n\t\t\t\tconst height = this.imageSize.height;\r\n\t\t\t\tconst virtualSize = rotateSize(\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\theight,\r\n\t\t\t\t\t},\r\n\t\t\t\t\ttransforms.rotate,\r\n\t\t\t\t);\r\n\t\t\t\tconst result = {\r\n\t\t\t\t\twidth: `${width}px`,\r\n\t\t\t\t\theight: `${height}px`,\r\n\t\t\t\t\tleft: '0px',\r\n\t\t\t\t\ttop: '0px',\r\n\t\t\t\t};\r\n\t\t\t\tconst compensations = {\r\n\t\t\t\t\trotate: {\r\n\t\t\t\t\t\tleft: ((width - virtualSize.width) * transforms.scaleX) / 2,\r\n\t\t\t\t\t\ttop: ((height - virtualSize.height) * transforms.scaleY) / 2,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tscale: {\r\n\t\t\t\t\t\tleft: ((1 - transforms.scaleX) * width) / 2,\r\n\t\t\t\t\t\ttop: ((1 - transforms.scaleY) * height) / 2,\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t\tresult.transform =\r\n\t\t\t\t\t`translate(\r\n\t\t\t\t${-this.coordinates.left / coefficient - compensations.rotate.left - compensations.scale.left}px,${\r\n\t\t\t\t\t\t-this.coordinates.top / coefficient - compensations.rotate.top - compensations.scale.top\r\n\t\t\t\t\t}px) ` + getStyleTransforms(transforms);\r\n\t\t\t\tif (this.transitions && this.transitions.enabled) {\r\n\t\t\t\t\tresult.transition = `${this.transitions.time}ms ${this.transitions.timingFunction}`;\r\n\t\t\t\t}\r\n\t\t\t\treturn result;\r\n\t\t\t} else {\r\n\t\t\t\treturn {};\r\n\t\t\t}\r\n\t\t},\r\n\t\tsize() {\r\n\t\t\treturn {\r\n\t\t\t\twidth: this.width || this.calculatedSize.width,\r\n\t\t\t\theight: this.height || this.calculatedSize.height,\r\n\t\t\t};\r\n\t\t},\r\n\t\timageSize() {\r\n\t\t\treturn {\r\n\t\t\t\twidth: this.image.width || this.calculatedImageSize.width,\r\n\t\t\t\theight: this.image.height || this.calculatedImageSize.height,\r\n\t\t\t};\r\n\t\t},\r\n\t},\r\n\twatch: {\r\n\t\timage(value) {\r\n\t\t\tif (value.width || value.height) {\r\n\t\t\t\tthis.onChangeImage();\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n\tmounted() {\r\n\t\tthis.onChangeImage();\r\n\t\tthis.$refs.image.addEventListener('load', () => {\r\n\t\t\tthis.refreshImage();\r\n\t\t});\r\n\t\twindow.addEventListener('resize', this.refresh);\r\n\t\twindow.addEventListener('orientationchange', this.refresh);\r\n\t},\r\n\tunmounted() {\r\n\t\twindow.removeEventListener('resize', this.refresh);\r\n\t\twindow.removeEventListener('orientationchange', this.refresh);\r\n\t},\r\n\tmethods: {\r\n\t\trefreshImage() {\r\n\t\t\tconst image = this.$refs.image;\r\n\t\t\tthis.calculatedImageSize.height = image.naturalHeight;\r\n\t\t\tthis.calculatedImageSize.width = image.naturalWidth;\r\n\t\t},\r\n\t\trefresh() {\r\n\t\t\tconst root = this.$refs.root;\r\n\t\t\tif (!this.width) {\r\n\t\t\t\tthis.calculatedSize.width = root.clientWidth;\r\n\t\t\t}\r\n\t\t\tif (!this.height) {\r\n\t\t\t\tthis.calculatedSize.height = root.clientHeight;\r\n\t\t\t}\r\n\t\t},\r\n\t\tonChangeImage() {\r\n\t\t\tconst image = this.$refs.image;\r\n\t\t\tif (image && image.complete) {\r\n\t\t\t\tthis.refreshImage();\r\n\t\t\t}\r\n\t\t\tthis.refresh();\r\n\t\t},\r\n\t},\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<div ref=\"root\" :class=\"classes.root\" :style=\"style\">\r\n\t\t<div ref=\"wrapper\" :class=\"classes.wrapper\" :style=\"wrapperStyle\">\r\n\t\t\t<img\r\n\t\t\t\tv-show=\"image && image.src\"\r\n\t\t\t\tref=\"image\"\r\n\t\t\t\t:src=\"image && image.src\"\r\n\t\t\t\t:class=\"classes.image\"\r\n\t\t\t\t:style=\"imageStyle\"\r\n\t\t\t/>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-preview {\r\n\toverflow: hidden;\r\n\tbox-sizing: border-box;\r\n\tposition: relative;\r\n\t&--fill {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tposition: absolute;\r\n\t}\r\n\t&__wrapper {\r\n\t\tposition: absolute;\r\n\t\theight: 100%;\r\n\t\twidth: 100%;\r\n\t}\r\n\t&__image {\r\n\t\tpointer-events: none;\r\n\t\tposition: absolute;\r\n\t\tuser-select: none;\r\n\t\ttransform-origin: center;\r\n\t\t// Workaround to prevent bugs at the websites with max-width\r\n\t\t// rule applied to img (Vuepress for example)\r\n\t\tmax-width: none !important;\r\n\t}\r\n}\r\n</style>\r\n","<script>\r\nimport bem from 'easy-bem';\r\nimport { Preview } from '../../components/helpers';\r\n\r\nexport default {\r\n\tcomponents: {\r\n\t\tPreview,\r\n\t},\r\n\tinheritAttrs: false,\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<preview v-bind=\"$attrs\" :fill=\"true\" />\r\n</template>\r\n","<script>\r\nimport classnames from 'classnames';\r\nimport bem from 'easy-bem';\r\nimport { BoundingBox, DraggableArea, StencilPreview } from '../service';\r\nimport { SimpleHandler } from '../handlers';\r\nimport { SimpleLine } from '../lines';\r\n\r\nconst cn = bem('vue-rectangle-stencil');\r\n\r\nexport default {\r\n\tname: 'RectangleStencil',\r\n\tcomponents: {\r\n\t\tStencilPreview,\r\n\t\tBoundingBox,\r\n\t\tDraggableArea,\r\n\t},\r\n\tprops: {\r\n\t\timage: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\tcoordinates: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\tstencilCoordinates: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\thandlers: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\thandlersComponent: {\r\n\t\t\ttype: [Object, String],\r\n\t\t\tdefault() {\r\n\t\t\t\treturn SimpleHandler;\r\n\t\t\t},\r\n\t\t},\r\n\t\tlines: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\tlinesComponent: {\r\n\t\t\ttype: [Object, String],\r\n\t\t\tdefault() {\r\n\t\t\t\treturn SimpleLine;\r\n\t\t\t},\r\n\t\t},\r\n\t\taspectRatio: {\r\n\t\t\ttype: [Number, String],\r\n\t\t},\r\n\t\tminAspectRatio: {\r\n\t\t\ttype: [Number, String],\r\n\t\t},\r\n\t\tmaxAspectRatio: {\r\n\t\t\ttype: [Number, String],\r\n\t\t},\r\n\t\tmovable: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t\tresizable: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t\ttransitions: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\tmovingClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tresizingClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tpreviewClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tboundingBoxClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tlinesClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\tlinesWrappersClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\thandlersClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\thandlersWrappersClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tmoving: false,\r\n\t\t\tresizing: false,\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tclasses() {\r\n\t\t\treturn {\r\n\t\t\t\tstencil: classnames(\r\n\t\t\t\t\tcn({ movable: this.movable, moving: this.moving, resizing: this.resizing }),\r\n\t\t\t\t\tthis.moving && this.movingClass,\r\n\t\t\t\t\tthis.resizing && this.resizingClass,\r\n\t\t\t\t),\r\n\t\t\t\tpreview: classnames(cn('preview'), this.previewClass),\r\n\t\t\t\tboundingBox: classnames(cn('bounding-box'), this.boundingBoxClass),\r\n\t\t\t};\r\n\t\t},\r\n\t\tstyle() {\r\n\t\t\tconst { height, width, left, top } = this.stencilCoordinates;\r\n\r\n\t\t\tconst style = {\r\n\t\t\t\twidth: `${width}px`,\r\n\t\t\t\theight: `${height}px`,\r\n\t\t\t\ttransform: `translate(${left}px, ${top}px)`,\r\n\t\t\t};\r\n\r\n\t\t\tif (this.transitions && this.transitions.enabled) {\r\n\t\t\t\tstyle.transition = `${this.transitions.time}ms ${this.transitions.timingFunction}`;\r\n\t\t\t}\r\n\t\t\treturn style;\r\n\t\t},\r\n\t},\r\n\tmethods: {\r\n\t\tonMove(moveEvent) {\r\n\t\t\tthis.$emit('move', moveEvent);\r\n\t\t\tthis.moving = true;\r\n\t\t},\r\n\t\tonMoveEnd() {\r\n\t\t\tthis.$emit('move-end');\r\n\t\t\tthis.moving = false;\r\n\t\t},\r\n\t\tonResize(resizeEvent) {\r\n\t\t\tthis.$emit('resize', resizeEvent);\r\n\t\t\tthis.resizing = true;\r\n\t\t},\r\n\t\tonResizeEnd() {\r\n\t\t\tthis.$emit('resize-end');\r\n\t\t\tthis.resizing = false;\r\n\t\t},\r\n\t\taspectRatios() {\r\n\t\t\treturn {\r\n\t\t\t\tminimum: this.aspectRatio || this.minAspectRatio,\r\n\t\t\t\tmaximum: this.aspectRatio || this.maxAspectRatio,\r\n\t\t\t};\r\n\t\t},\r\n\t},\r\n\temits: ['resize', 'resize-end', 'move', 'move-end'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<div :class=\"classes.stencil\" :style=\"style\">\r\n\t\t<bounding-box\r\n\t\t\t:width=\"stencilCoordinates.width\"\r\n\t\t\t:height=\"stencilCoordinates.height\"\r\n\t\t\t:transitions=\"transitions\"\r\n\t\t\t:class=\"classes.boundingBox\"\r\n\t\t\t:handlers=\"handlers\"\r\n\t\t\t:handlers-component=\"handlersComponent\"\r\n\t\t\t:handlers-classes=\"handlersClasses\"\r\n\t\t\t:handlers-wrappers-classes=\"handlersWrappersClasses\"\r\n\t\t\t:lines=\"lines\"\r\n\t\t\t:lines-component=\"linesComponent\"\r\n\t\t\t:lines-classes=\"linesClasses\"\r\n\t\t\t:lines-wrappers-classes=\"linesWrappersClasses\"\r\n\t\t\t:resizable=\"resizable\"\r\n\t\t\t@resize=\"onResize\"\r\n\t\t\t@resize-end=\"onResizeEnd\"\r\n\t\t>\r\n\t\t\t<draggable-area :movable=\"movable\" @move=\"onMove\" @move-end=\"onMoveEnd\">\r\n\t\t\t\t<stencil-preview\r\n\t\t\t\t\t:image=\"image\"\r\n\t\t\t\t\t:coordinates=\"coordinates\"\r\n\t\t\t\t\t:width=\"stencilCoordinates.width\"\r\n\t\t\t\t\t:height=\"stencilCoordinates.height\"\r\n\t\t\t\t\t:class=\"classes.preview\"\r\n\t\t\t\t\t:transitions=\"transitions\"\r\n\t\t\t\t/>\r\n\t\t\t</draggable-area>\r\n\t\t</bounding-box>\r\n\t</div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-rectangle-stencil {\r\n\tposition: absolute;\r\n\theight: 100%;\r\n\twidth: 100%;\r\n\tbox-sizing: border-box;\r\n\t&__preview {\r\n\t\tposition: absolute;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n\t&--movable {\r\n\t\tcursor: move;\r\n\t}\r\n}\r\n</style>\r\n","<script>\r\nimport classnames from 'classnames';\r\nimport bem from 'easy-bem';\r\nimport { BoundingBox, DraggableArea, StencilPreview } from '../service';\r\nimport { SimpleHandler } from '../handlers';\r\nimport { SimpleLine } from '../lines';\r\n\r\nconst cn = bem('vue-circle-stencil');\r\n\r\nexport default {\r\n\tcomponents: {\r\n\t\tStencilPreview,\r\n\t\tBoundingBox,\r\n\t\tDraggableArea,\r\n\t},\r\n\tprops: {\r\n\t\timage: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\tcoordinates: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\tstencilCoordinates: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\thandlers: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\teastNorth: true,\r\n\t\t\t\t\twestNorth: true,\r\n\t\t\t\t\twestSouth: true,\r\n\t\t\t\t\teastSouth: true,\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t},\r\n\t\thandlersComponent: {\r\n\t\t\ttype: [Object, String],\r\n\t\t\tdefault() {\r\n\t\t\t\treturn SimpleHandler;\r\n\t\t\t},\r\n\t\t},\r\n\t\thandlersClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\thandlersWrappersClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\tlines: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\tlinesComponent: {\r\n\t\t\ttype: [Object, String],\r\n\t\t\tdefault() {\r\n\t\t\t\treturn SimpleLine;\r\n\t\t\t},\r\n\t\t},\r\n\t\tlinesClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\tlinesWrappersClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\tmovable: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t\tresizable: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t\ttransitions: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\tmovingClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tresizingClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tpreviewClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tboundingBoxClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tmoving: false,\r\n\t\t\tresizing: false,\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tclasses() {\r\n\t\t\treturn {\r\n\t\t\t\tstencil: classnames(\r\n\t\t\t\t\tcn({ movable: this.movable, moving: this.moving, resizing: this.resizing }),\r\n\t\t\t\t\tthis.moving && this.movingClass,\r\n\t\t\t\t\tthis.resizing && this.resizingClass,\r\n\t\t\t\t),\r\n\t\t\t\tpreview: classnames(cn('preview'), this.previewClass),\r\n\t\t\t\tboundingBox: classnames(cn('bounding-box'), this.boundingBoxClass),\r\n\t\t\t};\r\n\t\t},\r\n\t\tstyle() {\r\n\t\t\tconst { height, width, left, top } = this.stencilCoordinates;\r\n\r\n\t\t\tconst style = {\r\n\t\t\t\twidth: `${width}px`,\r\n\t\t\t\theight: `${height}px`,\r\n\t\t\t\ttransform: `translate(${left}px, ${top}px)`,\r\n\t\t\t};\r\n\r\n\t\t\tif (this.transitions && this.transitions.enabled) {\r\n\t\t\t\tstyle.transition = `${this.transitions.time}ms ${this.transitions.timingFunction}`;\r\n\t\t\t}\r\n\t\t\treturn style;\r\n\t\t},\r\n\t},\r\n\tmethods: {\r\n\t\tonMove(moveEvent) {\r\n\t\t\tthis.$emit('move', moveEvent);\r\n\t\t\tthis.moving = true;\r\n\t\t},\r\n\t\tonMoveEnd() {\r\n\t\t\tthis.$emit('move-end');\r\n\t\t\tthis.moving = false;\r\n\t\t},\r\n\t\tonResize(resizeEvent) {\r\n\t\t\tthis.$emit('resize', resizeEvent);\r\n\t\t\tthis.resizing = true;\r\n\t\t},\r\n\t\tonResizeEnd() {\r\n\t\t\tthis.$emit('resize-end');\r\n\t\t\tthis.resizing = false;\r\n\t\t},\r\n\t\taspectRatios() {\r\n\t\t\treturn {\r\n\t\t\t\tminimum: 1,\r\n\t\t\t\tmaximum: 1,\r\n\t\t\t};\r\n\t\t},\r\n\t},\r\n\temits: ['resize', 'resize-end', 'move', 'move-end'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<div :class=\"classes.stencil\" :style=\"style\">\r\n\t\t<bounding-box\r\n\t\t\t:width=\"stencilCoordinates.width\"\r\n\t\t\t:height=\"stencilCoordinates.height\"\r\n\t\t\t:transitions=\"transitions\"\r\n\t\t\t:class=\"classes.boundingBox\"\r\n\t\t\t:handlers=\"handlers\"\r\n\t\t\t:handlers-component=\"handlersComponent\"\r\n\t\t\t:handlers-classes=\"handlersClasses\"\r\n\t\t\t:handlers-wrappers-classes=\"handlersWrappersClasses\"\r\n\t\t\t:lines=\"lines\"\r\n\t\t\t:lines-component=\"linesComponent\"\r\n\t\t\t:lines-classes=\"linesClasses\"\r\n\t\t\t:lines-wrappers-classes=\"linesWrappersClasses\"\r\n\t\t\t:resizable=\"resizable\"\r\n\t\t\t@resize=\"onResize\"\r\n\t\t\t@resize-end=\"onResizeEnd\"\r\n\t\t>\r\n\t\t\t<draggable-area :movable=\"movable\" @move=\"onMove\" @move-end=\"onMoveEnd\">\r\n\t\t\t\t<stencil-preview\r\n\t\t\t\t\t:image=\"image\"\r\n\t\t\t\t\t:coordinates=\"coordinates\"\r\n\t\t\t\t\t:width=\"stencilCoordinates.width\"\r\n\t\t\t\t\t:height=\"stencilCoordinates.height\"\r\n\t\t\t\t\t:class=\"classes.preview\"\r\n\t\t\t\t\t:transitions=\"transitions\"\r\n\t\t\t\t/>\r\n\t\t\t</draggable-area>\r\n\t\t</bounding-box>\r\n\t</div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-circle-stencil {\r\n\tposition: absolute;\r\n\theight: 100%;\r\n\twidth: 100%;\r\n\tbox-sizing: content-box;\r\n\tcursor: move;\r\n\t&__preview {\r\n\t\tborder-radius: 50%;\r\n\t\tposition: absolute;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n\t&--movable {\r\n\t\tcursor: move;\r\n\t}\r\n}\r\n</style>\r\n","<script>\nimport classnames from 'classnames';\nimport bem from 'easy-bem';\nimport debounce from 'debounce';\nimport { RectangleStencil } from './components/stencils';\nimport { BackgroundWrapper } from './components/service';\nimport {\n\tfillBoundaries,\n\tfitBoundaries,\n\tgetOptions,\n\tisBlob,\n\tisFunction,\n\tisLoadedImage,\n\tisNumber,\n\tisNumeric,\n\tlimitBy,\n\tradians,\n} from './core';\nimport { approximatedSize } from './core/algorithms';\nimport { updateCanvas } from './core/canvas';\nimport { ManipulateImageEvent } from './core/events';\nimport { isEqual, limitSizeRestrictions, limitsToSize, ratio } from './core/service';\nimport { isLocal, isCrossOriginURL, isUndefined, parseNumber } from './core/utils';\nimport { arrayBufferToDataURL, getImageTransforms, getStyleTransforms, prepareSource, parseImage } from './core/image';\nimport { IMAGE_RESTRICTIONS, DEFAULT_COORDINATES } from './core/constants';\nimport * as algorithms from './core/algorithms';\n\nconst cn = bem('vue-advanced-cropper');\n\nexport default {\n\tname: 'Cropper',\n\tcomponents: {\n\t\tBackgroundWrapper,\n\t},\n\tprops: {\n\t\tsrc: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t\tstencilComponent: {\n\t\t\ttype: [Object, String],\n\t\t\tdefault() {\n\t\t\t\treturn RectangleStencil;\n\t\t\t},\n\t\t},\n\t\tbackgroundWrapperComponent: {\n\t\t\ttype: [Object, String],\n\t\t\tdefault() {\n\t\t\t\treturn BackgroundWrapper;\n\t\t\t},\n\t\t},\n\t\tstencilProps: {\n\t\t\ttype: Object,\n\t\t\tdefault() {\n\t\t\t\treturn {};\n\t\t\t},\n\t\t},\n\t\tautoZoom: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\timageClass: {\n\t\t\ttype: String,\n\t\t},\n\t\tboundariesClass: {\n\t\t\ttype: String,\n\t\t},\n\t\tbackgroundClass: {\n\t\t\ttype: String,\n\t\t},\n\t\tforegroundClass: {\n\t\t\ttype: String,\n\t\t},\n\t\tminWidth: {\n\t\t\ttype: [Number, String],\n\t\t},\n\t\tminHeight: {\n\t\t\ttype: [Number, String],\n\t\t},\n\t\tmaxWidth: {\n\t\t\ttype: [Number, String],\n\t\t},\n\t\tmaxHeight: {\n\t\t\ttype: [Number, String],\n\t\t},\n\t\tdebounce: {\n\t\t\ttype: [Boolean, Number],\n\t\t\tdefault: 500,\n\t\t},\n\t\ttransitions: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tcheckOrientation: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tcanvas: {\n\t\t\ttype: [Object, Boolean],\n\t\t\tdefault: true,\n\t\t},\n\t\tcrossOrigin: {\n\t\t\ttype: [Boolean, String],\n\t\t\tdefault: undefined,\n\t\t},\n\t\ttransitionTime: {\n\t\t\ttype: Number,\n\t\t\tdefault: 300,\n\t\t},\n\t\timageRestriction: {\n\t\t\ttype: String,\n\t\t\tdefault: 'fit-area',\n\t\t\tvalidator(value) {\n\t\t\t\treturn IMAGE_RESTRICTIONS.indexOf(value) !== -1;\n\t\t\t},\n\t\t},\n\t\troundResult: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tdefaultSize: {\n\t\t\ttype: [Function, Object],\n\t\t},\n\t\tdefaultPosition: {\n\t\t\ttype: [Function, Object],\n\t\t},\n\t\tdefaultVisibleArea: {\n\t\t\ttype: [Function, Object],\n\t\t},\n\t\tdefaultBoundaries: {\n\t\t\ttype: [Function, String],\n\t\t\tvalidator(value) {\n\t\t\t\tconst invalid = typeof value === 'string' && value !== 'fill' && value !== 'fit';\n\t\t\t\tif (invalid) {\n\t\t\t\t\tif (process.env.NODE_ENV !== 'production') {\n\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t`Warning: prop \"defaultBoundaries\" gets incorrect string value ${value}. It should be either function, 'fill' or 'fit'`,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn !invalid;\n\t\t\t},\n\t\t},\n\t\tpriority: {\n\t\t\ttype: String,\n\t\t\tdefault: 'coordinates',\n\t\t},\n\t\tstencilSize: {\n\t\t\ttype: [Object, Function],\n\t\t},\n\t\tresizeImage: {\n\t\t\ttype: [Boolean, Object],\n\t\t\tdefault: true,\n\t\t},\n\t\tmoveImage: {\n\t\t\ttype: [Boolean, Object],\n\t\t\tdefault: true,\n\t\t},\n\t\tautoZoomAlgorithm: {\n\t\t\ttype: Function,\n\t\t},\n\t\tresizeAlgorithm: {\n\t\t\ttype: Function,\n\t\t\tdefault: algorithms.resize,\n\t\t},\n\t\tmoveAlgorithm: {\n\t\t\ttype: Function,\n\t\t\tdefault: algorithms.move,\n\t\t},\n\t\tinitStretcher: {\n\t\t\ttype: Function,\n\t\t\tdefault: algorithms.initStretcher,\n\t\t},\n\t\tfitCoordinates: {\n\t\t\ttype: Function,\n\t\t\tdefault: algorithms.fitCoordinates,\n\t\t},\n\t\tfitVisibleArea: {\n\t\t\ttype: Function,\n\t\t\tdefault: algorithms.fitVisibleArea,\n\t\t},\n\t\tareaRestrictionsAlgorithm: {\n\t\t\ttype: Function,\n\t\t\tdefault: algorithms.dynamicAreaRestrictions,\n\t\t},\n\t\tsizeRestrictionsAlgorithm: {\n\t\t\ttype: Function,\n\t\t\tdefault: algorithms.pixelsRestrictions,\n\t\t},\n\t\tpositionRestrictionsAlgorithm: {\n\t\t\ttype: Function,\n\t\t\tdefault: algorithms.positionRestrictions,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\ttransitionsActive: false,\n\t\t\timageLoaded: false,\n\t\t\timageAttributes: {\n\t\t\t\twidth: null,\n\t\t\t\theight: null,\n\t\t\t\tcrossOrigin: null,\n\t\t\t\tsrc: null,\n\t\t\t},\n\t\t\tcustomImageTransforms: {\n\t\t\t\trotate: 0,\n\t\t\t\tflip: {\n\t\t\t\t\thorizontal: false,\n\t\t\t\t\tvertical: false,\n\t\t\t\t},\n\t\t\t},\n\t\t\tbasicImageTransforms: {\n\t\t\t\trotate: 0,\n\t\t\t\tflip: {\n\t\t\t\t\thorizontal: false,\n\t\t\t\t\tvertical: false,\n\t\t\t\t},\n\t\t\t},\n\t\t\tboundaries: {\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0,\n\t\t\t},\n\t\t\tvisibleArea: null,\n\t\t\tcoordinates: {\n\t\t\t\t...DEFAULT_COORDINATES,\n\t\t\t},\n\t\t};\n\t},\n\tcomputed: {\n\t\timage() {\n\t\t\treturn {\n\t\t\t\tsrc: this.imageAttributes.src,\n\t\t\t\twidth: this.imageAttributes.width,\n\t\t\t\theight: this.imageAttributes.height,\n\t\t\t\ttransforms: this.imageTransforms,\n\t\t\t};\n\t\t},\n\t\timageTransforms() {\n\t\t\treturn {\n\t\t\t\trotate: this.basicImageTransforms.rotate + this.customImageTransforms.rotate,\n\t\t\t\tflip: {\n\t\t\t\t\thorizontal: Boolean(\n\t\t\t\t\t\tthis.basicImageTransforms.flip.horizontal ^ this.customImageTransforms.flip.horizontal,\n\t\t\t\t\t),\n\t\t\t\t\tvertical: Boolean(\n\t\t\t\t\t\tthis.basicImageTransforms.flip.vertical ^ this.customImageTransforms.flip.vertical,\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t\ttranslateX: this.visibleArea ? this.visibleArea.left / this.coefficient : 0,\n\t\t\t\ttranslateY: this.visibleArea ? this.visibleArea.top / this.coefficient : 0,\n\t\t\t\tscaleX: 1 / this.coefficient,\n\t\t\t\tscaleY: 1 / this.coefficient,\n\t\t\t};\n\t\t},\n\t\timageSize() {\n\t\t\tconst transforms = this.imageTransforms;\n\t\t\tconst angle = radians(transforms.rotate);\n\t\t\treturn {\n\t\t\t\twidth:\n\t\t\t\t\tMath.abs(this.imageAttributes.width * Math.cos(angle)) +\n\t\t\t\t\tMath.abs(this.imageAttributes.height * Math.sin(angle)),\n\t\t\t\theight:\n\t\t\t\t\tMath.abs(this.imageAttributes.width * Math.sin(angle)) +\n\t\t\t\t\tMath.abs(this.imageAttributes.height * Math.cos(angle)),\n\t\t\t};\n\t\t},\n\t\tinitialized() {\n\t\t\treturn Boolean(this.visibleArea && this.imageLoaded);\n\t\t},\n\t\tsettings() {\n\t\t\tconst resizeImage = getOptions(\n\t\t\t\tthis.resizeImage,\n\t\t\t\t{\n\t\t\t\t\ttouch: true,\n\t\t\t\t\twheel: {\n\t\t\t\t\t\tratio: 0.1,\n\t\t\t\t\t},\n\t\t\t\t\tadjustStencil: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttouch: false,\n\t\t\t\t\twheel: false,\n\t\t\t\t\tadjustStencil: false,\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tconst moveImage = getOptions(\n\t\t\t\tthis.moveImage,\n\t\t\t\t{\n\t\t\t\t\ttouch: true,\n\t\t\t\t\tmouse: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttouch: false,\n\t\t\t\t\tmouse: false,\n\t\t\t\t},\n\t\t\t);\n\n\t\t\treturn {\n\t\t\t\tmoveImage,\n\t\t\t\tresizeImage,\n\t\t\t};\n\t\t},\n\t\tcoefficient() {\n\t\t\treturn this.visibleArea ? this.visibleArea.width / this.boundaries.width : 0;\n\t\t},\n\t\tareaRestrictions() {\n\t\t\tif (this.imageLoaded) {\n\t\t\t\treturn this.areaRestrictionsAlgorithm({\n\t\t\t\t\timageSize: this.imageSize,\n\t\t\t\t\timageRestriction: this.imageRestriction,\n\t\t\t\t\tboundaries: this.boundaries,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn {};\n\t\t\t}\n\t\t},\n\t\ttransitionsOptions() {\n\t\t\treturn {\n\t\t\t\tenabled: this.transitionsActive,\n\t\t\t\ttimingFunction: 'ease-in-out',\n\t\t\t\ttime: 350,\n\t\t\t};\n\t\t},\n\t\tsizeRestrictions() {\n\t\t\tif (this.boundaries.width && this.boundaries.height && this.imageSize.width && this.imageSize.height) {\n\t\t\t\tlet sizeRestrictions = this.sizeRestrictionsAlgorithm({\n\t\t\t\t\timageSize: this.imageSize,\n\t\t\t\t\tminWidth: !isUndefined(this.minWidth) ? parseNumber(this.minWidth) : 0,\n\t\t\t\t\tminHeight: !isUndefined(this.minHeight) ? parseNumber(this.minHeight) : 0,\n\t\t\t\t\tmaxWidth: !isUndefined(this.maxWidth) ? parseNumber(this.maxWidth) : Infinity,\n\t\t\t\t\tmaxHeight: !isUndefined(this.maxHeight) ? parseNumber(this.maxHeight) : Infinity,\n\t\t\t\t});\n\n\t\t\t\tsizeRestrictions = algorithms.refineSizeRestrictions({\n\t\t\t\t\tsizeRestrictions,\n\t\t\t\t\tareaRestrictions: this.getAreaRestrictions({ visibleArea: this.visibleArea, type: 'resize' }),\n\t\t\t\t\timageSize: this.imageSize,\n\t\t\t\t\tboundaries: this.boundaries,\n\t\t\t\t\tpositionRestrictions: this.positionRestrictions,\n\t\t\t\t\timageRestriction: this.imageRestriction,\n\t\t\t\t\tvisibleArea: this.visibleArea,\n\t\t\t\t\tstencilSize: this.getStencilSize(),\n\t\t\t\t});\n\n\t\t\t\tif (this.visibleArea && this.stencilSize) {\n\t\t\t\t\tconst stencilSize = this.getStencilSize();\n\t\t\t\t\tconst areaRestrictions = limitsToSize(\n\t\t\t\t\t\tthis.getAreaRestrictions({ visibleArea: this.visibleArea, type: 'resize' }),\n\t\t\t\t\t);\n\t\t\t\t\tsizeRestrictions.maxWidth = Math.min(\n\t\t\t\t\t\tsizeRestrictions.maxWidth,\n\t\t\t\t\t\t(areaRestrictions.width * stencilSize.width) / this.boundaries.width,\n\t\t\t\t\t);\n\t\t\t\t\tsizeRestrictions.maxHeight = Math.min(\n\t\t\t\t\t\tsizeRestrictions.maxHeight,\n\t\t\t\t\t\t(areaRestrictions.height * stencilSize.height) / this.boundaries.height,\n\t\t\t\t\t);\n\t\t\t\t\tif (sizeRestrictions.maxWidth < sizeRestrictions.minWidth) {\n\t\t\t\t\t\tif (process.env.NODE_ENV !== 'production') {\n\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t'Maximum width is smaller than minimum width, because otherwise the area restrictions or stencil size will be broken. Minimum width is reduced.',\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsizeRestrictions.minWidth = sizeRestrictions.maxWidth;\n\t\t\t\t\t}\n\t\t\t\t\tif (sizeRestrictions.maxHeight < sizeRestrictions.minHeight) {\n\t\t\t\t\t\tif (process.env.NODE_ENV !== 'production') {\n\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t'Maximum height is smaller than minimum height, because otherwise the area restrictions or stencil size will be broken. Minimum height is reduced.',\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsizeRestrictions.minHeight = sizeRestrictions.maxHeight;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn sizeRestrictions;\n\t\t\t} else {\n\t\t\t\treturn {\n\t\t\t\t\tminWidth: 0,\n\t\t\t\t\tminHeight: 0,\n\t\t\t\t\tmaxWidth: 0,\n\t\t\t\t\tmaxHeight: 0,\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\t\tpositionRestrictions() {\n\t\t\treturn this.positionRestrictionsAlgorithm({\n\t\t\t\timageSize: this.imageSize,\n\t\t\t\timageRestriction: this.imageRestriction,\n\t\t\t});\n\t\t},\n\t\t// Styling\n\t\tclasses() {\n\t\t\treturn {\n\t\t\t\tcropper: cn(),\n\t\t\t\timage: classnames(cn('image'), this.imageClass),\n\t\t\t\tstencil: cn('stencil'),\n\t\t\t\tboundaries: classnames(cn('boundaries'), this.boundariesClass),\n\t\t\t\tstretcher: classnames(cn('stretcher')),\n\t\t\t\tbackground: classnames(cn('background'), this.backgroundClass),\n\t\t\t\tforeground: classnames(cn('foreground'), this.foregroundClass),\n\t\t\t\timageWrapper: classnames(cn('image-wrapper')),\n\t\t\t\tcropperWrapper: classnames(cn('cropper-wrapper')),\n\t\t\t};\n\t\t},\n\t\tstencilCoordinates() {\n\t\t\tif (this.initialized) {\n\t\t\t\tconst { width, height, left, top } = this.coordinates;\n\t\t\t\treturn {\n\t\t\t\t\twidth: width / this.coefficient,\n\t\t\t\t\theight: height / this.coefficient,\n\t\t\t\t\tleft: (left - this.visibleArea.left) / this.coefficient,\n\t\t\t\t\ttop: (top - this.visibleArea.top) / this.coefficient,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn this.defaultCoordinates();\n\t\t\t}\n\t\t},\n\t\tboundariesStyle() {\n\t\t\tconst styles = {\n\t\t\t\twidth: this.boundaries.width ? `${Math.round(this.boundaries.width)}px` : 'auto',\n\t\t\t\theight: this.boundaries.height ? `${Math.round(this.boundaries.height)}px` : 'auto',\n\t\t\t\ttransition: `opacity ${this.transitionTime}ms`,\n\t\t\t\tpointerEvents: this.imageLoaded ? 'all' : 'none',\n\t\t\t};\n\t\t\tif (!this.imageLoaded) {\n\t\t\t\tstyles.opacity = '0';\n\t\t\t}\n\t\t\treturn styles;\n\t\t},\n\t\timageStyle() {\n\t\t\tconst optimalImageSize =\n\t\t\t\tthis.imageAttributes.width > this.imageAttributes.height\n\t\t\t\t\t? {\n\t\t\t\t\t\t\twidth: Math.min(1024, this.imageAttributes.width),\n\t\t\t\t\t\t\theight:\n\t\t\t\t\t\t\t\tMath.min(1024, this.imageAttributes.width) /\n\t\t\t\t\t\t\t\t(this.imageAttributes.width / this.imageAttributes.height),\n\t\t\t\t\t  }\n\t\t\t\t\t: {\n\t\t\t\t\t\t\theight: Math.min(1024, this.imageAttributes.height),\n\t\t\t\t\t\t\twidth:\n\t\t\t\t\t\t\t\tMath.min(1024, this.imageAttributes.height) *\n\t\t\t\t\t\t\t\t(this.imageAttributes.width / this.imageAttributes.height),\n\t\t\t\t\t  };\n\n\t\t\tconst compensations = {\n\t\t\t\trotate: {\n\t\t\t\t\tleft: (optimalImageSize.width - this.imageSize.width) / (2 * this.coefficient),\n\t\t\t\t\ttop: (optimalImageSize.height - this.imageSize.height) / (2 * this.coefficient),\n\t\t\t\t},\n\t\t\t\tscale: {\n\t\t\t\t\tleft: ((1 - 1 / this.coefficient) * optimalImageSize.width) / 2,\n\t\t\t\t\ttop: ((1 - 1 / this.coefficient) * optimalImageSize.height) / 2,\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tconst transforms = {\n\t\t\t\t...this.imageTransforms,\n\t\t\t\tscaleX: this.imageTransforms.scaleX * (this.imageAttributes.width / optimalImageSize.width),\n\t\t\t\tscaleY: this.imageTransforms.scaleY * (this.imageAttributes.height / optimalImageSize.height),\n\t\t\t};\n\n\t\t\tconst result = {\n\t\t\t\twidth: `${optimalImageSize.width}px`,\n\t\t\t\theight: `${optimalImageSize.height}px`,\n\t\t\t\tleft: '0px',\n\t\t\t\ttop: '0px',\n\t\t\t\ttransform:\n\t\t\t\t\t`translate(${\n\t\t\t\t\t\t-compensations.rotate.left - compensations.scale.left - this.imageTransforms.translateX\n\t\t\t\t\t}px, ${-compensations.rotate.top - compensations.scale.top - this.imageTransforms.translateY}px)` +\n\t\t\t\t\tgetStyleTransforms(transforms),\n\t\t\t};\n\n\t\t\tif (this.transitionsOptions.enabled) {\n\t\t\t\tresult.transition = `${this.transitionsOptions.time}ms ${this.transitionsOptions.timingFunction}`;\n\t\t\t}\n\t\t\treturn result;\n\t\t},\n\t},\n\twatch: {\n\t\tsrc() {\n\t\t\tthis.onChangeImage();\n\t\t},\n\t\tstencilComponent() {\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.resetCoordinates();\n\t\t\t\tthis.runAutoZoom('setCoordinates');\n\t\t\t\tthis.onChange();\n\t\t\t});\n\t\t},\n\t\tminWidth() {\n\t\t\tthis.onPropsChange();\n\t\t},\n\t\tmaxWidth() {\n\t\t\tthis.onPropsChange();\n\t\t},\n\t\tminHeight() {\n\t\t\tthis.onPropsChange();\n\t\t},\n\t\tmaxHeight() {\n\t\t\tthis.onPropsChange();\n\t\t},\n\t\timageRestriction() {\n\t\t\tthis.reset();\n\t\t},\n\t\tstencilProps(oldProps, newProps) {\n\t\t\tconst significantProps = ['aspectRatio', 'minAspectRatio', 'maxAspectRatio'];\n\t\t\tif (significantProps.find((prop) => oldProps[prop] !== newProps[prop])) {\n\t\t\t\tthis.$nextTick(this.onPropsChange);\n\t\t\t}\n\t\t},\n\t},\n\tcreated() {\n\t\tthis.debouncedUpdate = debounce(this.update, this.debounce);\n\t\tthis.debouncedDisableTransitions = debounce(this.disableTransitions, this.transitionsOptions.time);\n\t\tthis.awaiting = false;\n\t},\n\tmounted() {\n\t\tthis.$refs.image.addEventListener('load', this.onSuccessLoadImage);\n\t\tthis.$refs.image.addEventListener('error', this.onFailLoadImage);\n\t\tthis.onChangeImage();\n\n\t\t// Add listeners to window to adapt the cropper to window changes\n\t\twindow.addEventListener('resize', this.refresh);\n\t\twindow.addEventListener('orientationchange', this.refresh);\n\t},\n\tunmounted() {\n\t\twindow.removeEventListener('resize', this.refresh);\n\t\twindow.removeEventListener('orientationchange', this.refresh);\n\t\tif (this.imageAttributes.revoke && this.imageAttributes.src) {\n\t\t\tURL.revokeObjectURL(this.imageAttributes.src);\n\t\t}\n\t},\n\tmethods: {\n\t\t// External methods\n\t\tgetResult() {\n\t\t\tconst coordinates = this.initialized\n\t\t\t\t? this.prepareResult({ ...this.coordinates })\n\t\t\t\t: this.defaultCoordinates();\n\t\t\tconst imageTransforms = {\n\t\t\t\trotate: this.imageTransforms.rotate % 360,\n\t\t\t\tflip: {\n\t\t\t\t\t...this.imageTransforms.flip,\n\t\t\t\t},\n\t\t\t};\n\t\t\tif (this.src && this.imageLoaded) {\n\t\t\t\tconst cropper = this;\n\t\t\t\treturn {\n\t\t\t\t\timage: this.image,\n\t\t\t\t\tcoordinates,\n\t\t\t\t\tvisibleArea: this.visibleArea ? { ...this.visibleArea } : null,\n\t\t\t\t\timageTransforms,\n\t\t\t\t\tget canvas() {\n\t\t\t\t\t\tif (cropper.canvas) {\n\t\t\t\t\t\t\treturn cropper.getCanvas();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn {\n\t\t\t\t\timage: this.image,\n\t\t\t\t\tcoordinates,\n\t\t\t\t\tvisibleArea: this.visibleArea ? { ...this.visibleArea } : null,\n\t\t\t\t\tcanvas: undefined,\n\t\t\t\t\timageTransforms,\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\t\tzoom(factor, center, params = {}) {\n\t\t\tconst { transitions = true } = params;\n\n\t\t\tthis.onManipulateImage(\n\t\t\t\tnew ManipulateImageEvent(\n\t\t\t\t\t{},\n\t\t\t\t\t{\n\t\t\t\t\t\tfactor: 1 / factor,\n\t\t\t\t\t\tcenter,\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t\t{\n\t\t\t\t\tnormalize: false,\n\t\t\t\t\ttransitions,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tmove(left, top, params = {}) {\n\t\t\tconst { transitions = true } = params;\n\n\t\t\tthis.onManipulateImage(\n\t\t\t\tnew ManipulateImageEvent({\n\t\t\t\t\tleft: left || 0,\n\t\t\t\t\ttop: top || 0,\n\t\t\t\t}),\n\t\t\t\t{\n\t\t\t\t\tnormalize: false,\n\t\t\t\t\ttransitions,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tsetCoordinates(transforms, params = {}) {\n\t\t\tconst { autoZoom = true, transitions = true } = params;\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tif (!this.imageLoaded) {\n\t\t\t\t\tthis.delayedTransforms = transforms;\n\t\t\t\t} else {\n\t\t\t\t\tif (!this.transitionsActive) {\n\t\t\t\t\t\tif (transitions) {\n\t\t\t\t\t\t\tthis.enableTransitions();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.coordinates = this.applyTransform(transforms);\n\t\t\t\t\t\tif (autoZoom) {\n\t\t\t\t\t\t\tthis.runAutoZoom('setCoordinates');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (transitions) {\n\t\t\t\t\t\t\tthis.debouncedDisableTransitions();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.onChange();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\trefresh() {\n\t\t\tconst image = this.$refs.image;\n\t\t\tif (this.src && image) {\n\t\t\t\tlet promise;\n\t\t\t\tif (this.initialized) {\n\t\t\t\t\treturn this.updateVisibleArea().then(() => {\n\t\t\t\t\t\tthis.onChange();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturn this.resetVisibleArea().then(() => {\n\t\t\t\t\t\tthis.onChange();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\treset() {\n\t\t\treturn this.resetVisibleArea().then(() => {\n\t\t\t\tthis.onChange();\n\t\t\t});\n\t\t},\n\t\t// Internal methods\n\t\tawaitRender(callback) {\n\t\t\tif (!this.awaiting) {\n\t\t\t\tthis.awaiting = true;\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tcallback();\n\t\t\t\t\tthis.awaiting = false;\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tprepareResult(coordinates) {\n\t\t\tif (this.roundResult) {\n\t\t\t\treturn algorithms.roundCoordinates({\n\t\t\t\t\t...this.getPublicProperties(),\n\t\t\t\t\tpositionRestrictions: algorithms.limitBy(this.positionRestrictions, this.visibleArea),\n\t\t\t\t\tcoordinates,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn coordinates;\n\t\t\t}\n\t\t},\n\t\tprocessAutoZoom(type, visibleArea, coordinates, params) {\n\t\t\tlet algorithm = this.autoZoomAlgorithm;\n\n\t\t\tif (!algorithm) {\n\t\t\t\tif (this.stencilSize) {\n\t\t\t\t\talgorithm = algorithms.fixedStencilAutoZoom;\n\t\t\t\t} else if (this.autoZoom) {\n\t\t\t\t\talgorithm = algorithms.hybridStencilAutoZoom;\n\t\t\t\t} else {\n\t\t\t\t\talgorithm = algorithms.simplestAutoZoom;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst result = algorithm({\n\t\t\t\tevent: {\n\t\t\t\t\ttype,\n\t\t\t\t\tparams,\n\t\t\t\t},\n\t\t\t\tvisibleArea,\n\t\t\t\tcoordinates,\n\t\t\t\tboundaries: this.boundaries,\n\t\t\t\taspectRatio: this.getAspectRatio(),\n\t\t\t\tpositionRestrictions: this.positionRestrictions,\n\t\t\t\tgetAreaRestrictions: this.getAreaRestrictions,\n\t\t\t\tsizeRestrictions: this.sizeRestrictions,\n\t\t\t\tstencilSize: this.getStencilSize(),\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\t...result,\n\t\t\t\tchanged: !isEqual(result.visibleArea, visibleArea) || !isEqual(result.coordinates, coordinates),\n\t\t\t};\n\t\t},\n\t\trunAutoZoom(event, params = {}) {\n\t\t\tconst { transitions = false, ...payload } = params;\n\n\t\t\tconst { visibleArea, coordinates, changed } = this.processAutoZoom(\n\t\t\t\tevent,\n\t\t\t\tthis.visibleArea,\n\t\t\t\tthis.coordinates,\n\t\t\t\tpayload,\n\t\t\t);\n\n\t\t\tif (transitions && changed) {\n\t\t\t\tthis.enableTransitions();\n\t\t\t}\n\n\t\t\tthis.visibleArea = visibleArea;\n\t\t\tthis.coordinates = coordinates;\n\n\t\t\tif (transitions && changed) {\n\t\t\t\tthis.debouncedDisableTransitions();\n\t\t\t}\n\t\t},\n\t\tnormalizeEvent(event) {\n\t\t\treturn algorithms.normalizeEvent({\n\t\t\t\t...this.getPublicProperties(),\n\t\t\t\tevent,\n\t\t\t});\n\t\t},\n\t\tgetCanvas() {\n\t\t\t// This function can be asynchronously called because it's debounced\n\t\t\t// Therefore there is workaround to prevent processing after the component was unmounted\n\t\t\tif (this.$refs.canvas) {\n\t\t\t\tconst canvas = this.$refs.canvas;\n\t\t\t\tconst image = this.$refs.image;\n\t\t\t\tconst imageTransformed =\n\t\t\t\t\tthis.imageTransforms.rotate !== 0 ||\n\t\t\t\t\tthis.imageTransforms.flip.horizontal ||\n\t\t\t\t\tthis.imageTransforms.flip.vertical;\n\t\t\t\tconst source = imageTransformed\n\t\t\t\t\t? prepareSource(this.$refs.sourceCanvas, image, this.imageTransforms)\n\t\t\t\t\t: image;\n\n\t\t\t\tconst options = {\n\t\t\t\t\tminWidth: 0,\n\t\t\t\t\tminHeight: 0,\n\t\t\t\t\tmaxWidth: Infinity,\n\t\t\t\t\tmaxHeight: Infinity,\n\t\t\t\t\tmaxArea: this.maxCanvasSize,\n\t\t\t\t\timageSmoothingEnabled: true,\n\t\t\t\t\timageSmoothingQuality: 'high',\n\t\t\t\t\tfillColor: 'transparent',\n\t\t\t\t\t...this.canvas,\n\t\t\t\t};\n\n\t\t\t\tconst firstNumeric = (array) => array.find((el) => isNumeric(el));\n\n\t\t\t\tlet size = approximatedSize({\n\t\t\t\t\tsizeRestrictions: {\n\t\t\t\t\t\tminWidth: firstNumeric([options.width, options.minWidth]) || 0,\n\t\t\t\t\t\tminHeight: firstNumeric([options.height, options.minHeight]) || 0,\n\t\t\t\t\t\tmaxWidth: firstNumeric([options.width, options.maxWidth]) || Infinity,\n\t\t\t\t\t\tmaxHeight: firstNumeric([options.height, options.maxHeight]) || Infinity,\n\t\t\t\t\t},\n\t\t\t\t\twidth: this.coordinates.width,\n\t\t\t\t\theight: this.coordinates.height,\n\t\t\t\t\taspectRatio: {\n\t\t\t\t\t\tminimum: this.coordinates.width / this.coordinates.height,\n\t\t\t\t\t\tmaximum: this.coordinates.width / this.coordinates.height,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tif (options.maxArea && size.width * size.height > options.maxArea) {\n\t\t\t\t\tconst scale = Math.sqrt(options.maxArea / (size.width * size.height));\n\t\t\t\t\tsize = {\n\t\t\t\t\t\twidth: Math.round(scale * size.width),\n\t\t\t\t\t\theight: Math.round(scale * size.height),\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tupdateCanvas(canvas, source, this.coordinates, size, options);\n\n\t\t\t\treturn canvas;\n\t\t\t}\n\t\t},\n\t\tupdate() {\n\t\t\tthis.$emit('change', this.getResult());\n\t\t},\n\t\tapplyTransform(transform, limited = false) {\n\t\t\tconst sizeRestrictions =\n\t\t\t\tthis.visibleArea && limited\n\t\t\t\t\t? limitSizeRestrictions(this.sizeRestrictions, this.visibleArea)\n\t\t\t\t\t: this.sizeRestrictions;\n\n\t\t\tconst positionRestrictions =\n\t\t\t\tthis.visibleArea && limited\n\t\t\t\t\t? limitBy(this.positionRestrictions, this.visibleArea)\n\t\t\t\t\t: this.positionRestrictions;\n\n\t\t\treturn algorithms.applyTransform({\n\t\t\t\ttransform,\n\t\t\t\tcoordinates: this.coordinates,\n\t\t\t\timageSize: this.imageSize,\n\t\t\t\tsizeRestrictions,\n\t\t\t\tpositionRestrictions,\n\t\t\t\taspectRatio: this.getAspectRatio(),\n\t\t\t\tvisibleArea: this.visibleArea,\n\t\t\t});\n\t\t},\n\t\tresetCoordinates() {\n\t\t\t// This function can be asynchronously called after completion of refreshing image promise\n\t\t\t// Therefore there is a workaround to prevent processing after the component was unmounted\n\t\t\t// Also coordinates can't be reset if visible area was not initialized\n\t\t\tif (this.$refs.image) {\n\t\t\t\tconst cropper = this.$refs.cropper;\n\t\t\t\tconst image = this.$refs.image;\n\n\t\t\t\tlet defaultSizeAlgorithm = this.defaultSize;\n\t\t\t\tif (!defaultSizeAlgorithm) {\n\t\t\t\t\tif (this.stencilSize) {\n\t\t\t\t\t\tdefaultSizeAlgorithm = algorithms.fixedDefaultSize;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdefaultSizeAlgorithm = algorithms.defaultSize;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst { minWidth, minHeight, maxWidth, maxHeight } = this.sizeRestrictions;\n\n\t\t\t\tconst defaultSize = isFunction(defaultSizeAlgorithm)\n\t\t\t\t\t? defaultSizeAlgorithm({\n\t\t\t\t\t\t\tboundaries: this.boundaries,\n\t\t\t\t\t\t\timageSize: this.imageSize,\n\t\t\t\t\t\t\taspectRatio: this.getAspectRatio(),\n\t\t\t\t\t\t\tsizeRestrictions: this.sizeRestrictions,\n\t\t\t\t\t\t\tstencilSize: this.getStencilSize(),\n\t\t\t\t\t\t\tvisibleArea: this.visibleArea,\n\t\t\t\t\t  })\n\t\t\t\t\t: defaultSizeAlgorithm;\n\n\t\t\t\tif (\n\t\t\t\t\tprocess.env.NODE_ENV === 'development' &&\n\t\t\t\t\t(defaultSize.width < minWidth ||\n\t\t\t\t\t\tdefaultSize.height < minHeight ||\n\t\t\t\t\t\tdefaultSize.width > maxWidth ||\n\t\t\t\t\t\tdefaultSize.height > maxHeight)\n\t\t\t\t) {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'Warning: the default size breaks size restrictions. Check your defaultSize function',\n\t\t\t\t\t\tdefaultSize,\n\t\t\t\t\t\tthis.sizeRestrictions,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tconst defaultPositionAlgorithm = this.defaultPosition || algorithms.defaultPosition;\n\n\t\t\t\tconst transforms = [\n\t\t\t\t\tdefaultSize,\n\t\t\t\t\t({ coordinates }) => ({\n\t\t\t\t\t\t...(isFunction(defaultPositionAlgorithm)\n\t\t\t\t\t\t\t? defaultPositionAlgorithm({\n\t\t\t\t\t\t\t\t\tcoordinates,\n\t\t\t\t\t\t\t\t\timageSize: this.imageSize,\n\t\t\t\t\t\t\t\t\tvisibleArea: this.visibleArea,\n\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t\t: this.defaultPosition),\n\t\t\t\t\t}),\n\t\t\t\t];\n\n\t\t\t\tif (this.delayedTransforms) {\n\t\t\t\t\ttransforms.push(\n\t\t\t\t\t\t...(Array.isArray(this.delayedTransforms) ? this.delayedTransforms : [this.delayedTransforms]),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tthis.coordinates = this.applyTransform(transforms, true);\n\t\t\t\tthis.delayedTransforms = null;\n\t\t\t}\n\t\t},\n\t\tclearImage() {\n\t\t\tthis.imageLoaded = false;\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst stretcher = this.$refs.stretcher;\n\t\t\t\tif (stretcher) {\n\t\t\t\t\tstretcher.style.height = 'auto';\n\t\t\t\t\tstretcher.style.width = 'auto';\n\t\t\t\t}\n\t\t\t\tthis.coordinates = this.defaultCoordinates();\n\t\t\t\tthis.boundaries = {\n\t\t\t\t\twidth: 0,\n\t\t\t\t\theight: 0,\n\t\t\t\t};\n\t\t\t}, this.transitionTime);\n\t\t},\n\t\tenableTransitions() {\n\t\t\tif (this.transitions) {\n\t\t\t\tthis.transitionsActive = true;\n\t\t\t}\n\t\t},\n\t\tdisableTransitions() {\n\t\t\tthis.transitionsActive = false;\n\t\t},\n\t\tupdateBoundaries() {\n\t\t\tconst stretcher = this.$refs.stretcher;\n\t\t\tconst cropper = this.$refs.cropper;\n\n\t\t\tthis.initStretcher({\n\t\t\t\tcropper,\n\t\t\t\tstretcher,\n\t\t\t\timageSize: this.imageSize,\n\t\t\t});\n\n\t\t\treturn this.$nextTick().then(() => {\n\t\t\t\tconst params = {\n\t\t\t\t\tcropper,\n\t\t\t\t\timageSize: this.imageSize,\n\t\t\t\t};\n\n\t\t\t\tif (isFunction(this.defaultBoundaries)) {\n\t\t\t\t\tthis.boundaries = this.defaultBoundaries(params);\n\t\t\t\t} else if (this.defaultBoundaries === 'fit') {\n\t\t\t\t\tthis.boundaries = fitBoundaries(params);\n\t\t\t\t} else {\n\t\t\t\t\tthis.boundaries = fillBoundaries(params);\n\t\t\t\t}\n\n\t\t\t\tif (!this.boundaries.width || !this.boundaries.height) {\n\t\t\t\t\tthrow new Error(\"It's impossible to fit the cropper in the current container\");\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tresetVisibleArea() {\n\t\t\treturn this.updateBoundaries()\n\t\t\t\t.then(() => {\n\t\t\t\t\tif (this.priority !== 'visible-area') {\n\t\t\t\t\t\tthis.visibleArea = null;\n\t\t\t\t\t\tthis.resetCoordinates();\n\t\t\t\t\t}\n\n\t\t\t\t\tlet algorithm = this.defaultVisibleArea || algorithms.defaultVisibleArea;\n\n\t\t\t\t\tthis.visibleArea = isFunction(algorithm)\n\t\t\t\t\t\t? algorithm({\n\t\t\t\t\t\t\t\timageSize: this.imageSize,\n\t\t\t\t\t\t\t\tboundaries: this.boundaries,\n\t\t\t\t\t\t\t\tcoordinates: this.priority !== 'visible-area' ? this.coordinates : null,\n\t\t\t\t\t\t\t\tgetAreaRestrictions: this.getAreaRestrictions,\n\t\t\t\t\t\t\t\tstencilSize: this.getStencilSize(),\n\t\t\t\t\t\t  })\n\t\t\t\t\t\t: this.defaultVisibleArea;\n\n\t\t\t\t\tthis.visibleArea = algorithms.refineVisibleArea({\n\t\t\t\t\t\tvisibleArea: this.visibleArea,\n\t\t\t\t\t\tboundaries: this.boundaries,\n\t\t\t\t\t\tgetAreaRestrictions: this.getAreaRestrictions,\n\t\t\t\t\t});\n\n\t\t\t\t\tif (this.priority === 'visible-area') {\n\t\t\t\t\t\tthis.resetCoordinates();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.coordinates = this.fitCoordinates({\n\t\t\t\t\t\t\tvisibleArea: this.visibleArea,\n\t\t\t\t\t\t\tcoordinates: this.coordinates,\n\t\t\t\t\t\t\taspectRatio: this.getAspectRatio(),\n\t\t\t\t\t\t\tpositionRestrictions: this.positionRestrictions,\n\t\t\t\t\t\t\tsizeRestrictions: this.sizeRestrictions,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.runAutoZoom('resetVisibleArea');\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.visibleArea = null;\n\t\t\t\t});\n\t\t},\n\t\tupdateVisibleArea() {\n\t\t\treturn this.updateBoundaries()\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.visibleArea = this.fitVisibleArea({\n\t\t\t\t\t\timageSize: this.imageSize,\n\t\t\t\t\t\tboundaries: this.boundaries,\n\t\t\t\t\t\tvisibleArea: this.visibleArea,\n\t\t\t\t\t\tcoordinates: this.coordinates,\n\t\t\t\t\t\tgetAreaRestrictions: this.getAreaRestrictions,\n\t\t\t\t\t});\n\t\t\t\t\tthis.coordinates = this.fitCoordinates({\n\t\t\t\t\t\tvisibleArea: this.visibleArea,\n\t\t\t\t\t\tcoordinates: this.coordinates,\n\t\t\t\t\t\taspectRatio: this.getAspectRatio(),\n\t\t\t\t\t\tpositionRestrictions: this.positionRestrictions,\n\t\t\t\t\t\tsizeRestrictions: this.sizeRestrictions,\n\t\t\t\t\t});\n\t\t\t\t\tthis.runAutoZoom('updateVisibleArea');\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.visibleArea = null;\n\t\t\t\t});\n\t\t},\n\t\tonChange(debounce = true) {\n\t\t\tif (debounce && this.debounce) {\n\t\t\t\tthis.debouncedUpdate();\n\t\t\t} else {\n\t\t\t\tthis.update();\n\t\t\t}\n\t\t},\n\t\tonChangeImage() {\n\t\t\tthis.imageLoaded = false;\n\t\t\tthis.delayedTransforms = null;\n\n\t\t\tif (this.src) {\n\t\t\t\tif (isCrossOriginURL(this.src)) {\n\t\t\t\t\tlet crossOrigin = isUndefined(this.crossOrigin) ? this.canvas : this.crossOrigin;\n\t\t\t\t\tif (crossOrigin === true) {\n\t\t\t\t\t\tcrossOrigin = 'anonymous';\n\t\t\t\t\t}\n\t\t\t\t\tthis.imageAttributes.crossOrigin = crossOrigin || null;\n\t\t\t\t}\n\t\t\t\tif (this.checkOrientation) {\n\t\t\t\t\tconst promise = parseImage(this.src);\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tpromise.then(this.onParseImage);\n\t\t\t\t\t}, this.transitionTime);\n\t\t\t\t} else {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tthis.onParseImage({ source: this.src });\n\t\t\t\t\t}, this.transitionTime);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.clearImage();\n\t\t\t}\n\t\t},\n\t\tonFailLoadImage() {\n\t\t\tif (this.imageAttributes.src) {\n\t\t\t\tthis.clearImage();\n\t\t\t\tthis.$emit('error');\n\t\t\t}\n\t\t},\n\t\tonSuccessLoadImage() {\n\t\t\t// After loading image the current component can be unmounted\n\t\t\t// Therefore there is a workaround to prevent processing the following code\n\t\t\tconst image = this.$refs.image;\n\t\t\tif (image && !this.imageLoaded) {\n\t\t\t\tthis.imageAttributes.height = image.naturalHeight;\n\t\t\t\tthis.imageAttributes.width = image.naturalWidth;\n\t\t\t\tthis.imageLoaded = true;\n\t\t\t\tthis.reset().then(() => {\n\t\t\t\t\tthis.$emit('ready');\n\t\t\t\t\tthis.onChange(false);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonParseImage({ source, arrayBuffer, orientation }) {\n\t\t\tif (this.imageAttributes.revoke && this.imageAttributes.src) {\n\t\t\t\tURL.revokeObjectURL(this.imageAttributes.src);\n\t\t\t}\n\t\t\tthis.imageAttributes.revoke = false;\n\t\t\tif (arrayBuffer && orientation && orientation > 1 && isLocal(source)) {\n\t\t\t\tif (isBlob(source)) {\n\t\t\t\t\tthis.imageAttributes.src = URL.createObjectURL(new Blob([arrayBuffer]));\n\t\t\t\t\tthis.imageAttributes.revoke = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis.imageAttributes.src = arrayBufferToDataURL(arrayBuffer);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.imageAttributes.src = source;\n\t\t\t}\n\t\t\tthis.customImageTransforms = {\n\t\t\t\trotate: 0,\n\t\t\t\tflip: {\n\t\t\t\t\thorizontal: false,\n\t\t\t\t\tvertical: false,\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.basicImageTransforms = {\n\t\t\t\t...this.customImageTransforms,\n\t\t\t\t...getImageTransforms(orientation),\n\t\t\t};\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tconst image = this.$refs.image;\n\t\t\t\tif (image && image.complete) {\n\t\t\t\t\tif (isLoadedImage(image)) {\n\t\t\t\t\t\tthis.onSuccessLoadImage();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.onFailLoadImage();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tonResizeEnd() {\n\t\t\tthis.runAutoZoom('resize', {\n\t\t\t\ttransitions: true,\n\t\t\t});\n\t\t},\n\t\tonMoveEnd() {\n\t\t\tthis.runAutoZoom('move', {\n\t\t\t\ttransitions: true,\n\t\t\t});\n\t\t},\n\t\tonMove(event) {\n\t\t\tif (!this.transitionsOptions.enabled) {\n\t\t\t\tthis.awaitRender(() => {\n\t\t\t\t\tthis.coordinates = this.moveAlgorithm({\n\t\t\t\t\t\t...this.getPublicProperties(),\n\t\t\t\t\t\tpositionRestrictions: algorithms.limitBy(this.positionRestrictions, this.visibleArea),\n\t\t\t\t\t\tcoordinates: this.coordinates,\n\t\t\t\t\t\tevent: this.normalizeEvent(event),\n\t\t\t\t\t});\n\t\t\t\t\tthis.onChange();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonResize(event) {\n\t\t\tif (!this.transitionsOptions.enabled && (!this.stencilSize || this.autoZoom)) {\n\t\t\t\tthis.awaitRender(() => {\n\t\t\t\t\tconst sizeRestrictions = this.sizeRestrictions;\n\n\t\t\t\t\t// The magic number is the approximation of the handler size\n\t\t\t\t\t// Temporary solution that should be improved in the future\n\t\t\t\t\tconst minimumSize = Math.min(\n\t\t\t\t\t\tthis.coordinates.width,\n\t\t\t\t\t\tthis.coordinates.height,\n\t\t\t\t\t\t20 * this.coefficient,\n\t\t\t\t\t);\n\n\t\t\t\t\tthis.coordinates = this.resizeAlgorithm({\n\t\t\t\t\t\t...this.getPublicProperties(),\n\t\t\t\t\t\tpositionRestrictions: algorithms.limitBy(this.positionRestrictions, this.visibleArea),\n\t\t\t\t\t\tsizeRestrictions: {\n\t\t\t\t\t\t\tmaxWidth: Math.min(sizeRestrictions.maxWidth, this.visibleArea.width),\n\t\t\t\t\t\t\tmaxHeight: Math.min(sizeRestrictions.maxHeight, this.visibleArea.height),\n\t\t\t\t\t\t\tminWidth: Math.max(sizeRestrictions.minWidth, minimumSize),\n\t\t\t\t\t\t\tminHeight: Math.max(sizeRestrictions.minHeight, minimumSize),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tevent: this.normalizeEvent(event),\n\t\t\t\t\t});\n\t\t\t\t\tthis.onChange();\n\t\t\t\t\tthis.ticking = false;\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonManipulateImage(event, params = {}) {\n\t\t\tif (!this.transitionsOptions.enabled) {\n\t\t\t\tconst { transitions = false, normalize = true } = params;\n\t\t\t\tif (transitions) {\n\t\t\t\t\tthis.enableTransitions();\n\t\t\t\t}\n\t\t\t\tconst { visibleArea, coordinates } = algorithms.manipulateImage({\n\t\t\t\t\t...this.getPublicProperties(),\n\t\t\t\t\tevent: normalize ? this.normalizeEvent(event) : event,\n\t\t\t\t\tgetAreaRestrictions: this.getAreaRestrictions,\n\t\t\t\t\timageRestriction: this.imageRestriction,\n\t\t\t\t\tadjustStencil: !this.stencilSize && this.settings.resizeImage.adjustStencil,\n\t\t\t\t});\n\n\t\t\t\tthis.visibleArea = visibleArea;\n\t\t\t\tthis.coordinates = coordinates;\n\n\t\t\t\tthis.runAutoZoom('manipulateImage');\n\n\t\t\t\tthis.onChange();\n\n\t\t\t\tif (transitions) {\n\t\t\t\t\tthis.debouncedDisableTransitions();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonPropsChange() {\n\t\t\tthis.coordinates = this.applyTransform(this.coordinates, true);\n\t\t\tthis.onChange(false);\n\t\t},\n\t\tgetAreaRestrictions({ visibleArea, type = 'move' } = {}) {\n\t\t\treturn this.areaRestrictionsAlgorithm({\n\t\t\t\tboundaries: this.boundaries,\n\t\t\t\timageSize: this.imageSize,\n\t\t\t\timageRestriction: this.imageRestriction,\n\t\t\t\tvisibleArea,\n\t\t\t\ttype,\n\t\t\t});\n\t\t},\n\t\tgetAspectRatio(ignoreStencil) {\n\t\t\tlet minimum, maximum;\n\t\t\tconst { aspectRatio, minAspectRatio, maxAspectRatio } = this.stencilProps;\n\n\t\t\tif (this.$refs.stencil.aspectRatios) {\n\t\t\t\t({ minimum, maximum } = this.$refs.stencil.aspectRatios());\n\t\t\t}\n\n\t\t\tif (isUndefined(minimum)) {\n\t\t\t\tminimum = !isUndefined(aspectRatio) ? aspectRatio : minAspectRatio;\n\t\t\t}\n\t\t\tif (isUndefined(maximum)) {\n\t\t\t\tmaximum = !isUndefined(aspectRatio) ? aspectRatio : maxAspectRatio;\n\t\t\t}\n\n\t\t\tif (!ignoreStencil && (isUndefined(minimum) || isUndefined(maximum))) {\n\t\t\t\tconst stencilSize = this.getStencilSize();\n\t\t\t\tconst stencilRatio = stencilSize ? ratio(stencilSize) : null;\n\t\t\t\tif (isUndefined(minimum)) {\n\t\t\t\t\tminimum = isNumber(stencilRatio) ? stencilRatio : undefined;\n\t\t\t\t}\n\t\t\t\tif (isUndefined(maximum)) {\n\t\t\t\t\tmaximum = isNumber(stencilRatio) ? stencilRatio : undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tminimum,\n\t\t\t\tmaximum,\n\t\t\t};\n\t\t},\n\t\tgetStencilSize() {\n\t\t\tif (this.stencilSize) {\n\t\t\t\treturn algorithms.calculateStencilSize({\n\t\t\t\t\tcurrentStencilSize: {\n\t\t\t\t\t\twidth: this.stencilCoordinates.width,\n\t\t\t\t\t\theight: this.stencilCoordinates.height,\n\t\t\t\t\t},\n\t\t\t\t\tstencilSize: this.stencilSize,\n\t\t\t\t\tboundaries: this.boundaries,\n\t\t\t\t\tcoefficient: this.coefficient,\n\t\t\t\t\tcoordinates: this.coordinates,\n\t\t\t\t\taspectRatio: this.getAspectRatio(true),\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tgetPublicProperties() {\n\t\t\treturn {\n\t\t\t\tcoefficient: this.coefficient,\n\t\t\t\tvisibleArea: this.visibleArea,\n\t\t\t\tcoordinates: this.coordinates,\n\t\t\t\tboundaries: this.boundaries,\n\t\t\t\tsizeRestrictions: this.sizeRestrictions,\n\t\t\t\tpositionRestrictions: this.positionRestrictions,\n\t\t\t\taspectRatio: this.getAspectRatio(),\n\t\t\t\timageRestriction: this.imageRestriction,\n\t\t\t};\n\t\t},\n\t\tdefaultCoordinates() {\n\t\t\treturn { ...DEFAULT_COORDINATES };\n\t\t},\n\t\tflip(horizontal, vertical, options = {}) {\n\t\t\tconst { transitions = true } = options;\n\t\t\tif (!this.transitionsActive) {\n\t\t\t\tif (transitions) {\n\t\t\t\t\tthis.enableTransitions();\n\t\t\t\t}\n\n\t\t\t\tconst previousFlip = {\n\t\t\t\t\t...this.imageTransforms.flip,\n\t\t\t\t};\n\n\t\t\t\tlet { visibleArea, coordinates } = algorithms.flipImage({\n\t\t\t\t\tflip: {\n\t\t\t\t\t\thorizontal: horizontal ? !previousFlip.horizontal : previousFlip.horizontal,\n\t\t\t\t\t\tvertical: vertical ? !previousFlip.vertical : previousFlip.vertical,\n\t\t\t\t\t},\n\t\t\t\t\tpreviousFlip,\n\t\t\t\t\trotate: this.imageTransforms.rotate,\n\t\t\t\t\tvisibleArea: this.visibleArea,\n\t\t\t\t\tcoordinates: this.coordinates,\n\t\t\t\t\timageSize: this.imageSize,\n\t\t\t\t\tpositionRestrictions: this.positionRestrictions,\n\t\t\t\t\tsizeRestrictions: this.sizeRestrictions,\n\t\t\t\t\tgetAreaRestrictions: this.getAreaRestrictions,\n\t\t\t\t\taspectRatio: this.getAspectRatio(),\n\t\t\t\t});\n\n\t\t\t\tif (horizontal) {\n\t\t\t\t\tthis.customImageTransforms.flip.horizontal = !this.customImageTransforms.flip.horizontal;\n\t\t\t\t}\n\t\t\t\tif (vertical) {\n\t\t\t\t\tthis.customImageTransforms.flip.vertical = !this.customImageTransforms.flip.vertical;\n\t\t\t\t}\n\n\t\t\t\tthis.visibleArea = visibleArea;\n\t\t\t\tthis.coordinates = coordinates;\n\n\t\t\t\tthis.onChange();\n\t\t\t\tif (transitions) {\n\t\t\t\t\tthis.debouncedDisableTransitions();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\trotate(angle, options = {}) {\n\t\t\tconst { transitions = true } = options;\n\n\t\t\tif (!this.transitionsActive) {\n\t\t\t\tif (transitions) {\n\t\t\t\t\tthis.enableTransitions();\n\t\t\t\t}\n\t\t\t\tconst previousImageSize = { ...this.imageSize };\n\n\t\t\t\tthis.customImageTransforms.rotate += angle;\n\t\t\t\tlet { visibleArea, coordinates } = algorithms.rotateImage({\n\t\t\t\t\tvisibleArea: this.visibleArea,\n\t\t\t\t\tcoordinates: this.coordinates,\n\t\t\t\t\tpreviousImageSize,\n\t\t\t\t\timageSize: this.imageSize,\n\t\t\t\t\tangle,\n\t\t\t\t\tpositionRestrictions: this.positionRestrictions,\n\t\t\t\t\tsizeRestrictions: this.sizeRestrictions,\n\t\t\t\t\tgetAreaRestrictions: this.getAreaRestrictions,\n\t\t\t\t\taspectRatio: this.getAspectRatio(),\n\t\t\t\t});\n\n\t\t\t\t({ visibleArea, coordinates } = this.processAutoZoom('rotateImage', visibleArea, coordinates));\n\n\t\t\t\tthis.visibleArea = visibleArea;\n\t\t\t\tthis.coordinates = coordinates;\n\n\t\t\t\tthis.onChange();\n\n\t\t\t\tif (transitions) {\n\t\t\t\t\tthis.debouncedDisableTransitions();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\temits: ['change', 'error', 'ready'],\n};\n</script>\n\n<template>\n\t<div ref=\"cropper\" :class=\"classes.cropper\">\n\t\t<div ref=\"stretcher\" :class=\"classes.stretcher\" />\n\n\t\t<div :class=\"classes.boundaries\" :style=\"boundariesStyle\">\n\t\t\t<component\n\t\t\t\t:is=\"backgroundWrapperComponent\"\n\t\t\t\t:class=\"classes.cropperWrapper\"\n\t\t\t\t:wheel-resize=\"settings.resizeImage.wheel\"\n\t\t\t\t:touch-resize=\"settings.resizeImage.touch\"\n\t\t\t\t:touch-move=\"settings.moveImage.touch\"\n\t\t\t\t:mouse-move=\"settings.moveImage.mouse\"\n\t\t\t\t@move=\"onManipulateImage\"\n\t\t\t\t@resize=\"onManipulateImage\"\n\t\t\t>\n\t\t\t\t<div :class=\"classes.background\" :style=\"boundariesStyle\"></div>\n\t\t\t\t<div :class=\"classes.imageWrapper\">\n\t\t\t\t\t<img\n\t\t\t\t\t\tref=\"image\"\n\t\t\t\t\t\t:crossorigin=\"imageAttributes.crossOrigin\"\n\t\t\t\t\t\t:src=\"imageAttributes.src\"\n\t\t\t\t\t\t:class=\"classes.image\"\n\t\t\t\t\t\t:style=\"imageStyle\"\n\t\t\t\t\t\t@mousedown.prevent\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div :class=\"classes.foreground\" :style=\"boundariesStyle\"></div>\n\t\t\t\t<component\n\t\t\t\t\t:is=\"stencilComponent\"\n\t\t\t\t\tv-show=\"imageLoaded\"\n\t\t\t\t\tref=\"stencil\"\n\t\t\t\t\t:image=\"image\"\n\t\t\t\t\t:coordinates=\"coordinates\"\n\t\t\t\t\t:stencil-coordinates=\"stencilCoordinates\"\n\t\t\t\t\t:transitions=\"transitionsOptions\"\n\t\t\t\t\tv-bind=\"stencilProps\"\n\t\t\t\t\t@resize=\"onResize\"\n\t\t\t\t\t@resize-end=\"onResizeEnd\"\n\t\t\t\t\t@move=\"onMove\"\n\t\t\t\t\t@move-end=\"onMoveEnd\"\n\t\t\t\t/>\n\t\t\t\t<canvas v-if=\"canvas\" ref=\"canvas\" :style=\"{ display: 'none' }\" />\n\t\t\t\t<canvas v-if=\"canvas\" ref=\"sourceCanvas\" :style=\"{ display: 'none' }\" />\n\t\t\t</component>\n\t\t</div>\n\t</div>\n</template>\n\n<style lang=\"scss\">\n.vue-advanced-cropper {\n\ttext-align: center;\n\tposition: relative;\n\tuser-select: none;\n\tmax-height: 100%;\n\tmax-width: 100%;\n\tdirection: ltr;\n\n\t&__stretcher {\n\t\tpointer-events: none;\n\t\tposition: relative;\n\t\tmax-width: 100%;\n\t\tmax-height: 100%;\n\t}\n\n\t&__image {\n\t\tuser-select: none;\n\t\tposition: absolute;\n\t\ttransform-origin: center;\n\t\t// Workaround to prevent bugs at the websites with max-width\n\t\t// rule applied to img (Vuepress for example)\n\t\tmax-width: none !important;\n\t}\n\t&__background,\n\t&__foreground {\n\t\topacity: 1;\n\t\tbackground: black;\n\t\ttransform: translate(-50%, -50%);\n\t\tposition: absolute;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t}\n\t&__foreground {\n\t\topacity: 0.5;\n\t}\n\t&__boundaries {\n\t\topacity: 1;\n\t\ttransform: translate(-50%, -50%);\n\t\tposition: absolute;\n\t\tleft: 50%;\n\t\ttop: 50%;\n\t}\n\t&__cropper-wrapper {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t}\n\t&__image-wrapper {\n\t\toverflow: hidden;\n\t\tposition: absolute;\n\t\twidth: 100%;\n\t\theight: 100%;\n\t}\n\t&__stencil-wrapper {\n\t\tposition: absolute;\n\t}\n}\n</style>\n","import { Size } from '../typings';\r\nimport { ratio } from '../service';\r\n\r\nexport interface InitStretcherParams {\r\n\tstretcher: HTMLElement;\r\n\timageSize: Size;\r\n}\r\nexport function initStretcher({ stretcher, imageSize }: InitStretcherParams): void {\r\n\tconst aspectRatio = ratio(imageSize);\r\n\tstretcher.style.width = `${imageSize.width}px`;\r\n\tstretcher.style.height = `${stretcher.clientWidth / aspectRatio}px`;\r\n\t// Prevent stretching in future until stretcher will be reinitialized\r\n\tstretcher.style.width = `${stretcher.clientWidth}px`;\r\n}\r\n","import { AspectRatio, Coordinates, PositionRestrictions, SizeRestrictions, VisibleArea } from '../typings';\r\nimport { approximatedSize } from './approximatedSize';\r\nimport { applyMove, diff, fit, fitToLimits, getCenter, intersectionLimits, toLimits } from '../service';\r\n\r\nexport interface FitCoordinatesParams {\r\n\tvisibleArea: VisibleArea;\r\n\tcoordinates: Coordinates;\r\n\taspectRatio: AspectRatio;\r\n\tsizeRestrictions: SizeRestrictions;\r\n\tpositionRestrictions: PositionRestrictions;\r\n}\r\n\r\nexport function fitCoordinates(params: FitCoordinatesParams): Coordinates {\r\n\tconst {\r\n\t\tvisibleArea,\r\n\t\tcoordinates: previousCoordinates,\r\n\t\taspectRatio,\r\n\t\tsizeRestrictions,\r\n\t\tpositionRestrictions,\r\n\t} = params;\r\n\r\n\tlet coordinates = {\r\n\t\t...previousCoordinates,\r\n\t\t...approximatedSize({\r\n\t\t\twidth: previousCoordinates.width,\r\n\t\t\theight: previousCoordinates.height,\r\n\t\t\taspectRatio,\r\n\t\t\tsizeRestrictions: {\r\n\t\t\t\tmaxWidth: visibleArea.width,\r\n\t\t\t\tmaxHeight: visibleArea.height,\r\n\t\t\t\tminHeight: Math.min(visibleArea.height, sizeRestrictions.minHeight),\r\n\t\t\t\tminWidth: Math.min(visibleArea.width, sizeRestrictions.minWidth),\r\n\t\t\t},\r\n\t\t}),\r\n\t};\r\n\r\n\tcoordinates = applyMove(coordinates, diff(getCenter(previousCoordinates), getCenter(coordinates)));\r\n\r\n\tcoordinates = fitToLimits(coordinates, intersectionLimits(toLimits(visibleArea), positionRestrictions));\r\n\r\n\treturn coordinates;\r\n}\r\n","import {\r\n\tadjustSize,\r\n\tapplyMove,\r\n\tapplyScale,\r\n\tfit,\r\n\tfitToLimits,\r\n\tgetIntersections,\r\n\tinverseMove,\r\n\tmaxScale,\r\n\tratio,\r\n\ttoLimits,\r\n} from '../service';\r\nimport { Coordinates, AreaRestrictions, VisibleArea, Boundaries, GetAreaRestrictions } from '../typings';\r\n\r\n// This function updates visible area with respect to current transformations and fits\r\n// coordinates to the new visible area\r\nexport interface FitVisibleAreaParams {\r\n\tgetAreaRestrictions: GetAreaRestrictions;\r\n\tcoordinates: Coordinates;\r\n\tvisibleArea: VisibleArea;\r\n\tboundaries: Boundaries;\r\n}\r\nexport function fitVisibleArea(params: FitVisibleAreaParams): VisibleArea {\r\n\tconst { visibleArea: previousVisibleArea, boundaries, getAreaRestrictions, coordinates } = params;\r\n\r\n\tlet visibleArea = { ...previousVisibleArea };\r\n\r\n\t// Scale visible area size to fit new boundaries:\r\n\tvisibleArea.height = visibleArea.width / ratio(boundaries);\r\n\tvisibleArea.top += (previousVisibleArea.height - visibleArea.height) / 2;\r\n\r\n\t// Scale visible area to prevent overlap coordinates\r\n\tif (coordinates.height - visibleArea.height > 0 || coordinates.width - visibleArea.width > 0) {\r\n\t\tvisibleArea = applyScale(\r\n\t\t\tvisibleArea,\r\n\t\t\tMath.max(coordinates.height / visibleArea.height, coordinates.width / visibleArea.width),\r\n\t\t);\r\n\t}\r\n\r\n\t// Scale visible area to prevent overlap area restrictions\r\n\tvisibleArea = applyScale(\r\n\t\tvisibleArea,\r\n\t\tadjustSize(visibleArea, getAreaRestrictions({ visibleArea, type: 'resize' })),\r\n\t);\r\n\r\n\t// Move visible are to prevent moving of the coordinates:\r\n\tconst move = inverseMove(fit(coordinates, toLimits(visibleArea)));\r\n\tif (visibleArea.width < coordinates.width) {\r\n\t\tmove.left = 0;\r\n\t}\r\n\tif (visibleArea.height < coordinates.height) {\r\n\t\tmove.top = 0;\r\n\t}\r\n\tvisibleArea = applyMove(visibleArea, move);\r\n\r\n\t// Move visible area to prevent overlap the area restrictions\r\n\tvisibleArea = fitToLimits(visibleArea, getAreaRestrictions({ visibleArea, type: 'move' }));\r\n\r\n\treturn visibleArea;\r\n}\r\n","import { Boundaries, ImageRestriction, Limits, Size, VisibleArea } from '../typings';\r\nimport { ratio } from '../service';\r\n\r\nexport interface DynamicAreaRestrictionsParams {\r\n\timageRestriction: ImageRestriction;\r\n\timageSize: Size;\r\n\tboundaries: Boundaries;\r\n\tvisibleArea?: VisibleArea;\r\n\tcenter?: boolean;\r\n\ttype: 'resize' | 'move';\r\n}\r\nexport function dynamicAreaRestrictions(params: DynamicAreaRestrictionsParams): Limits {\r\n\tconst { visibleArea, boundaries, imageSize, imageRestriction, type } = params;\r\n\r\n\tlet limits: Limits = {};\r\n\r\n\tif (imageRestriction === 'fill-area') {\r\n\t\tlimits = {\r\n\t\t\tleft: 0,\r\n\t\t\ttop: 0,\r\n\t\t\tright: imageSize.width,\r\n\t\t\tbottom: imageSize.height,\r\n\t\t};\r\n\t} else if (imageRestriction === 'fit-area') {\r\n\t\tif (ratio(boundaries) > ratio(imageSize)) {\r\n\t\t\tlimits = {\r\n\t\t\t\ttop: 0,\r\n\t\t\t\tbottom: imageSize.height,\r\n\t\t\t};\r\n\t\t\tif (visibleArea && type === 'move') {\r\n\t\t\t\tif (visibleArea.width > imageSize.width) {\r\n\t\t\t\t\tlimits.left = -(visibleArea.width - imageSize.width) / 2;\r\n\t\t\t\t\tlimits.right = imageSize.width - limits.left;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlimits.left = 0;\r\n\t\t\t\t\tlimits.right = imageSize.width;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlimits = {\r\n\t\t\t\tleft: 0,\r\n\t\t\t\tright: imageSize.width,\r\n\t\t\t};\r\n\t\t\tif (visibleArea && type === 'move') {\r\n\t\t\t\tif (visibleArea.height > imageSize.height) {\r\n\t\t\t\t\tlimits.top = -(visibleArea.height - imageSize.height) / 2;\r\n\t\t\t\t\tlimits.bottom = imageSize.height - limits.top;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlimits.top = 0;\r\n\t\t\t\t\tlimits.bottom = imageSize.height;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn limits;\r\n}\r\n","import { Size, SizeRestrictions } from '../typings';\r\n\r\nexport interface SizeRestrictionsParams {\r\n\timageSize: Size;\r\n\tminWidth: number;\r\n\tminHeight: number;\r\n\tmaxWidth: number;\r\n\tmaxHeight: number;\r\n}\r\nexport function percentRestrictions({\r\n\timageSize,\r\n\tminWidth,\r\n\tminHeight,\r\n\tmaxWidth,\r\n\tmaxHeight,\r\n}: SizeRestrictionsParams): SizeRestrictions {\r\n\treturn {\r\n\t\tminWidth: (minWidth / 100) * imageSize.width,\r\n\t\tminHeight: (minHeight / 100) * imageSize.height,\r\n\t\tmaxWidth: (maxWidth / 100) * imageSize.width,\r\n\t\tmaxHeight: (maxHeight / 100) * imageSize.height,\r\n\t};\r\n}\r\n\r\nexport function pixelsRestrictions({\r\n\tminWidth,\r\n\tminHeight,\r\n\tmaxWidth,\r\n\tmaxHeight,\r\n}: SizeRestrictionsParams): SizeRestrictions {\r\n\treturn {\r\n\t\tminWidth,\r\n\t\tminHeight,\r\n\t\tmaxWidth,\r\n\t\tmaxHeight,\r\n\t};\r\n}\r\n","import { ImageRestriction, Limits, Size } from '../typings';\r\n\r\nexport interface PositionRestrictionsParams {\r\n\timageRestriction: ImageRestriction;\r\n\timageSize: Size;\r\n}\r\nexport function positionRestrictions({ imageSize, imageRestriction }: PositionRestrictionsParams): Limits {\r\n\tlet limits = {};\r\n\r\n\tif (imageRestriction !== 'none') {\r\n\t\tlimits = {\r\n\t\t\tleft: 0,\r\n\t\t\ttop: 0,\r\n\t\t\tright: imageSize.width,\r\n\t\t\tbottom: imageSize.height,\r\n\t\t};\r\n\t}\r\n\r\n\treturn limits;\r\n}\r\n","import {\r\n\tAreaRestrictions,\r\n\tBoundaries,\r\n\tImageRestriction,\r\n\tPositionRestrictions,\r\n\tSize,\r\n\tSizeRestrictions,\r\n\tVisibleArea,\r\n} from '../typings';\r\nimport { fitSize, limitsToSize } from '../service';\r\nimport { isUndefined } from '../utils';\r\n\r\ninterface RefineSizeRestrictionsParams {\r\n\tsizeRestrictions: Partial<SizeRestrictions>;\r\n\tareaRestrictions: AreaRestrictions;\r\n\tpositionRestrictions: PositionRestrictions;\r\n\tboundaries: Boundaries;\r\n\timageSize: Size;\r\n\timageRestriction: ImageRestriction;\r\n}\r\nexport function refineSizeRestrictions({\r\n\tareaRestrictions,\r\n\tsizeRestrictions,\r\n\timageSize,\r\n\tboundaries,\r\n\tpositionRestrictions,\r\n\timageRestriction = 'none',\r\n}: RefineSizeRestrictionsParams) {\r\n\t// User can forget to set some of restrictions, so we should init them by default values\r\n\tconst restrictions = {\r\n\t\t...sizeRestrictions,\r\n\t\tminWidth: sizeRestrictions.minWidth !== undefined ? sizeRestrictions.minWidth : 0,\r\n\t\tminHeight: sizeRestrictions.minHeight !== undefined ? sizeRestrictions.minHeight : 0,\r\n\t\tmaxWidth: sizeRestrictions.maxWidth !== undefined ? sizeRestrictions.maxWidth : Infinity,\r\n\t\tmaxHeight: sizeRestrictions.maxHeight !== undefined ? sizeRestrictions.maxHeight : Infinity,\r\n\t};\r\n\r\n\t// The situation, when stencil can't be positioned in cropper due to positionRestrictions should be avoided\r\n\tif (positionRestrictions.left !== undefined && positionRestrictions.right !== undefined) {\r\n\t\trestrictions.maxWidth = Math.min(restrictions.maxWidth, positionRestrictions.right - positionRestrictions.left);\r\n\t}\r\n\tif (positionRestrictions.bottom !== undefined && positionRestrictions.top !== undefined) {\r\n\t\trestrictions.maxHeight = Math.min(\r\n\t\t\trestrictions.maxHeight,\r\n\t\t\tpositionRestrictions.bottom - positionRestrictions.top,\r\n\t\t);\r\n\t}\r\n\r\n\t// The situation when stencil larger than maximum visible area or image should be avoided if imageRestriction != 'none':\r\n\tconst areaLimits = limitsToSize(areaRestrictions);\r\n\tconst areaMaximum = fitSize(boundaries, areaLimits);\r\n\r\n\tif (areaLimits.width < Infinity && (!restrictions.maxWidth || restrictions.maxWidth > areaMaximum.width)) {\r\n\t\trestrictions.maxWidth = Math.min(restrictions.maxWidth, areaMaximum.width);\r\n\t}\r\n\tif (areaLimits.height < Infinity && (!restrictions.maxHeight || restrictions.maxHeight > areaMaximum.height)) {\r\n\t\trestrictions.maxHeight = Math.min(restrictions.maxHeight, areaMaximum.height);\r\n\t}\r\n\r\n\t// Process the border cases when minimum height / width larger than maximum height / width\r\n\tif (restrictions.minWidth > restrictions.maxWidth) {\r\n\t\tif (process.env.NODE_ENV !== 'production') {\r\n\t\t\tconsole.warn(\r\n\t\t\t\t`Warning: maximum width (${restrictions.maxWidth}px) fewer that the minimum width (${restrictions.minWidth}px). It is set equal to the minimum width and width resizing was blocked`,\r\n\t\t\t);\r\n\t\t}\r\n\t\trestrictions.minWidth = restrictions.maxWidth;\r\n\t\trestrictions.widthFrozen = true;\r\n\t}\r\n\r\n\tif (restrictions.minHeight > restrictions.maxHeight) {\r\n\t\tif (process.env.NODE_ENV !== 'production') {\r\n\t\t\tconsole.warn(\r\n\t\t\t\t`Warning: maximum height (${restrictions.maxHeight}px) fewer that the minimum height (${restrictions.minHeight}px). It is set equal to the minimum height and height resizing was blocked`,\r\n\t\t\t);\r\n\t\t}\r\n\t\trestrictions.minHeight = restrictions.maxHeight;\r\n\t\trestrictions.heightFrozen = true;\r\n\t}\r\n\r\n\treturn restrictions;\r\n}\r\n","import { Coordinates, PositionRestrictions, SizeRestrictions } from '../typings';\r\nimport { fitToLimits } from '../service';\r\n\r\nexport interface RoundCoordinatesParams {\r\n\tcoordinates: Coordinates;\r\n\tsizeRestrictions: SizeRestrictions;\r\n\tpositionRestrictions: PositionRestrictions;\r\n}\r\nexport function roundCoordinates({\r\n\tcoordinates,\r\n\tsizeRestrictions,\r\n\tpositionRestrictions,\r\n}: RoundCoordinatesParams): Coordinates {\r\n\tconst roundedCoordinates = {\r\n\t\twidth: Math.round(coordinates.width),\r\n\t\theight: Math.round(coordinates.height),\r\n\t\tleft: Math.round(coordinates.left),\r\n\t\ttop: Math.round(coordinates.top),\r\n\t};\r\n\r\n\tif (roundedCoordinates.width > sizeRestrictions.maxWidth) {\r\n\t\troundedCoordinates.width = Math.floor(coordinates.width);\r\n\t} else if (roundedCoordinates.width < sizeRestrictions.minWidth) {\r\n\t\troundedCoordinates.width = Math.ceil(coordinates.width);\r\n\t}\r\n\tif (roundedCoordinates.height > sizeRestrictions.maxHeight) {\r\n\t\troundedCoordinates.height = Math.floor(coordinates.height);\r\n\t} else if (roundedCoordinates.height < sizeRestrictions.minHeight) {\r\n\t\troundedCoordinates.height = Math.ceil(coordinates.height);\r\n\t}\r\n\r\n\treturn fitToLimits(roundedCoordinates, positionRestrictions);\r\n}\r\n","import { ManipulateImageEvent, MoveEvent, ResizeEvent } from '../events';\r\nimport { VisibleArea } from '../typings';\r\nimport { ALL_DIRECTIONS, MAIN_DIRECTIONS } from '../constants';\r\n\r\ninterface NormalizeEventParams {\r\n\tevent: ResizeEvent | MoveEvent | ManipulateImageEvent;\r\n\tvisibleArea: VisibleArea;\r\n\tcoefficient: number;\r\n}\r\nexport function normalizeEvent({ event, visibleArea, coefficient }: NormalizeEventParams) {\r\n\tif (event.type === 'manipulateImage') {\r\n\t\treturn {\r\n\t\t\t...event,\r\n\t\t\tmove: {\r\n\t\t\t\tleft: event.move && event.move.left ? coefficient * event.move.left : 0,\r\n\t\t\t\ttop: event.move && event.move.top ? coefficient * event.move.top : 0,\r\n\t\t\t},\r\n\t\t\tscale: {\r\n\t\t\t\tfactor: event.scale && event.scale.factor ? event.scale.factor : 1,\r\n\t\t\t\tcenter:\r\n\t\t\t\t\tevent.scale && event.scale.center\r\n\t\t\t\t\t\t? {\r\n\t\t\t\t\t\t\t\tleft: event.scale.center.left * coefficient + visibleArea.left,\r\n\t\t\t\t\t\t\t\ttop: event.scale.center.top * coefficient + visibleArea.top,\r\n\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t: null,\r\n\t\t\t},\r\n\t\t};\r\n\t} else if (event.type === 'resize') {\r\n\t\tconst normalizedEvent = { ...event, directions: { ...event.directions } };\r\n\t\tALL_DIRECTIONS.forEach((direction) => {\r\n\t\t\tnormalizedEvent.directions[direction] *= coefficient;\r\n\t\t});\r\n\t\treturn normalizedEvent;\r\n\t} else if (event.type === 'move') {\r\n\t\tconst normalizedEvent = { ...event, directions: { ...event.directions } };\r\n\t\tMAIN_DIRECTIONS.forEach((direction) => {\r\n\t\t\tnormalizedEvent.directions[direction] *= coefficient;\r\n\t\t});\r\n\t\treturn normalizedEvent;\r\n\t} else {\r\n\t\treturn event;\r\n\t}\r\n}\r\n","import { Coordinates, Size } from './typings';\r\n\r\ninterface Options {\r\n\timageSmoothingQuality?: 'low' | 'medium' | 'high';\r\n\timageSmoothingEnabled?: boolean;\r\n\tfillColor?: string;\r\n}\r\n\r\nexport function updateCanvas(\r\n\tcanvas: HTMLCanvasElement,\r\n\tsource: HTMLCanvasElement | HTMLImageElement,\r\n\tcoordinates: Coordinates,\r\n\tresultSize?: Size,\r\n\toptions?: Options,\r\n) {\r\n\tcanvas.width = resultSize ? resultSize.width : coordinates.width;\r\n\tcanvas.height = resultSize ? resultSize.height : coordinates.height;\r\n\r\n\tconst ctx = canvas.getContext('2d');\r\n\r\n\tctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n\tif (options) {\r\n\t\tif (options.imageSmoothingEnabled) {\r\n\t\t\tctx.imageSmoothingEnabled = options.imageSmoothingEnabled;\r\n\t\t}\r\n\t\tif (options.imageSmoothingQuality) {\r\n\t\t\tctx.imageSmoothingQuality = options.imageSmoothingQuality;\r\n\t\t}\r\n\t\tif (options.fillColor) {\r\n\t\t\tctx.fillStyle = options.fillColor;\r\n\t\t\tctx.fillRect(0, 0, canvas.width, canvas.height);\r\n\t\t\tctx.save();\r\n\t\t}\r\n\t}\r\n\r\n\tctx.drawImage(\r\n\t\tsource,\r\n\t\tcoordinates.left,\r\n\t\tcoordinates.top,\r\n\t\tcoordinates.width,\r\n\t\tcoordinates.height,\r\n\t\t0,\r\n\t\t0,\r\n\t\tcanvas.width,\r\n\t\tcanvas.height,\r\n\t);\r\n}\r\n","import { Boundaries, Size } from '../typings';\r\n\r\nexport interface DefaultBoundariesParams {\r\n\tcropper: HTMLElement;\r\n\timageSize: Size;\r\n}\r\n\r\nexport function fitBoundaries({ cropper, imageSize }: DefaultBoundariesParams): Boundaries {\r\n\tconst areaHeight = cropper.clientHeight;\r\n\tconst areaWidth = cropper.clientWidth;\r\n\r\n\tlet currentHeight = areaHeight;\r\n\tlet currentWidth = (imageSize.width * areaHeight) / imageSize.height;\r\n\r\n\tif (currentWidth > areaWidth) {\r\n\t\tcurrentWidth = areaWidth;\r\n\t\tcurrentHeight = (imageSize.height * areaWidth) / imageSize.width;\r\n\t}\r\n\r\n\treturn {\r\n\t\twidth: currentWidth,\r\n\t\theight: currentHeight,\r\n\t};\r\n}\r\n\r\nexport function fillBoundaries({ cropper }: DefaultBoundariesParams): Boundaries {\r\n\treturn {\r\n\t\twidth: cropper.clientWidth,\r\n\t\theight: cropper.clientHeight,\r\n\t};\r\n}\r\n","import { GetAreaRestrictions, Boundaries, VisibleArea } from '../typings';\r\nimport { fitToLimits, ratio } from '../service';\r\n\r\ninterface RefineVisibleAreaParams {\r\n\tvisibleArea: VisibleArea;\r\n\tboundaries: Boundaries;\r\n\tgetAreaRestrictions: GetAreaRestrictions;\r\n}\r\nexport function refineVisibleArea(params: RefineVisibleAreaParams): VisibleArea {\r\n\tconst { visibleArea: previousVisibleArea, boundaries, getAreaRestrictions } = params;\r\n\r\n\tlet visibleArea = { ...previousVisibleArea };\r\n\r\n\tconst boundariesRatio = ratio(boundaries);\r\n\tif (visibleArea.width / visibleArea.height !== boundariesRatio) {\r\n\t\tvisibleArea.height = visibleArea.width / boundariesRatio;\r\n\t}\r\n\r\n\treturn fitToLimits(visibleArea, getAreaRestrictions({ visibleArea, type: 'move' }));\r\n}\r\n","import {\r\n\tAspectRatio,\r\n\tBoundaries,\r\n\tCoordinates,\r\n\tGetAreaRestrictions,\r\n\tPositionRestrictions,\r\n\tSize,\r\n\tSizeRestrictions,\r\n\tStencilSize,\r\n\tPosition,\r\n\tVisibleArea,\r\n\tStencilCalculationParams,\r\n} from '../typings';\r\nimport { isFunction, isUndefined } from '../utils';\r\nimport { adjustSize, applyScale, fitToLimits, getBrokenRatio, intersectionLimits, ratio, toLimits } from '../service';\r\nimport { approximatedSize } from './approximatedSize';\r\n\r\nexport interface CalculateStencilSizeParams {\r\n\taspectRatio: AspectRatio;\r\n\tstencilSize: StencilSize;\r\n\tboundaries: Boundaries;\r\n}\r\nexport function calculateStencilSize(params: CalculateStencilSizeParams): Size {\r\n\tconst { boundaries, stencilSize, aspectRatio } = params;\r\n\r\n\t// Checks that coordinates has the same ratio that coordinates:\r\n\tlet stencil = isFunction(stencilSize)\r\n\t\t? (stencilSize as Function)({ boundaries, aspectRatio })\r\n\t\t: stencilSize;\r\n\r\n\tif (getBrokenRatio(ratio(stencil), aspectRatio)) {\r\n\t\tif (process.env.NODE_ENV !== 'production') {\r\n\t\t\tconsole.error(\r\n\t\t\t\t`[Adjusting stencil] The aspect ratio of stencil doesn't correspondent to aspect ratio limitations`,\r\n\t\t\t);\r\n\t\t}\r\n\t\tstencil = approximatedSize({\r\n\t\t\tsizeRestrictions: {\r\n\t\t\t\tmaxWidth: boundaries.width,\r\n\t\t\t\tmaxHeight: boundaries.height,\r\n\t\t\t\tminWidth: 0,\r\n\t\t\t\tminHeight: 0,\r\n\t\t\t},\r\n\t\t\twidth: stencil.width,\r\n\t\t\theight: stencil.height,\r\n\t\t\taspectRatio: {\r\n\t\t\t\tminimum: aspectRatio.minimum,\r\n\t\t\t\tmaximum: aspectRatio.maximum,\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\tif (stencil.width > boundaries.width || stencil.height > boundaries.height) {\r\n\t\tif (process.env.NODE_ENV !== 'production') {\r\n\t\t\tconsole.error(\r\n\t\t\t\t`[Adjusting stencil] The width and height of stencil (${stencil.width}, ${stencil.height}) should be fewer or equal to the width and height of boundaries (${boundaries.width},${boundaries.height}) respectively`,\r\n\t\t\t);\r\n\t\t}\r\n\t\tstencil = approximatedSize({\r\n\t\t\tsizeRestrictions: {\r\n\t\t\t\tmaxWidth: boundaries.width,\r\n\t\t\t\tmaxHeight: boundaries.height,\r\n\t\t\t\tminWidth: 0,\r\n\t\t\t\tminHeight: 0,\r\n\t\t\t},\r\n\t\t\twidth: stencil.width,\r\n\t\t\theight: stencil.height,\r\n\t\t\taspectRatio: {\r\n\t\t\t\tminimum: ratio(stencil),\r\n\t\t\t\tmaximum: ratio(stencil),\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\treturn stencil;\r\n}\r\n"],"names":["hasOwn","hasOwnProperty","classNames","classes","i","arguments","length","arg","argType","push","Array","isArray","inner","apply","toString","Object","prototype","key","call","join","module","exports","default","window","componentName","elementOrMods","mods","element","base","keys","reduce","result","name","value","debounce","func","wait","immediate","timeout","args","context","timestamp","later","last","Date","now","setTimeout","debounced","this","callNow","clear","clearTimeout","flush","__assign","assign","t","s","n","p","directionNames","hDirection","vDirection","classname","toUpperCase","slice","isBlob","url","test","isLocal","isDataUrl","isFunction","obj","constructor","isUndefined","undefined","isObject","getOptions","options","defaultScheme","falseScheme","forEach","Boolean","parseNumber","number","parsedNumber","Number","isNaN","isNumber","isObjectLike","distance","firstPoint","secondPoint","Math","sqrt","pow","x","y","move","scale","type","directions","params","nativeEvent","position","previousPosition","anchor","DragEvent","_a","_b","getBoundingClientRect","left","top_1","top","props","String","beforeMount","addEventListener","onMouseUp","passive","onMouseMove","onTouchMove","onTouchEnd","beforeUnmount","removeEventListener","mounted","$refs","draggable","Error","touches","hovered","methods","onMouseOver","$emit","onMouseLeave","onTouchStart","e","cancelable","disabled","initAnchor","mean","touch","clientX","clientY","preventDefault","stopPropagation","processEnd","processMove","onMouseDown","fake","right","bottom","event","newTouches","emits","cn","bem","components","DraggableElement","horizontalPosition","verticalPosition","computed","rootClass","root","required","ALL_DIRECTIONS","HORIZONTAL_DIRECTIONS","VERTICAL_DIRECTIONS","MAIN_DIRECTIONS","IMAGE_RESTRICTIONS","DEFAULT_COORDINATES","width","height","isEqual","a","b","properties","some","property","toLimits","object","diff","firstObject","secondObject","getCenter","getIntersections","limits","intersections","direction","areaLimit","objectLimit","max","applyDirections","coordinates","inverseMove","applyMove","applyScale","scaleFactor","center","progress","currentCenter","ratio","maxScale","area","min","Infinity","fit","intersection","getBrokenRatio","currentAspectRatio","aspectRatio","ratioBroken","minimum","maximum","fitSize","firstSize","secondSize","firstRatio","secondRatio","rotateSize","size","angle","radians","PI","abs","cos","sin","rotatePoint","point","adjustSize","fitToLimits","inverse","limitsToSize","limitSizeRestrictions","sizeRestrictions","minWidth","minHeight","maxWidth","maxHeight","joinLimits","firstDirection","secondDirection","intersectionLimits","validateSize","ignoreMinimum","correctRatio","approximatedSize","findBestCandidate","candidates","candidate","positionRestrictions","movedCoordinates","applyTransform","initialCoordinates","transform","imageSize","visibleArea","moveAlgorithm","prevCoordinates","newCoordinates","MoveEvent","changes","resizeAlgorithm","fixedStencilAutoZoom","getAreaRestrictions","boundaries","originalCoordinates","originalVisibleArea","stencilSize","precision","stencil","console","error","hybridStencilAutoZoom","simplestAutoZoom","widthIntersections","heightIntersections","defaultPosition","defaultSize","optimalRatio","fixedDefaultSize","defaultVisibleArea","boundaryRatio","reference","areaProperties","coordinatesIntersection","imageRatio","limitBy","manipulateImage","adjustStencil","areaScale","stencilScale","allowedScale","factor","scaleRestrictions","relativeCoordinates","rotateImage","previousImageSize","imageCenter","flipImage","flip","previousFlip","rotate","changed","horizontal","vertical","oldCenter","newCenter","fitConditions","preserveRatio","compensate","fittedDirections","currentWidth","currentHeight","breaks","maxResize","multiplier_1","map","multiplier_2","distributeOverlap","overlap","first","second","block","wrapper","HandlerWrapper","defaultClass","hoverClass","wrapperClass","data","hover","classnames","onDrag","dragEvent","onEnter","onLeave","onDragEnd","LineWrapper","transitions","handlers","eastNorth","north","westNorth","west","westSouth","south","eastSouth","east","handlersComponent","SimpleHandler","handlersClasses","handlersWrappersClasses","lines","linesComponent","SimpleLine","linesClasses","linesWrappersClasses","resizable","points","verticalDirection","horizontalDirection","style","enabled","transition","time","timingFunction","handlersWrappers","linesWrappers","lineNodes","_this","component","class","handlerNodes","_this2","wrapperStyle","onEnd","onHandlerDrag","respectDirection","shift","ResizeEvent","allowedDirections","preserveAspectRatio","shiftKey","movable","activationDistance","touchStarted","shouldStartMove","button","container","getImageData","img","Promise","resolve","reject","base64","replace","binary","atob","len","buffer","ArrayBuffer","view","Uint8Array","charCodeAt","base64ToArrayBuffer","fileReader_1","FileReader","onload","target","callback","blob","readAsArrayBuffer","http","XMLHttpRequest","open","responseType","status","response","send","http_1","onreadystatechange","readyState","onprogress","getResponseHeader","abort","withCredentials","getStyleTransforms","scaleX","scaleY","resetAndGetOrientation","arrayBuffer","orientation_1","dataView","DataView","tiffOffset","littleEndian","app1Start","ifdStart","getUint8","length_1","byteLength","offset","start","str","fromCharCode","getStringFromCharCode","endianness","getUint16","firstIFDOffset","getUint32","length_2","setUint16","image","stencilCoordinates","imageClass","imageWrapper","imageStyle","imageTransforms","transforms","virtualSize","compensations","translateX","translateY","calculateGeometricProperties","centerMass","spread","count","touchMove","mouseMove","touchResize","wheelResize","eventsFilter","Function","created","transforming","debouncedProcessEnd","ManipulateImageEvent","newProperties","oldProperties","oldGeometricProperties","processStart","processEvent","_toConsumableArray","filter","identifier","find","anotherTouch","buttons","onWheel","deltaY","detail","wheelDelta","TransformableImage","fill","calculatedImageSize","calculatedSize","coefficient","watch","onChangeImage","refreshImage","refresh","unmounted","naturalHeight","naturalWidth","clientWidth","clientHeight","complete","Preview","inheritAttrs","StencilPreview","BoundingBox","DraggableArea","minAspectRatio","maxAspectRatio","movingClass","resizingClass","previewClass","boundingBoxClass","moving","resizing","preview","boundingBox","onMove","moveEvent","onMoveEnd","onResize","resizeEvent","onResizeEnd","aspectRatios","BackgroundWrapper","src","stencilComponent","RectangleStencil","backgroundWrapperComponent","stencilProps","autoZoom","boundariesClass","backgroundClass","foregroundClass","checkOrientation","canvas","crossOrigin","transitionTime","imageRestriction","validator","indexOf","roundResult","defaultBoundaries","invalid","warn","priority","resizeImage","moveImage","autoZoomAlgorithm","actualCoordinates","eventParams","widthFrozen","heightFrozen","overlapHeight","overlapWidth","algorithms","initStretcher","stretcher","fitCoordinates","previousCoordinates","fitVisibleArea","previousVisibleArea","areaRestrictionsAlgorithm","sizeRestrictionsAlgorithm","positionRestrictionsAlgorithm","transitionsActive","imageLoaded","imageAttributes","customImageTransforms","basicImageTransforms","initialized","settings","wheel","mouse","areaRestrictions","transitionsOptions","restrictions","areaLimits","areaMaximum","getStencilSize","cropper","background","foreground","cropperWrapper","defaultCoordinates","boundariesStyle","styles","round","pointerEvents","opacity","optimalImageSize","$nextTick","resetCoordinates","runAutoZoom","onChange","onPropsChange","reset","oldProps","newProps","prop","debouncedUpdate","update","debouncedDisableTransitions","disableTransitions","awaiting","onSuccessLoadImage","onFailLoadImage","revoke","URL","revokeObjectURL","getResult","prepareResult","getCanvas","zoom","onManipulateImage","normalize","setCoordinates","enableTransitions","delayedTransforms","updateVisibleArea","then","_this3","resetVisibleArea","_this4","awaitRender","_this5","roundedCoordinates","floor","ceil","getPublicProperties","processAutoZoom","algorithm","getAspectRatio","payload","normalizeEvent","normalizedEvent_1","normalizedEvent_2","source","originalSize","transformedSize","ctx","getContext","save","canvasCenter","translate","drawImage","restore","prepareSource","sourceCanvas","maxArea","maxCanvasSize","imageSmoothingEnabled","imageSmoothingQuality","fillColor","firstNumeric","array","el","parseFloat","isFinite","resultSize","clearRect","fillStyle","fillRect","updateCanvas","limited","defaultSizeAlgorithm","defaultPositionAlgorithm","_this6","clearImage","_this7","updateBoundaries","_this8","areaHeight","areaWidth","fitBoundaries","fillBoundaries","_this9","boundariesRatio","catch","_this10","pageLocation","location","urlMatch","exec","urlparts","protocol","host","port","portOf","isCrossOriginURL","promise","orientation","_this11","onParseImage","_this12","createObjectURL","Blob","chunks","uint8","subarray","from","btoa","arrayBufferToDataURL","getImageTransforms","_this13","isLoadedImage","_this14","_this15","minimumSize","ticking","ignoreStencil","stencilRatio","currentStencilSize"],"mappings":"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"}